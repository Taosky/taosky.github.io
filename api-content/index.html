{"posts":[{"title":"江苏电信IPTV多设备播放","content":"迫于看电视，折腾一下IPTV，网上各种帖子讲的很复杂，如果是用的江苏电信且没有特殊的需求，实现多设备看IPTV还是比较容易的，稍微整理一下。 目标 实现局域网内各个终端包括其他电视、电脑、手机都能稳定观看直播（实际上外网也能连回家里看）；保留电信IPTV盒子的功能。 网络环境 运营商：江苏（苏州）电信 光猫：友华PT926E（天翼网关3.0） IPTV抓包和测试 抓包 这一步的目的主要是为了抓取直播源和进行测试，不过现在网上可以找到很多江苏电信的直播源，经过测试，只要连接iptv口，不用什么特殊操作就能播放。 想看的可以展开 抓取可以买个usb网口，一个网口接光猫IPTV口，一个接IPTV盒子，然后进行桥接。在Windows下可以用wireshark进行抓包（记得安装npcap），后续操作大体可以参考这个视频。 这里其实涉及到江苏电信（浙江电信好像也是）是用的带鉴权的DHCP。就是说如果要在路由器上获取IP，需要option12（盒子序列号）、option60（加密的认证数据），再拷贝盒子MAC地址进行模拟，但**实际上不用获取IP也能通过组播地址播放**。对认证感兴趣的可以看这几个贴子: 浙江电信IPTV DHCP鉴权option12与option60获取方法分享、江苏泰州IPTV破解IP认证，实现DHCP获取IP 经过测试，使用wireshark进行关键词rstp、igmp抓包，也并不能找到明文的组播地址，所以老老实实用网上的源就好，基本不会变动，可以长期使用。如：抓的江苏电信IPTV组播地址（2021-12-15）、IPTV(github) 测试 可以用电脑直接连接光猫的IPTV口，使用PotPlayer等软件播放组播地址，如rtp://239.49.8.19:9614。 网络调整 光猫设置 因为路由器和光猫都在弱电箱里，不需要使用网上提的的较多的单线复用（路由器和光猫只有一根线连接的情况），只要再接条线到路由器再设置即可。由于默认只有一个IPTV口，且这个口已经连到了房间的IPTV盒子上，首先需要登陆光猫把IPTV绑定到一个闲置的百兆口上，也就是光猫上有两个IPTV口。 这时候就需要先获取光猫的超密了，我的光猫是天翼网关3.0，参照【教程】使用BurpStuite抓包获取天翼网关超级密码并更改天翼网关为桥接模式 ，就能获取明文密码了。主要是利用了一个漏洞，浏览存储目录的时候，拦截请求修改请求目录参数，访问根目录对密码文件进行拷贝，拦截修改情况这步用fiddler也是可以的。（部分光猫似乎不是明文，可以尝试文章评论区的方方法） 拿到超密后，登陆修改业务绑定信息，INTERNET_B_VID是宽带业务，Other_B_VID是IPTV业务，把宽带业务的绑定端口减少一个，我这边是把端口4取消绑定了，端口2是原有的IPTV端口。再把IPTV业务绑到空出来的端口4上，这样就保证IPTV盒子和路由器都能接入IPTV。 路由器设置 OpenWRT设置参考评论 首先要将路由器的eth4端口（将要和新增的iptv口连接的端口）从Lan桥接中删除，也就是将它独立出来，这一步的目的是阻止IPTV的组播流量进入局域网（据说会引起风暴，降低网络性能，网上的很多帖子似乎是通过vlan、防火墙流量配置等方法解决的）在我的路由器上如图设置即可，如果是OpenWRT应该是点接口-LAN，从设置里取消勾选。 用网线把光猫上新增的IPTV口（端口4）连到路由器的eth4，完成物理连接，此时再登陆路由器管理页面可以看到已经连接上了。 UDPXY转HTTP UDPXY是把组播流量代理转换为HTTP，一是防止组播流量进入局域网，二是HTTP更加稳定，各终端通用性好。如果是OpenWRT可以安装相应luci插件进行设置，ER-X的EdgeOS基于Debian，自己下载二进制文件，再新建个服务用于启动即可。 拷贝或下载到路由器用户目录后，SSH登陆，chmod +x udpxy添加执行权限，udpxy -S -a 192.168.2.1 -p 4022 -m eth4 -c 10 -B 1MB -M 30先测试一下能不能用。 打开http://192.168.2.1:4022/status正常显示，播放器打开http://192.168.2.1:4022/udp/239.49.8.19:9614可以播放，测试成功。 接着创建servicesudo vi /etc/systemd/system/udpxy.service（User要设置成ubnt，试了root不行） [Unit] Description=Udpxy After=network.target [Service] ExecStart=/home/ubnt/udpxy -S -a 192.168.2.1 -p 4022 -m eth4 -c 10 -B 1MB -M 30 User=ubnt [Install] WantedBy=multi-user.target 保存后sudo systemctl daemon-reload、``sudo systemctl start udpxy、sudo systemctl enable udpxy`启动服务、设置为开机自起，此时就基本完成配置了。 多设备播放 PC WIndows上使用Potplayer，Mac上使用IINA，可以做一个m3u8列表方便选取观看，网上的iptv源列表，替换成下列格式，命名为xxx.m3u8，播放器打开即可播放，完整见直播(江苏电信21-01-04).m3u8 #EXTM3U #EXTINF:-1,CCTV1HD http://192.168.2.1:4022/udp/239.49.8.19:9614 #EXTINF:-1,CCTV2HD http://192.168.2.1:4022/udp/239.49.8.50:9802 #EXTINF:-1,CCTV3HD http://192.168.2.1:4022/udp/239.49.9.31:6000 #EXTINF:-1,CCTV4HD http://192.168.2.1:4022/udp/239.49.8.51:9806 #EXTINF:-1,CCTV5HD http://192.168.2.1:4022/udp/239.49.8.75:8000 #EXTINF:-1,CCTV5+HD http://192.168.2.1:4022/udp/239.49.8.18:9610 电视 Android电视和盒子可以安装DIYP影音，然后在设置内自定义播放列表，打开对应URL就可以进行设置，格式为频道名称,http地址，完整见直播列表（DIYP影音）.txt 移动端 可以播放m3u8的播放器即可，或者手动复制http链接使用。 其他 外网播放 操作是可行的，不建议使用，占用大量上传，还存在一定风险。 参考 https://github.com/itiddler/udpxy_erx https://blog.friskit.me/2020/05/31/bjunicom-network.html https://www.bilibili.com/read/cv9858309 https://www.right.com.cn/forum/thread-7722652-1-1.html https://www.right.com.cn/forum/thread-794304-1-1.html ","link":"https://taosky.github.io/post/jiangsu-telecom-iptv-use/"},{"title":"NAS系列：Ubuntu用作NAS硬盘休眠问题","content":"NAS重做了系统，据之前使用的体验，OMV各种BUG挺多的，作为NAS系统也搞不出啥花样，就换成了XUbuntu（Debian的安装太烦，还要联网），硬盘休眠一直有些问题，折腾了很久，因此记录一下。 自带hdparm -S设置时间，总是不能休眠，手动hdparm -Y可以。研究了半天，又是APM又是用hd-idle替代，都不好使。 最后发现了有人写了个脚本hdd-spindown.sh，用了一种简单直接的办法，每隔一定时间读取/sys/block/sdX/stat，检查设定时间内有没有数据写入，再判断硬盘当前状态，手动hdparm -Y休眠硬盘。 然而这个脚本我实际使用的时候，需要把的dev_isup &quot;$1&quot; &amp;&amp; return 0注释掉（似乎是执行结果会一直得出硬盘处在活跃状态），并且把无数据写入时间和检测间隔设置的很短的情况下才能成功休眠。 有人提到在高版本Linux内核的系统上，脚本会一直判断有数据写入而不会休眠硬盘，然后写了修改版，配置文件有些许区别，同样注释掉出问题的行（ 第55行）后，的确能正常使用了。 硬盘休眠状态可以用脚本检测，想看的时候执行一下就行。 #!/bin/bash dsk=`ls /dev/|grep 'sd[a-z]$'` echo `date +%c` for i in $dsk; do echo -n &quot;/dev/$i : &quot; ; echo `smartctl -i -n standby /dev/$i|grep &quot;mode&quot;|awk '{print $4}' `; done exit ","link":"https://taosky.github.io/post/ubuntu-nas-hdd-spindown/"},{"title":"切换至Caddy2 ","content":"原来用的Caddy1，后来发现官网上只有新的2.0的二进制文件了，不过原来用的1.0的也能用就没换。最近Caddy服务重启的时候总是很慢，kill -10重载配置也没反应，体验很差，就索性换成Caddy2了。 安装 二进制文件 官网下载，简单粗暴。可以勾选各种额外功能包，我选了caddy-webdav用来做webdav文件管理，cloudflare用于申请tls证书（后来实测没用，还是acme.sh好用）。最后选择平台下载。 Linux服务 参见官方文档的Linux service。 二进制文件放到/usr/bin 创建一个caddy组和用户专门运行这个服务: sudo groupadd --system caddy sudo useradd --system \\ --gid caddy \\ --create-home \\ --home-dir /var/lib/caddy \\ --shell /usr/sbin/nologin \\ --comment &quot;Caddy web server&quot; \\ caddy 选择官方的服务配置文件下载，Caddy2有两种配置方法，一种是API模式，另一种是和原来比较相似的Caddyfile配置，我选的后者，修改和维护比较方便，caddy.service 保存到/etc/systemd/system/caddy.service 重载服务配置 sudo systemctl daemon-reload 启动并查看caddy运行状况 sudo systemctl start caddy sudo systemctl status caddy 配置 配置部分比较麻烦，特别是看到官方的文档以后...直接使用以前的配置是完全不行的。 配置结构 配置默认还是以一个Caddyfile作为入口，存放主要的全局配置等内容；像nginx一样引入子配置，每个站点单独配置，易于管理。 /etc/caddy/Caddyfile /etc/caddy/site1.xxx.xx.caddy /etc/caddy/site2.yyy.xx.caddy 下面是一个Caddyfile的例子 { auto_https off http_port 1984 https_port 1989 } (COMMON_CONFIG) { encode zstd gzip } (SITE_XXX_XX_TLS) { tls /etc/letsencrypt/live/XXX.XX/fullchain.pem /etc/letsencrypt/live/XXX.XX/privkey.pem protocols tls1.2 tls1.3 } import /etc/caddy/*.caddy 第一段{}代表的是全局选项，我这里修改了默认的http和https端口，关闭自动https。更多设置见官方文档Global options 后面两段可以认为是具有命名的配置片段，如COMMON_CONFIG就是一个命名，在Caddyfile和其它*.caddy文件中可以插入。SITE_XXX_XX_TLS内配置了TLS协议和证书，这里申请的是泛域名证书，我就可以在同一主域下的所有配置文件中通过import SITE_XXX_XX_TLS插入，不必重复写一长串。 最后import /etc/caddy/*.caddy即是引入具体站点配置。 https://abc.xxx.xx:4399 { import COMMON_CONFIG import SITE_XXX_XX_TLS reverse_proxy http://127.0.0.1:1234 } 这是一个简单的反向代理的配置，这里结构和caddy1差不多，通过import COMMON_CONFIG和 import SITE_XXX_XX_TLS引入Caddyfile内的配置片段，reverse_proxy就是之前的proxy。这样一个简单的配置就完成了，可以试着重启caddy。 webdav和file_server 我这个web页面主要是用于访问文件，要用到webdav和file_sever。 webdav /webdav/* { root /mnt/M/share/ prefix /webdav } webdav后面代表匹配的路径，在访问/webdav/xxx这类子路径时生效，root代表文件系统路径，prefix前缀用于修正访问文件目录的路径，比如访问/webdav/img/1.png，如果没有设置prefix，默认就会去文件系统访问/mnt/M/share/webdav/img/1.png，加上prefix参数，系统就会知道访问路径开头的/webdav是需要去掉的。 这个webdav不能像caddy1一样设置只读，所以只能通过配置要访问的文件对运行服务的caddy用户的读写权限实现。 root * /mnt/M file_server /share/* browse file_server需要设置root'根目录'，file_server后面的 /share/* 即是匹配路径，也是文件系统的相对路径，这里把/mnt/M设为根目录，访问/share/XXX时会去访问文件系统的/mnt/M/share/XXX，browse参数会在访问时显示默认的页面，方便检索，这个页面和caddy1的browse是一样的。 因为匹配路径的问题，默认访问/share 及/webdav会404，使用redir /share /share/重定向可以解决。 当file_server和webdav同时使用时，需要加上route，原因不太清楚。 route { webdav /webdav/* { root /mnt/M/share/ prefix /webdav } } root * /mnt/M file_server /share/* browse basicauth 这个主要是配置里面的密码从明文变成了哈希串的base64编码，并可以设置哈希算法（默认是bcrypt）。 在线计算生成bcrypt，再进行base64编码，就是需要填入配置中的密码。 如密码github得到的结果可能是JDJhJDEwJHpranZHRmliampldDgzaGRyc1B1cWVteHhnWUNic0xvU0VTaHg3RERJY0JYekxLWW5lbEND basicauth /share/* { git DJhJDEwJHpranZHRmliampldDgzaGRyc1B1cWVteHhnWUNic0xvU0VTaHg3RERJY0JYekxLWW5lbEND } tls 因为不是标准端口的网站，没办法用文件的方式自动申请证书。一开始用cloudflare模块，试了很久不行，总是提示在后台申请证书，没个结果。后来还是用certbot搞定了，手动在配置中指定泛域名证书，也挺方便的。 参考 Caddy Documentation Caddy2 简明教程 ","link":"https://taosky.github.io/post/qie-huan-zhi-caddy2/"},{"title":"NAS系列：OMV使用虚拟群晖备份照片","content":"使用群晖App备份管理照片，并在电脑上通过Google Photos二次备份（顺便一提，Google Photos前几天宣布不再免费无限高品质备份了，到明年6月前还可以）。 虚拟群晖安装 上一篇讲了如何在OMV安装使用VirtualBox，安装虚拟黑群晖和正常安装类似，简单说明一下。 把引导的XPEnoboot_DS3615xs_5.2-5967.1.iso挂载到光盘（我这里用的是DSM_DS3615xs_5967这个版本），设置网络为桥接。 引导启动（等进入默认启动项就行，不用操作），浏览器进入安装页面（可以路由器上看IP），一通点，选择下好的DSM_DS3615xs_5967.pat文件进行安装。 设置登录并创建存储，安装Photo Station套件。 虚拟机硬盘分配7、8个G差不多，太小群晖里面分不出存储空间来 NFS挂载 原理就是在把主机的路径通过NFS挂载到虚拟的群晖里面，就能使用各种套件来备份整理了。 首先要在主机开个NFS服务器并共享需要用于虚拟群晖备份的路径，OMV的话直接点点点就好了。这里演示的是设置成虚拟群晖IP，也可以192.168.2.0\\24这种让局域网其它IP也能访问。 虚拟群晖设置开启SSH，登录账号是root，密码是管理员密码。 登录终端后，输入/bin/mount -t nfs 主机IP:/export/路径 /volume1/photo测试能不能成功挂载。（此处根据不同系统和软件包版本，有的是绝对路径，如/bin/mount -t nfs 主机IP:/media/xxx/photos /volume1/photo） 测试可以的话，vi /etc/rc，把刚才的命令加到exit 0之前，让它开机就挂载。 挂在成功后再群晖各个套件里面应该就能看到了，可以使用群晖的DS Photo App进行备份等操作。 Google Photos自动二次备份 如果需要云备份的话，可以在主机上用Samba把路径分享出来，在电脑上进行挂载。这里有个问题，群晖的Photo Station套件会生成@eaDir的缩略图文件夹，里面大量缩略图会造成备份混乱。 通过查询帮助文档发现有个veto files的选项可以忽略指定的路径和文件（性能上有损失），设置一下即可。 这时候在Google Photos里面选择Samba的照片路径，就能正常备份了。 ","link":"https://taosky.github.io/post/virtual-qunhui-photos-backup/"},{"title":"NAS系列：OMV5（Debian 10）安装使用VirtualBox","content":"由于操作偏差，蜗牛上的OMV4系统几乎不能用了，于是重新安装了OMV5系统。之前用的VirtualBox的插件运行虚拟群晖来管理，OMV5就无法安装这个插件了，但是可以在Debian直接安装VirtualBox，并利用远程桌面和命令进行管理。 2021-03-07: 服务脚本加入等待时间防止开机启动失败 安装启动 下载官方适用于Debian10的安装包 wget https://download.virtualbox.org/virtualbox/6.1.14/virtualbox-6.1_6.1.14-140239\\~Debian\\~buster_amd64.deb 安装 sudo dpkg -i virtualbox-6.1_6.1.14-140239\\~Debian\\~buster_amd64.deb 出现错误提示，部分依赖由于冲突不能安装，这时候使用提示的fix命令安装即可。 桌面启动管理 单纯用命令的话太麻烦，安装xfce4 和 vnc4server，实现远程桌面管理 sudo apt-get -y install xfce4 xrdp vnc4server xfce4-terminal 新建配置文件，指定启动桌面xfce4 echo xfce4-session&gt;.xsession 重启系统，使用远程桌面连接，选择xvnc。 登录后可能出现中文字体错误的情况，可以复制Windows系统C:\\Windows\\Fonts内的中文字体到/usr/local/share/fonts内，重新连接桌面即可。 桌面右击启动终端，virtualbox启动，即可进行虚拟机管理。 命令行启动 每次开机要远程桌面启动虚拟机很麻烦，可以用命令行模式启动。 列出虚拟机vboxmanage list vms 无头模式启动（这条命令是持续性的） VBoxHeadless -startvm &quot;QunHui&quot; 查看是否启动VBoxManage list runningvms 创建服务'sudo vim /etc/systemd/system/vbox_machine.service' [Unit] Description=Virtualbox QunHui After=network.target [Service] User=你的用户名 ExecStartPre=/bin/sleep 30 ExecStart=/usr/bin/VBoxHeadless -startvm &quot;QunHui&quot; [Install] WantedBy=multi-user.target 加载、启动、设为开机启动 sudo systemctl daemon-reload sudo systemctl start vbox_machine sudo systemctl enable vbox_machine 这样虚拟机就搞定了，下一篇会讲下如何用虚拟群晖NFS挂载硬盘进行照片的管理备份。 ","link":"https://taosky.github.io/post/omv5-debian10-install-virtualbox/"},{"title":"NAS系列：Transmission读写权限问题","content":"目前蜗牛上稳定运行OMV用作NAS，在使用Transmission的时候一直有个权限问题。 问题 Transmission默认是使用debian-transmission这个用户运行的，下载种子后默认创建的文件夹和文件属于debain-transmission用户和组，权限是744。 我的情况是，A用户使用Samba去访问的时候应当具有读写权限，B用户仅有读权限，而默认的权限导致只要debian-transmission这个用户是有读写权限的，同组用户和其他用户都只能读。 解决方法 网上有很多解决办法，比如修改运行用户，使用你想要有读写权限的用户去运行Transmission。这个办法可以解决问题，但是需要修改服务和配置目录，也只能解决只有一个用户需要读写的情况。还有修改debian-transmission到users组等说法，但是744权限下users组依旧无法访问。其实这后面应该还有一步。 Transmission配置文件中有一个参数是umask指定默认创建文件的权限，这个是已十进制表示的权限掩码，需要转换一下。比如我想要的权限是775，让用户和用户组都有读写执行的权限，其他用户只有读和执行的权限。掩码就是002，转换成八进制还是2，将umask值设为2即可。可以通过执行echo $(( 8#权限掩码 ))获得。 然后就是将需要权限的用户加入组debian-transmission，把debian-transmission用户加入组users应该也是可以的，不过这样users组就都有读写权限了。 ","link":"https://taosky.github.io/post/transmission-rw-permission/"},{"title":"收纳箱diy仓鼠（金丝熊）笼","content":"2020.05.24更新：这个跑轮跑着跑着就歪了，后来买了个支架也不管用，应该是之前烫洞的时候，洞不够平整，造成磨损，越来越歪。换了一个塑料版太极跑轮，两边固定的必固定一边的稳很多。下面放一张近照。 最近关注了一下如何科养金丝熊，据说国外的标准是底面积0.5平方米，国内“公认”也要60基起步。网上搜了一下笼子价格随着面积的增长并不线性，47和60基础笼的价格差别很大，想要更大的笼子，那得200+了。好在了解到了可以把收纳箱改造成仓鼠笼子，便宜够大。 箱子和材料 首先要找个箱子，网上见的比较多的是这款，就是加高版的床底收纳箱，比较美观，但是矮了点，可能大点的跑轮也装不进去。 淘宝找了一个250L的收纳箱（80x59x47），感觉比较合适，高是高了点，不容易越狱。 改造成笼子，主要是给收纳箱加几个窗子，也方便固定跑轮、水壶什么的。本以为要自己找铁丝网做，已经有养鼠人士开了网店专卖diy套装，包括亚克力窗、铁丝网、亚克力门及各种工具。 我选了两个30x12的铁丝网铁丝网后窗、40x27的铁丝网天窗和可以装水壶的亚克力侧窗。由于箱子比较大，前门我自己买了个定制的亚克力（60cmx30cm）。 我这里还参考贴吧的帖子买了一个燕窝盒和轴承用来DIY跑轮。 改造 先讲一下这个跑轮，这个燕窝盒的直径是25cm，如果是这么大的跑轮...好贵。燕窝盒改成跑轮很简单，就是用电烙铁在燕窝盒底部开一个洞，用来固定轴承。实测用电烙铁融化塑料烟雾弥漫、难闻至极，建议在空旷的地方搞。帖子里说要用钢尺铲平，实际上不太好操作，一凉下来塑料又凝固了。最后也不是很平，转动起来会有一点偏移，建议垫一些纸什么的，轴承盖子不容易滑动，总体还不错，转动也很顺畅 。 箱子开窗也就是挖洞再固定，不过比较麻烦。首先要确定开窗位置，用笔画出框架边缘需要留一公分，不然窗子没法固定，建议别像我一样用油性笔，后面可能会有残留的擦不掉（用酒精可以去除）。 接着用钢尺配合勾刀划出凹痕，多化几遍就可以划穿，这一步十分费体力。靠近边缘的地方不好掌握，容易划过，可一在勾刀划出的痕迹上用美工刀或者钢尺慢慢划，开完口边缘会很毛糙，可以用美工刀休整一下。 接着就可以安装窗子了，铁丝网的话先在边缘铁丝两边用电烙铁打洞，亚克力需要先标记一下再打洞，电烙铁融化塑料后塑料会粘连在电烙铁上，要用废纸废塑料什么的清理一下电烙铁，不然会一直冒黑烟，打第二个洞也会粘在上面导致不平整。 接着用螺丝或扎带固定，顶上的窗可以安装在外侧，仓鼠一般也上不去，里面的要安装在里侧，据说漏出塑料边就会被啃烂... 成品 忽略掉箱子外面，看着就还不错 4块包邮的星星灯，还是蛮亮的，夜间照明没问题 什么？你问仓鼠在哪，我还没有仓鼠😅 ","link":"https://taosky.github.io/post/diy-hamster-cage/"},{"title":"N1 媒体服务器Docker镜像","content":"在最早写的这篇N1折腾文章中，通过Entware环境安装了各种软件，实现下载浏览等媒体服务。经过上次折腾Docker下安装OpenWRT之后，就想是不是可以把这些软件做成一个Docker镜像方便使用，学习了一下不是很复杂，做成了一个镜像，特此分享。 2020.03.30更新： 调整挂载路径，从/root/exmedia 到/media/exmedia。 新增苹果afp服务，可在Finder中连接。 简介 镜像地址：https://hub.docker.com/r/taoskycn/n1-media-server 包含 Caddy,FileBrowser,Transmission，提供“BT/PT下载”，“HTTP文件浏览”，“WebDAV”，“文件管理” 服务。WebDAV可配合Potplayer, Nplayer, Kodi等软件用于播放视频。 先上几张效果图（因为把原图搞丢了，所以有张大妈的水印😓）。 镜像使用 首先要有Docker，如果是CoreELEC可以直接在插件里面安装。 安装启动 拉取镜像（之前反映有官方仓库下载慢的问题，这里用了ustc的mirror） docker pull docker.mirrors.ustc.edu.cn/taoskycn/n1-media-server:0.1 创建并后台运行容器（“/var/media/N”为外接存储路径，根据情况自行修改） docker run -it -d --name N1 -p 1001-1006:1001-1006 -p 51413:51413 -p 548:548 --privileged=true --mount type=bind,source=/var/media/N,target=/media/exmedia taoskycn/n1-media-server:0.2 /bin/ash 进入容器 docker exec -it N1 /bin/ash 启动各个服务/root/start.sh 回车 如需停止 /root/stop.sh 退出容器 exit 访问和设置 Transmission Web：http://&lt;N1的IP&gt;:1001，账号密码transmission:transmission，已更换WebUI，配置文件位于/root/.config/transmission-daemon/settings.json。 Caddy 文件浏览：http://&lt;N1的IP&gt;:1002，账号密码caddy:caddy，显示外接存储下的download目录，配置文件位于/etc/Caddyfile。 Caddy WebDAV：http://&lt;N1的IP&gt;:1002/webdav，账号密码caddy:caddy，显示外接存储下的download目录。 FileBrowser文件管理：http://&lt;N1的IP&gt;:1003，账号密码caddy:caddy，可在Web界面修改各项设置。 （新增） AFP服务：在Mac OS X的Finder下Command + K 输入afp://192.168.2.107 点击连接，默认账号密码afp:afp，可通过passwd afp进行密码修改，该服务端口为548，外网访问需映射该端口。 如需外网访问，使用路由器设置端口映射即可，考虑到安全因素，建议修改密码后操作 注意事项 docker run会映射端口，运行前确认端口未被使用。 51413为transmission交换数据的端口，需要映射到公网（没有好像会影响上传） 如需手动修改Transmission配置文件，先退出进程。 如外网访问各服务问题，可能是运营商屏蔽了特殊端口，可尝试更换端口。 WebDAV配置 Potplayer 播放列表-新建专辑(注意：由于Windows文件命名限制问题，可能有包含特殊符号的无法打开) NPlayer 网络-新建服务器-WebDAV Kodi 进入文件区-添加视频-浏览-添加网络位置 总结 最小化满足了媒体服务器的需求，并且具有一定的扩展性，比如玩PT的可以配合浏览器插件远程下载，WebDAV也可以在各个终端使用，也可以分享给别人远程浏览（上行带宽要够大）。 还有一些功能没有添加，如Aria2，因为我个人没有这种需求所以暂未考虑；还有Mac上WebDAV必须缓存完才能播放，之前是用的Netatalk做的一个afp（苹果文件传输）服务器，但是这个东西由于目录权限问题（很神奇），也没有成功，有研究过的希望能分享一下。 0.2版本已增加。 ","link":"https://taosky.github.io/post/n1-media-server-docker/"},{"title":"N1盒子CoreELEC+旁路由","content":"前情提要 上一篇文章中刷了YYF固件（Android），安装Kodi用于看片，安装Entware环境用于PT挂机和媒体服务器。经评论区提醒Android下的Kodi画质不如CoreELEC下的，而且CoreELEC是纯精简版Linux，相比Android没有中间商赚取差价，效率更高。只是装不了Android APP了，影响不大，遂折腾。 至于旁路由，能够更充分的利用N1，主要功能是科学和屏蔽广告，因为是OpenWrt要再加点什么功能也比较方便。 CoreELEC CoreELEC是一个专为Kodi打造的精简LInux发行版，据说是专门优化的，播放效果和兼容性比Android上的Kodi好很多，还具有一些影音方面的高级功能，比较适合影视爱好者。 写入U盘 首先N1需要降级才能用各种固件，这部分请参考别的文章。 CoreELEC镜像使用恩山论坛M大的版本，已经对N1做好了适配，目前更新到9.2。为了后面使用OpenWrt，需要安装9.0.2版（因为需要更新内核，只找到9.0.1和9.0.2有适配的新内核） 首先通过Etcher写入镜像到u盘，N1插上U盘重启，默认就会引导U盘内的系统，第一次启动可能时间长一些。 这时候需要一个鼠标，启动后要关闭自动更新（因为固件是修改适配N1的，更新官方的就开不出来了），进行语言、网络等设置。 具体使用和App版的Kodi并没有区别。 写入EMMC 另一种方式是写到EMMC（内部存储），这样就替换了原来的Android系统。 ssh root@N1的IP登陆系统，默认密码“coreelec”。 执行/flash/installtoemmc执行写入EMMC的命令。(需要注意的是9.0.2以上版本使用/flash/installtoemmc，旧版使用/flash/installtointernal） 等执行完成重启并拔掉U盘就可以了。 如果你写到eMMC后，想刷回安卓系统，其实很简单就可以刷回W大的官改固件，只需按照刷官改的方法，准备好usb burning tool，加载固件，点击“开始”刷机，然后ssh登录到CoreELEC系统，执行：reboot update命令，N1会自动重启，然后进入刷机模式，等待刷机完成即可。 Entware 安装非常简单 installentware,安装完成后重启，opkg update更新软件源，安装上Transmission等软件就可以实现之前在安卓下的下载机和媒体服务器了（详见前一篇）。 蓝牙遥控问题 如果是同款遥控器，需要用到这个帖子的适配文件，复制到/storage/.kodi/userdata/keymaps/路径下，重启N1即可使用。 不过有个Bug，在输入界面会出现自动输入‘i’的情况，导致无法正常输入，不过论坛里的大神已经在帖子下面回复了解决办法。 在系统-插件里面按‘system tools’这个插件，然后SSH登陆。 执行 systemctl stop kodi systemctl stop eventlircd evtest 接着vi ~/.config/hwdb.d/99-iprc1000.hwdb修改文件为（注意格式，有空格） #IPRC1000 remote evdev:input:b*v0A5Cp8502* KEYBOARD_KEY_7000c=unknown 然后执行 systemd-hwdb update udevadm trigger reboot 重启后就可以正常使用了，不过还有个问题是遥控器蓝牙长时间不用断开后，再次按键需要很久才能连上使用，在Android下没有这个问题。。。 旁路由 替换内核 由于CoreELEC自带内核过于精简，缺少某些功能（IPSET），导致OpenWRT下包括科学等一些插件启动不了，有人做了新的内核，只要简单地替换就可以了。（这个Docker镜像的说明中提供了一种不用替换内核添加IPSET功能的办法，尚未尝试） 下载新的内核(9.0.2版) 如果是U盘启动，直接替换U盘下/flash/kernel.img即可。 如果是EMMC启动，先把文件传到N1，执行mount -o rw,remount /flash挂载分区为可写，再替换/flash/kernel.img。 如果已经装了新版本的CoreELEC，并且配置了一堆东西不想重新装旧版（像我一样），也是有办法的。下载恩山论坛M大帖子里面的“升级脚本”，没错，升级脚本是可以降级的。。。原理就是替换system分区和内核。然后按照上面写的同样操作就可以了。 不过降级换内核后，我一连接蓝牙遥控器就卡死，只能用App控制了，不知道是内核的问题还是降级的问题。。。 Docker 和OpenWRT安装 Docker是一个容器，有些东西跑一下需要一堆配置，用Docker就可以直接拉取别人做好的镜像，简单设置就可以使用，而且有虚拟化的功能，OpenWRT就是独立安装在这样一个容器下的。 在CoreELEC下安装比较简单，在Kodi插件-服务程序下可以找到Docker，由于网络原因特别慢，可能需要等上一会儿或是多试几次。 安装后就可以SSH登陆，docker pull kanshudj/n1-openwrtgateway抓取镜像（这个镜像还有个R9版本，功能更多），这一步可能也要很长时间，取决于网络。 开启网卡混杂模式 ip link set eth0 promisc on 创建Macvlan复用网卡，用于虚拟主机接入局域网，这里的gateway和subnet根据自己的网段设置 docker network create -d macvlan --subnet=192.168.2.0/24 --gateway=192.168.2.1 -o parent=eth0 macnet 创建名为op的OpenWRT容器 docker run --name op --restart always -d --network macnet --privileged kanshudj/n1-openwrtgateway /sbin/init 创建成功后，启动容器的bash进行设置 docker exec -it op /bin/bash 修改网关IP等信息vi /etc/config/network 停用防火墙（之前没有这么操作，客户端一直连不上网） /etc/init.d/firewall disable&amp;&amp;/etc/init.d/firewall stop 重启网络 /etc/init.d/network restart exit退出到CoreELEC环境下后，重启容器docker restart op 这时候尝试打开http://192.168.2.20（改成自己设置的），出现OpenWRT登陆界面，默认密码是“password” 客户端设置 成功配置并运行OpenWRT后，在客户端设置网关和DNS为容器的IP，我设置的是192.168.2.20，如能成功上网，即配置成功。 旁路由功能 自带插件 这个固件默认只有DDNS、广告过滤和科学功能，在服务中可以配置启用，这个版本的科学功能只支持“绕过大陆IP”模式，如需要“某list模式”和更多的功能，可以使用kanshudj/n1-openwrtgateway:r9.10.1这个镜像。 科学功能使用的PDNSD默认使用OpenDNS，有些域名如“sogou.com”会解析不了，修改成阿里和腾讯的DNS服务器即可。vi /etc/pdnsd.conf找到label = &quot;opendns&quot;; 将下面的ip改成223.5.5.5, 119.29.29.29。 插件安装 我这里还加了一个解除黄逸云锁定的功能，是用的这个插件。 这个插件依赖curl和node，先安装一下opkg update &amp;&amp; opkg install curl &amp;&amp; opkg install node 然后下载插件包 wget https://github.com/project-openwrt/luci-app-unblockneteasemusic/releases/download/v2.7-1/luci-app-unblockneteasemusic_2.7-1_all.ipk 安装插件opkg install luci-app-unblockneteasemusic_2.7-1_all.ipk 这个插件有个问题就是在Web界面设置的时候不能启动，需要手动执行/etc/init.d/unblockneteasemusic start启动。可以在系统-启动项-本地启动脚本中添加这条开机自动执行。 默认情况下客户端会自动生效，IOS和MAC需要安装证书并信任。 体验 需要的设备设置网关，出了问题别的设备也能正常使用。和原来一样在局域网中，Homekit等各种服务也能正常使用。 测试了一下，带宽没什么损失，手机上玩游戏也没有跳ping，延迟和直连路由器差不多，看来N1的性能跑这几个小东西还是绰绰有余。 还有就是绕过国内IP模式的话，BT/PT的国外流量也会被代理，其他的东西也多多少少会受影响，后面可能会换个其它方式吧。 参考 https://post.smzdm.com/p/a25r675q/ https://zorz.cc/post/n1-docker-openwrt.html https://www.right.com.cn/forum/thread-740477-1-1.html https://www.gitmemory.com/issue/kob/N1/2/509879330 https://www.right.com.cn/forum/thread-331363-1-2.html https://www.gitmemory.com/issue/kob/N1/2/509879330 ","link":"https://taosky.github.io/post/n1-coreelec-docker-openwrt/"},{"title":"素人装机及黑果安装配置","content":"2022-07-30更新： 此前已更换OpenCore EFI配置 EFI分区问题，直接在新建一个FAT32的分区，起名EFI，放入EFI引导，也能被主板识别。 装机的念头由来已久，虽然本子还能用，平常也就是看看片，打打撸，不过人就总是有一些尝试的欲望，虽然事后坑索然无味，还是会去追求短暂的快乐。从618到618再到双十一，终于在这次双十一成功装机...... 硬件 装机当然要先确定硬件配置，目标是搞个黑果子，顺便能打打游戏，预算四五千。 首先是阵营的选择，现在好像流行AU + N卡，不过黑果子冇的选，只能是按摩店的显卡（10系以下N卡似乎也可以搞，要新要完美还是A卡吧）；CPU用按摩店的似乎性价比高，不过黑果比较麻烦，据说游戏性能也不如Intel，所以还是选择Intel平台。 CPU 确定了Intel平台，CPU的选择其实很容易，要打游戏选择最主流的i5 9400F，不带核显还能省点钱。（核显涉及到黑苹果硬解的问题，之前的OS X系统即使有独显，没有核显还是不能硬解，而10.14.5 以上版本已经支持独显直接硬解了，所以可以直接选择没有核显的CPU。） 显卡 显卡的选择其实有点尴尬，需要蓝宝石（苹果御用）或迪兰的卡。RX560XT玩游戏不够；RX570、580矿卡泛滥，已买不到全新的卡；580有个新的阉割版（2048SP）基本不能用于黑苹果（据说可以刷vbios，当然这就超出硬件素人的能力范围了）；RX5500尚未发售......最终能选择的只有蓝宝石RX590，这个卡虽然性价比高，比几乎同性能的GTX1660便宜了200左右，但是根据网上的测试功耗比N卡高很多，后面我也自己测了一下，没有网上那么夸张。 电源 有了CPU和显卡就可以确定电源额定功率了，显卡建议电源600w以上，实际上550w就够了（要是1660只要450w，按摩店显卡虽然便宜点，但是电源要贵一点），品牌型号选择风评较好的酷冷GX系列。 主板 首先要关注哪些主板黑果子没问题，最简单的就是去看Hackintosh黑苹果长期维护机型整理清单 ，找同主板的没什么问题的配置就可以了（CPU和显卡都是免驱的，所以关系不大）。我选的是微星360M 迫击炮，这款口碑和销量都不错，群里大佬用了都说好。 硬盘 第一块硬盘好像都选NVME协议的M.2接口固态硬盘，根据预算在主流的里面选一个就行，我用的海康威视C2000 PRO 512G，十年质保（有写入量要求，感觉和车子质保一样），有点后悔没有直接买1T的，更便宜点，512G双系统+装游戏确实有点捉襟见肘，要再加一块硬盘就比较蛋疼了...... 内存 2666频率，哪个便宜买哪个，用的**十铨火神D4 2666 **，2666频率需要在BIOS中开启XMP。 散热器 就我知道几款性价比高的散热器里面选一个，酷冷T400、大镰刀赤兔马（京东没得卖）、玄冰400，然后我搞了玄冰400，对于装机素人来说太难了...... 机箱 开始想用刁丝博，张大妈转了一圈，减钱减到先马平头哥，后来看中了爱国者YOGO，不过好看的机箱散热好像都一般，最后还是平头哥M1。 机箱风扇 平头哥送了一把光环5 LED风扇，不是很喜欢光污染（当然也喜欢不起），自己买了两把先马游戏风暴风扇 配置详情 商品 i5-9400F盒装 B360M MORTAR迫击炮 蓝宝石 RX590 极光 酷冷至尊 GX550 海康威视 C2000 PRO 十铨 火神 DDR4 2666 8G x2 九州风神 玄冰400 先马 平头哥M1 +先马 光环5风扇 先马 游戏风暴风扇 x2 DW1820A + PCI-E转接板（后加） ID-COOLING PL-12025风扇（后装） 安装 应该提前看好教程，边看边装有点慢，不过总体还算顺利。 散热器安装 不愧是反人类400，装了半天，只能是大力出奇迹，把一边扣上，另一边使劲按，不得不说，CPU和主板的还是很牢靠的，不过可能不会再去拆了。。。 风扇安装 风扇侧面有标识提示风向；风扇是没有螺纹的，直接拧就行了；风吹方向用手判断不可靠，要用个纸片测试（装完测试的时候还以为风扇装反了） 之后又安装了一个ID-COOLING PL-12025（风量大又便宜），顺便学习了一下风扇调速的知识，三针风扇接主板后可以使用DC调速（改变电压），四针风扇接主板后可以通过PWM调速（发送信号）。在BIOS中设置智能模式就可以了。 网卡安装 由于需要黑果，后来去淘宝整了一块DW1820A。 蓝牙需要接到主板的USB口，接口有限，只能把前面板的USB2.0口的线拔了，前面板2.0其实也用不到，问题不大。 插到PCIE后灯也是亮的，看起来可以用。开机却只能看到蓝牙，手动装驱动后也并没有识别，问了大佬才知道原来这块主板的PCIE_4和M2_2冲突，把固态硬盘换了个口终于能用了。另外SATA2和M2_1也冲突，暂时没用到SATA2，影响不大。 机箱问题 一分货一分钱，机箱虽然还行，给的螺丝就不太行了，后面板固定显卡和网卡的螺丝根本拧不进去，只能稍微固定上，硬盘螺丝也和硬盘上的孔位不太匹配。 黑果子 系统安装 安装其实和Windows差不多，就是镜像写到U盘然后安装，主要是挑硬件（驱动），如果没什么兼容问题，安装很简单，网上详细的教程一大堆，捡重点讲一下。 在黑果小兵的部落格下载最新的.dmg镜像，用etcher等工具写到U盘里。 找到自己相似硬件的黑苹果EFI配置文件（Clover驱动），可以在Hackintosh黑苹果长期维护机型整理清单里面找找，使用下载好的EFI配置文件覆盖U盘ESP分区-EFI-Clover文件夹，这一步是用现成的驱动防止安装过程出错。 启动电脑，U盘引导，第一次启动需要给磁盘分区，然后就一路下一步。等再次重启后，依然需要U盘引导，因为新安装在磁盘上的Clover是没有加载的驱动的，可能没办法正常启动。选择安装MAC的分区后就可以正常启动了。 启动后需要做的就是把黑苹果EFI配置文件覆盖到磁盘的引导分区中（和覆盖U盘的一样），这样才能通过磁盘正常引导启动。这里需要借助一个应用：**Clover Configurator **,打开后找到Mount EFI，然后找到U盘和系统磁盘，分别挂载，把U盘分区内的EFI-Clover文件夹覆盖到到磁盘EFI分区内的EFI-Clover，做完这一步基本就可以正常使用了。 生成三码 所谓三码就是三个序列号，由于网上的EFI很多人同时用，序列号也是一样的，有时候会造成用不了Facetime、iMessage等功能。使用之前挂载分区用的Clover Configurator生成随机的三码，参考这篇文章。config.plist文件位于EFI分区，需要先挂载，建议备份。生成序列号的时候选择机型需要和自己使用的EFI对应机型一致。 HIDPI 说白了就是Windows上的缩放功能，通过缩放系统UI来适应不同分辨率。由于苹果系统只适配自家的机型，所以只有4K以上具有这个缩放功能。通过仿冒可以在任意分辨率下开启这个功能，一键脚本one-key-hidpi（其实只有2K需要这个功能，1080P用界面会很大，内容也变少）。 Colver界面键盘失灵问题 间歇出现在Colver界面键盘无法使用的问题，进入系统后也无法识别。试了几次发现不是接口问题，用了PS/2转接头（PS/2需驱动）后解决，但是按键有偏差不好用。后来发现BIOS里面默认开启了一个和USB相关的选项，关闭后没有再出现这个情况。 无线和蓝牙 能用的网卡并不多，拆机卡一般比较贵，所以我选择了前面提到的DW1820A，由于是NGFF M.2-WIFI的接口，要插到PCI-E上还要加个转接卡，总共90多，也比拆机卡便宜很多了。这张卡比较玄，部分版本能够在黑果下使用，我用的是w3T3 A00 这个版本的 网卡链接 转接卡链接 驱动安装参考黑果小兵的DW1820A/BCM94350ZAE/BCM94356ZEPA50DX插入的正确姿势，WIFI默认已经驱动了，只要看蓝牙驱动就好了。 Windows 系统安装 毕竟也是要打游戏的，还是需要双系统。 以下为单硬盘安装，双硬盘应该简单一点，直接在另一块硬盘安装就好了。主要是参考这个视频，已经讲得很详细了，照着做没啥问题。 下载系统镜像 可以用微软官方的媒体创建工具，运行后选择生成ISO文件。 关于安装过程，一通折腾都是因为引导，上面是一张安装完成后的分区图，在Windows安装过程中如果引导分区在第三分区，重启时会报错，所以需要在安装前，将Windows引导放到第一分区（备份好原来的文件），在安装完成后再把Windows引导复制到第三分区，恢复第一分区的Colver引导。 安装完可以正常使用，Colver会自动识别出Windows的引导。 A卡插帧 AMD Fluid Motion Video，GCN架构A卡附带功能，据说看动画有效，好像只有Windows可以。 A卡设置-视频-自定义-打开AMD Fluid Motion，AMD steady Video保持关闭。 安装Bluesky Frame Rate Converter（好像需要科学上网），选择MODE2，勾选24p、30P（支持插帧的帧数），然后Enable。 安装Potplayer（官网最新版，不要mini），在设置-滤镜-全局滤镜优先权-添加系统滤镜，选择Bluesky Frame Rate Converter确定，然后右下角优先顺序设为强制使用。开始由于Potplayer版本问题，老是没有那个滤镜，折腾半天才发现版本问题，话说之前添加WebDAV的时候也有版本原因，所以还是官网下载最新的完整版吧。 因为只支持24帧和30帧，所以插帧基本只对电影和动画有效。效果的话，画面变化幅度不大的确实变顺畅了，看动画应该不错；画面变化快的时候就感觉变得更模糊了，动作打斗这种不太适合。当然，电影有一种叫电影质感的东西，用这个可能也会影响到观感，这就见仁见智了。 其它 功耗和温度 Windows和黑果待机都是50W + 播放4K视频，黑果（IINA硬解）80W +，Windows （potplayer硬解）120W + Windows 怪物猎人1080P默认 300W左右 我用的EFI文件的作者说RX580通过修改显卡设置降低显卡功耗，实测4K视频硬解降低30W左右的功耗，但是网页加载会卡一下，打字也有概率卡，体验较差，可能是不适用于590。 参考 https://github.com/andot/MSI-B360M-MORTAR-IMACPRO-EFI https://www.sqlsec.com/2018/09/hidpi.html https://sleele.com/2019/03/21/smbios/ https://www.sqlsec.com/2018/09/hidpi.html https://post.smzdm.com/p/aqnlz0pp/ ","link":"https://taosky.github.io/post/custom-pc-and-hackintosh/"},{"title":"我也买了个N1盒子...","content":"（本文已转载至张大妈） 可能是一个太长不看的N1折腾记录，部分内容冗杂，请选择性阅读... N1本质是某讯理财公司推出的提供一定家庭存储功能的挖矿产品，本质上是Android盒子。由于配置强大，最终在大神破解了Bootloader后，通过刷机实现了各种功能。 网上有关这个盒子文章已是铺天盖地，除了电视盒子，还能充当游戏机、NAS、路由或是一个“纯粹”的Linux系统，各种固件也是非常成熟，不断涨价依旧是300以内最强。 购买 理财系产品已经长期被首富家和东哥家屏蔽，目前可以通过某多多进行购买。全新未拆大概在120多，带T1遥控的+40左右，当时嫌麻烦买了刷好的，看成色果然是二手矿机(￣▽￣)，没有特殊需求的话还是买全新的好了，刷机也没有多困难。 另外某讯官网也开始卖全新P1+遥控器,只要110多（现在只有五台一起卖的），其实是用了新固件的N1，刷机方法不太一样，会折腾的也可以买这个试试。 刷机 N1的固件大体分为两大类：一类是“webpad”、“YYF”等电视盒子类固件，都是官改Android，可以直接刷入eMMC；第二类是基于Linux的“小钢炮”、“Armbian”、“OpenWrt”、“LibreELEC”，似乎只能用U盘引导。 N1刷机主要分为降级+刷机两个步骤，需要的硬件有USB双公头线（写入固件用）、鼠标（点击屏幕用）、Windows PC或平板（平板用数据线即可）`。由于我买的是已刷固件的，再次刷机就不需要降级步骤了，着重说一下怎么刷新的固件，有关降级操作可以看这篇。 自带固件是YYF语音版，没有下载功能，于是我去官网下了个无语音下载版，解压得到.img文件。 下载安装“USB_Burning_Tool”，它会自动安装USB驱动，不过看网上的说法好像还需要在设备管理器添加过时驱动，选择操作-添加过失硬件-从列表选择-libusb-win32-Usb Device。 Adb环境，从谷歌官方下载“platform-tools”即可。 网线连接N1和路由器，USB双工头线连接N1和电脑，打开USB_Burning_Tool，加载刷机包，去掉“擦除FLASH”和“擦除Bootloader”前面的√，点击开始。 ADB连接N1，adb connect “N1的IP”:5555，adb shell reboot update进入线刷模式，N1重启后，USB_Burning_Tool会自动开始写入。 如果没有变化，可能是N1和电脑没有连接识别，听说要用2.0的线，我的比较奇葩，接了个USB延长线才识别出来... 固件问题 在Kodi中查看系统信息，发现温度总是在60多度，CPU的一个核心总是100%，在恩山看到别人也有这样的问题，原来是一个蓝牙语音服务“BluetoothLeService`，通过ES浏览器删除文件就好了。 下载版的YYF固件自带了好多东西，SSH登录后发现好像就是个Linux（Optware），就是装啥啥没有，好吧问题不大，一通操作关闭了“Xware” 、“Aria2”等不想用的功能，然而还是有残留... 自带的Web管理就是“Lighttpd” + “PHP”，索性把PHP删了后，用Lighttpd的dir-listing来浏览文件，还能添加CSS和JS优化一下界面，到添加JS的时候发现版本太老，而Optware也没有新版本，索性重新刷个纯净固件，装上更新的Entware。 Entware Entware大概就是一个给嵌入式设备提供的Linux软件环境，通过它的软件源，可以方便的安装一众适配好的软件。 安装 重新刷了个&quot;YYF无语音实用版（421）&quot;固件，看日志已解决了CPU占用的问题，固件自带了dropbear，也就是可以直接SSH登陆操作，默认root:rush ，端口2223。 安装Entware照理是按照官方教程一步步操作就可以了，但是这里面有一个坑就是“wget”无法正常使用，下面就开始抄作业。 SSH登陆后进行一些准备工作： /system/bin/mount -o rw,remount / mkdir /opt mkdir /bin ln -s /system/bin/sh /bin/sh /system/bin/mount -o ro,remount / mkdir /data/entware.arm mount -o bind /data/entware.arm /opt 接下来需要下载安装脚本进行安装，wget无法使用的问题可以替换“busybox”，原帖，因为没有账号下不了，直接去busybox官网下载二进制文件也是可以用的。mount -o remount,rw /system让/system分区支持写入，将下载的二进制文件覆盖到/system/xbin/busybox，chmod 0755 /system/xbin/busybox修改权限为755。 下载并执行安装脚本wget -O - http://bin.entware.net/armv7sf-k3.2/installer/alternative.sh | sh，提示增加环境变量（程序执行路径），修改.profile，在PATH中新增路径，完成后如下 export PATH PATH=/system/bin:/system/xbin:/opt/bin:/opt/sbin/ 4.软链接到DNS解析的文件ln -s /system/etc/resolv.conf /opt/etc/resolv.conf 5.创建开机初始化的脚本，新建/data/entware.arm/init.sh，内容如下 #!/system/bin/sh unset LD_PRELOAD unset LD_LIBRARY_PATH sleep 3 /system/bin/mount -o rw,remount / sleep 1 /system/bin/chmod 0777 /data/entware.arm /system/bin/mkdir /opt /system/bin/mkdir /bin ln -s /system/bin/sh /bin/sh /system/bin/mount -o ro,remount / sleep 3 /system/bin/mount -o bind /data/entware.arm /opt /system/bin/mount -o bind /data/entware.arm/root /system/etc/dropbear sleep 2 /opt/etc/init.d/rc.unslung start 编辑/system/bin/lazy-start.sh，在exit 0 前加入 sleep 1 /data/entware.arm/init.sh &amp; 此时Entware就安装完成了，重启N1就可以SSH登录安装需要的软件包了。 Lighttpd 用来做一个HTTP的目录浏览，以及WebDAV方便各个设备使用。 opkg install lighttpd 安装完成后，编辑/opt/etc/lighttpd/lighttpd.conf，增加dir-listing的配置，不用样式和脚本的可以注释掉，默认目录在/opt/share/www dir-listing.encoding = &quot;utf-8&quot; server.dir-listing = &quot;enable&quot; dir-listing.external-css = &quot;/dir.css&quot; dir-listing.external-js = &quot;/dir.js&quot; 安装WebDAV模块opkg install lighttpd-mod-webdav，编辑/opt/etc/lighttpd/conf.d/30-webdav.conf，默认有个模板了，主要是修改目录，我这里是用的share目录，webdav.sqlite-db-name是数据库文件路径，有需要也可以修改。 $HTTP[&quot;url&quot;] =~ &quot;^/share($|/)&quot; { ## ## enable webdav for this location ## webdav.activate = &quot;enable&quot; ## ## By default the webdav url is writable. ## Uncomment the following line if you want to make it readonly. ## webdav.is-readonly = &quot;disable&quot; ## ## Log the XML Request bodies for debugging ## #webdav.log-xml = &quot;disable&quot; ## ## webdav.sqlite-db-name = &quot;/opt/share/www/share/.lighttpd-webdav.db&quot; 配置用户认证，如果要开放到外网的话，最好还是加上。新增一用户文件/opt/etc/lighttpd/lighttpd.user，每行一个账号密码，用&quot;:&quot;分隔。接着编辑/opt/etc/lighttpd/conf.d/20-auth.conf，将auth.backend设为plain，auth.backend.plain.userfile指向刚才新建的用户文件，设置目录等信息。 auth.backend = &quot;plain&quot; auth.backend.plain.userfile = &quot;/opt/etc/lighttpd/lighttpd.user&quot; #auth.backend.plain.groupfile = &quot;/etc/lighttpd/lighttpd.group&quot; #auth.backend.ldap.hostname = &quot;localhost&quot; #auth.backend.ldap.base-dn = &quot;dc=my-domain,dc=com&quot; #auth.backend.ldap.filter = &quot;(uid=$)&quot; auth.require = ( &quot;/share&quot; =&gt; ( &quot;method&quot; =&gt; &quot;basic&quot;, &quot;realm&quot; =&gt; &quot;please enter password&quot;, &quot;require&quot; =&gt; &quot;valid-user&quot; ), ) /opt/etc/init.d/S80lighttpd restart重启服务。 Transmission 安装opkg install transmission，修改配置文件/opt/etc/transmission/settings.json，配置参数解释可以参考这里，我主要是下PT，对于PT来说一般关闭DHT就可以了。 替换WebUI，默认的Web界面（9091端口）太过简单，使用transmission-web-control进行替换，下载release里面的包，用src里面的文件覆盖到/opt/share/transmission/web/，移动端还是老的UI。其实也可以使用transgui这样的本地软件来远程管理。 transmission-web-control的作者的另一个项目PT助手提供更好的搜索和下载体验，通过配置好transmission RPC服务地址，可以在搜索资源后一键远程下载。 如果遇到PT站“可连接”显示否的，可以在路由器上手动映射51413端口。 刚发现有个问题，下载的时候有一定概率使Tansmission变卡，页面打开很慢，看了下可能是ntfs-3g性能问题，如果硬盘用Ext4格式可能会有所改善吧（好像不会自动挂载）。有个更奇怪的影响是，Android下各种app都会播放不了视频，即使停止了transmission也不行，必须重启N1才能恢复正常... Shadowsocks+Privoxy 开始只是想在电视上看Youtube，试了多个上网APP发现都不行，可能是系统阉割了什么东西，只能曲线救国。 Android WiFi设置那里可以使用自动代理（pac），这样只要跑 个“ss-local”再生成个pac就好了，然而我用的有线连接没有这种操作。在网上找到Android有个命令可以设置全局http代理，于是想到了用Privoxy转换Socks5代理及分流。 安装opkg install privoxy shadowsocks-libev-loacl。修改/opt/etc/shadowsocks.json配置shadowsocks服务器，这里不作详细说明。 使用gfwlist2privoxy将gfwlist转换为Privoxy的规则（需要一个能跑python的机器）。 pip install --user gfwlist2privoxy wget https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt ~/.local/bin/gfwlist2privoxy -i gfwlist.txt -f gfwlist.action -p 127.0.0.1:1080 -t socks5 将生成的gfwlist.action拷贝到/opt/etc/privoxy/，修改/etc/privoxy/config，加上一条 actionsfile gfwlist.action /opt/etc/init.d/S24Privoxy restart重启生效，接着执行settings put global http_proxy 127.0.0.1:8118设置全局代理。 要开机自动设置代理可以编辑/opt/init.sh这个初始化脚本，把上面那条命令加在最后。 Frp Server 用来中转Mtproxy，直接从Github下载二进制包解压执行，要开机自起可以参照 /opt/etc/init.d/内的启动脚本，主要是两个参数PROCS:命令名称，ARGS:执行参数（需要把二进制程序放/opt/bin/下），关于启动脚本的命名，“S”后面的数字是启动顺序，一般选择靠后的没有被用掉就可以了。 Caddy 最后把Lighttpd换成了更好用的&quot;Caddy&quot;，最直接的好处是browse文件浏览体验比原来好很多，加上TLS、WebDAV、反代一条龙服务，配置起来很方便，就是开始用会碰到了几个坑。 坑一是由于不能80端口，申请证书要用dnspod插件，需要设置密钥的环境变量，目前还没发现Entware怎么在启动脚本里加上环境变量，只能在shell里面手动启动；坑二是域名设置了cname会导致证书申请失败，折腾了好久改成A记录就好了；坑三是browse不支持软链接，只能把子路径另开一个server；坑四是WebDAV不能和browser同一Web路径，会返回xml，另外WebDAV不能另开server，在某些客户端会405。 其它 Entware还有许多实用软件包可以安装，也可以看做一个Linux机器使用，自己下载一些二进制包用，或是跑跑Python、Node之类的。不过它始终不是一个完整的Linux，比如用来编译估计比较困难，可能缺少某些依赖。 Android App Kodi 看片必备，主要用来播放“transmission”下载的电影、电视。关于设置什么的网上有很多教程，这里讲一下使用中的几个问题。 削刮器：中文削刮器插件似乎都失效了，自带的削刮器也还行，不过要注意命名方式，我是每个下载新建一个目录，用豆瓣上的名字命名，削刮器设置电影在独立文件夹中。这个方法在老电影和剧集上不太适用。剧集使用纯外文命名好像比较容易挂出来，老电影还是自己扫描一下。 电视播放：需安装“PVR IPTV simple client”，节目源是很容易实效的东西，据说可以替代运营商的盒子来播放IPTV，由于我没有IPTV（准备有线电视到期了搞一个），没有实际操作过，可以参考这篇文章章节3.3。 miniBD播放问题：播放miniBD暂停退出后再次播放会卡，且声道无法修改，不清楚是不是个例。 Smart YouTube TV 第三方Youtube客户端，不需要谷歌全家桶，功能完整无广告，第一次启动会让你选择版本，包括1080 Main、1080 Alt 、4K Main、4K Alt，官网的说明是“They may have different performance depending on the device. Try launchers one by one until you find best one. ” emmm...我选了1080 Main 感觉播放有点卡，可能是没有硬解。试了Alt版本需要安装一个额外的app，直接下还不行，之后再研究看看。 关于科学上网参考Entware章节中的&quot;Shadowsocks+Privoxy&quot;。 Bilibili TV Bilibili电视版没有弹幕，一部分视频还看不了（不知道是什么操作），说实话用这个App还不如手机投屏(ノ｀Д)ノ。不过万能的网友找到了旧版本安装包，所有视频都可以播放，而且有弹幕可以看。 ) ) 乐播投屏 YYF固件已经自带了，投屏还是不错的，没有明显的画质下降，只是有广告。Airplay会卡顿尽量还是用DLNA（视频app里面的应该是这个）吧。另外投屏过程据说会产生大量缓存，清理还比较麻烦。 遥控器 N1的遥控器选择很多，从App到蓝牙遥控到无线飞鼠，五花八门。 斐讯遥控器App 官方出品的遥控App，有按键滑动几种模式，还能截图保存，就是每次都要用手机有点麻烦。 T1遥控器 T1盒子带的遥控，完美开关N1，还可以使用语音控制。价格较贵，外观较丑，听说手感不错，价格在35以上。 其他品牌蓝牙遥控器 如果有限制的盒子遥控器可以用一下，几乎都是通用的，一般通过加入按键文件也都能成功控制。不过此类遥控通常不能开机，电源按钮也可能变成重启而不是关机。另一个问题就是像小米这种品牌的遥控手感做工都比较好，但是单买价格贵，而山寨遥控手感和做工不尽如人意。 2.4G无线遥控 和无线鼠标差不多，需要接收器。无线飞鼠、YYF店里卖的无线遥控都属于这一类，弊端和蓝牙的差不多，没办法开机，据说延迟也比较严重。 红外遥控 需要插个接收器，YYF店里也有卖，因为用USB，应该也是没法开机的，好像也没什么非要用红外的理由... HDMI CEC N1默认开启这个功能，这个东西再各个品牌电视上名字可能不一样，但本质是一样的，都是通过HDMI控制设备，这样就可以用电视机遥控器去控制N1了。在家里的松下电视机上试了一下是可以的，上下左右、返回、确认及数字键都能正常使用，只是少了个菜单键。然而当我再接一个电视机顶盒就不能使用了，坑！每次开电视机需要把另一个HDMI线拔了才能开启这个功能。还是要另搞一个遥控器。 最终选择 最后看见论坛有人提到小熊的Verizon遥控（网搜青州小熊有真相），做工手感都极佳只要15/16块，算上运费就是22/23，就买了这个。 实际体验感觉不错，播放控制的几个按钮也是可以使用的，最下面的按钮是主页键。唯一缺点就是不能开机还有就是不知道蓝牙一直连着会不会有点费电，发现一段时间不用第一次按键会先激活，可能有省电效果。 功耗和发热 N1功耗据说是很低的，正好之前买了测功耗的插座，用来看一下。 空闲：功耗3.2-3.5W Kodi播放1080P视频：4.6-5.3W Bilibili：5.5-5.8W Youtube：5.9-6.3W 这个功耗应该可以说是很低了，看了家里的有线电视盒子基本在15W以上。。。 N1发热比T1好很多，在室温29度情况下待机48度，播放视频在68-72度，感觉还是有点热。买了一个USB小散热风扇，温度直降10度。就是声音有点大，接个电阻或二极管应该能改善，目前用WIFI插座跑个脚本根据温度自动开关。 总结 作为一个一百多价位的盒子硬件不落后，可玩性高，可以说是垃圾佬必备了。 参考 https://post.smzdm.com/p/aoo6q09n/ https://pockies.github.io/2019/03/07/phicomm-n1/ https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=669258 http://www.iwil.club/90.html https://www.right.com.cn/forum/thread-323838-1-1.html https://blog.whsir.com/post-1182.html ","link":"https://taosky.github.io/post/N1/"},{"title":"Homebridge延时操作","content":"没有家庭中枢的homekit没办法定时任务，其实有几种方法是可以达到这一目的。 原始方法 第一个方法就是crontab定时执行命令，比如之前怕忘记关空调，crontab设定11点lirc发送关机指令。因为是执行命令，要控制米家的设备的话，需要安装miio库调用，其他厂商同理。这个方法不能设定延时，而且没办法在homekit中使用，或是siri触发。 第二个方法是使用homebridge-command之类的，通过一个开关来运行命令/脚本，在脚本中可以自己设定延迟，这个操作虽然能够延时并在homekit中操作了，但是没办法在延时结束后自动关闭，也就是说它的状态是不正常的。 稍微好用的方法 最近发现一个插件叫homebridge-cmdtrigger，这个插件是生成一个开关，打开后可以在运行命令之后延时一段时间关闭自动开关，这个开关时延时了，命令没有延时。。。好在代码简单，提交了一个一个PR，加入一个execAfterDelay的选项，可以在延时之后执行命令。基本就达成我的需求了。 有一个很方便的用法就是可以添加到场景里面，比如“打开空调+延时10分钟关闭风扇”，形成一个简单的联动。 问题 有一个最大的问题就是这些方法最终都是执行命令。对于米家这种实体设备来说，homekit是可以获得它的状态的，比如延时关闭风扇以后，homekit获取风扇状态，把它更新为已关闭；而对于一些命令，比如lirc控制空调，在执行完之后，空调这个组件的状态是不会更新的，导致比较混乱。 ","link":"https://taosky.github.io/post/homebridge-delay-switch/"},{"title":"树莓派驱动SSD1306 OLED屏幕","content":"其实用了很久了，最近才写。https://github.com/Taosky/SSD1306 在V2EX看到有人用树莓派做了一个发呆用的小屏幕，就也搞了一个，淘宝挑屏比较纠结，后来看到有家店卖OLED屏,于是就买了。 到了之后发现还是很小的，0.96寸，看新闻好像不太行，就显示温度时间什么的就好了。 准备 首先是连线，支持3.3V~5V，VCC接3.3V，GND接GND口，SDA接GPIO3，SCL接GPIO2，（看网上都是接这两个） 由于采用I2C通信，需要打开树莓派上的I2C功能。 sudo apt-get install -y python-smbus sudo apt-get install -y i2c-tools sudo raspi-config 选择Interfacing Options-I2C打开。 运行sudo i2cdetect -y 1测试能不能看到I2C的地址，如下就是成功获取地址了。 驱动 卖家提到的Github上的项目是Node写的，看不大明白，根据上面的信息搜了SSD1306找到一个叫luma的Python库可以驱动这块屏幕。 在luma.example中有一些示例可以学习。 首先要理解几个概念： 1.要在屏幕上显示内容可以理解成是在”画布“上画图，再将画布显示出来。因此在显示文字的时候也是传输的图而不是文字本身，需要选用字体显示。 2.变化屏幕上显示的内容需要用一张新的“画布”覆盖，如果不进行覆盖，屏幕就一直显示当前的“画布”，除非对它发送指令关闭。 3.因为是画布，所以可以显示我们所需要的任意内容，文字、图形、图像都是可以显示的。 显示文字的话调用draw.text，使用正确的字体就可以了，可以控制字体大小、颜色等参数。 这里在导入字体的时候设置字号为21，绘制字体的时候指定字体并设置了显示位置（可以根据128x64计算确定大概的位置），time.sleep(8)让程序休眠8秒，也就是让“画布”保持8秒不被后面的画布覆盖。 font_path = os.path.abspath(os.path.join(os.path.dirname(__file__), 'fonts', 'code2000.ttf')) # 导入字体文件 font1 = ImageFont.truetype(font_path, 21) with canvas(my_device) as draw: draw.text((32, 0), '树莓派', font=font1, fill=&quot;white&quot;) draw.text((20, 21), sensor_data_to_show[0], font=font3, fill=&quot;white&quot;) time.sleep(8) 显示图像稍微复杂一点，以天气图标和温度的显示作为示例。 首先是导入图像，然后将图像转换成RGBA模式，创建一个适配设备的空白图像，将要显示的图像“粘贴”到空白图像上；这时还需要一个温度文字的显示，通过类似的方法，将文字画到图像上就完成了。最后使用device.display()显示图像（我也不知道为啥是display(+_+)?） icon_path = os.path.abspath(os.path.join(os.path.dirname(__file__),'weather_icon', '200.jpg')) weather_icon = Image.open(icon_path) inverted_icon = ImageOps.invert(weather_icon).convert(&quot;RGBA&quot;) weather_image = Image.new(&quot;RGBA&quot;, device_size) weather_image.paste(inverted_icon, (0, 0)) draw = ImageDraw.Draw(weather_image) draw.text((66, 12), '32℃', (255, 255, 255), font=font2) my_device.display(weather_image.convert(my_device.mode)) 至此基本就解决显示图像的问题了，当然这只是最简单的显示，比如luma示例里面的时间显示就很复杂。 问题 亮度似乎无法调低，通过device.contrast()设置为1好像还是很亮。 参考 http://shumeipai.nxez.com/2019/04/29/use-the-ssd1306-oled-display-on-the-raspberry-pi.html http://shumeipai.nxez.com/2017/09/13/solve-the-raspberry-pi-drive-oled-problem.html https://luma-oled.readthedocs.io/en/latest/_modules/luma/oled/device.html 还有别的链接找不到了 ","link":"https://taosky.github.io/post/SSD1306-OLED/"},{"title":"日语学习笔记第0课","content":"之前是因为有笔记，想把笔记变成文档，所以从初级下册开始记录。由于长时间没看，从最基础的开始写起顺便复习一下吧。 当然，我也只是个初学者，如有问题请指正。 基础知识 日语文字基本就是汉字和假名组成，经常看到一句日语里面有些是看得懂的汉字，剩下的看不懂的歪歪扭扭的就是假名了。 假名分为片假名和平假名，适用不同情况，比如外来语大都用片假名表示，这里不做展开。片假名和平假名一一对应，读音也是一样的，形成“五十音”。五十音其实就是日语的拼音，用来确定汉字的发音，同时也能单独使用。可以说学习了五十音就可以在有注音的情况下读日文了，就和小学读注音课本一样。 下面这个示例中有汉字和数字也有假名，其中“每”对应的假名拼音就是“まい”，读作“ma i”，同理可得其他汉字和数字的对应假名和读音，这样可以阅读这句话了。 有关五十音的读音和假名的书写可以看一下沪江做的这个页面：https://jp.hjenglish.com/subject/pronounce/ 字形记忆的时候可以联想相似的汉字。 入门 发音 五十音分为清音浊音/半浊音和拗音。清音就是最基础的读音；浊音/半浊音在拗音的基础上进行变化，同时假名也发生变化；拗音两个音组合成新的读音，一大一小两个假名连在一起就是拗音了。 五十音的行和列需要分别记忆，第一行的“あ”、“い”、“う”、“え”、“お”是元音，以此可以划分五个段，也可以按行划分成多个行。之后的许多变化就是根据行和列作为规则确定的。 拨音、促音、长音。 拨音就是ん，比如称呼某某人的时候，XX君的君就读作“くん”； 促音就是在读一个词的时候有所停顿想发下一个音,但是不发,停一拍,这个期间发声部位不是放松的,然后下一个假名发音（感谢评论区某不愿透露姓名的狐基指正）,和”停顿”之后重新发音,是有区别的，书写上用一个小っ来表示，比如“さっか”作家，而没有促音就是另一个单词了，促音只发生在“か”、“さ”、“た”、“ぱ”行之前，这个不用记忆，读多了自然形成语感； 长音就是对音进行延长，如“サッカー”足球，前面是一个促音，后面是一个长音，平假名书写时使用“ー”，“いいえ”不，い属于“い”段，所以加上一个“い”即可，而“くうる”乘飞机，“く”属于“う”段，所以加上“う”表示长音。 书写 前面说到日文基本由汉字和假名组成，而这里的汉字其实和中国使用的汉字是有区别的，有些是繁体写法，有些发生了变化，如“勉強”，“強”这个字和我们认识的是不一样的，且整个词的意思也不是勉强，而是学习。 日文的标点符号和中文英文也有很大区别，日文的“，”和“、”没有区别，竖写时只能用“、”，且使用没有什么严格规定，句子太长或连续书写容易产生误解的情况下都可以使用；“「 」”代表单引号；一般句子结尾都用“。”，包括感叹句、疑问句，很少使用“？”或“！”。 声调和语调 老外说汉语大概就是因为声调语调所以很奇怪吧，这个现在也不是很懂，对于初学者也不是重点，有机会再补充。 ","link":"https://taosky.github.io/post/japanese-learn-note-0/"},{"title":"组装小音箱","content":"就是简单的组装。。。 清单 这里面的线有的话其实就不用买了，喇叭上的线可以让老板焊一下。 材料 价格 4欧3瓦的两寸喇叭 x2 19.8 两寸喇叭木箱 x2 24 + 10 5V功放板 18.8 3.5mm公对公音频线 9.9 USB公对公线 3.9 成品 简单的连线（左右省道正负极弄清楚就好）测试一下声音，不放箱子里面的话声音有点小。 这木箱还是不错的，装上效果就不一样了，虽然听不到加州旅馆第五排的掌声，比笔记本的喇叭不知道高到哪里去了。 实测用笔记本USB供电会有电流声，用充电头就没有这个情况 。除了这个暂时没发现别的问题，应该还是挺值的，要是有以前收音机拆的喇叭啥的自己弄一弄可能更快乐一点。 ","link":"https://taosky.github.io/post/diy-speaker/"},{"title":"Kodi 18 on Pi Zero W","content":"Kodi是一个跨平台的播放器，可以运行在Linux发行版、Android、Windows等平台，看到很多人装在树莓派上用，于是也试了一下。虽然zero w性能比较差，但是GPU是一样的，可以硬解1080P30帧的视频，还是比较厉害的。 安装 有一些Only For Kodi的发行版，如LibreELEC，应该是专门对Kodi进行了优化，但是也只能用于Kodi。因为我的PI还要用来开开空调啥的，所以就还是手动安装在Raspbian上。 安装Kodi程序 apt install kodi 安装pvr client（貌似是看直播用的，暂时没用到） apt install kodi-peripheral-joystick kodi-pvr-iptvsimple kodi-inputstream-adaptive kodi-inputstream-rtmp 创建一个服务 $ sudo tee -a /lib/systemd/system/kodi.service &lt;&lt;_EOF_[Unit]Description = Kodi Media CenterAfter = remote-fs.target network-online.targetWants = network-online.target[Service]User = piGroup = piType = simpleExecStart = /usr/bin/kodiRestart = on-abortRestartSec = 5[Install]WantedBy = multi-user.target_EOF_ 随系统启动 sudo systemctl enable kodi 没有开关控制kodi关闭开启，我写了个web服务，然后用IOS捷径请求来控制。 启动 通过HDMI和电视连接，由于zero w是mini hdmi借口，需要一个转接头。 修改/boot/config.txt， 取消注释hdmi_safe=0。一开始没有这么操作，启动了很久也没画面。 修改/boot/config.txt，加入gpu_mem=280，这个是分配给GPU的内存，否则播放不了视频。 然后重启PI，应该就可以看到画面了。 基本配置 当然要先插个键盘才能操作，基本就用到上下左右回车和ESC。 第一步要修改语言，进入设置-Interface-Skin，Font更改为Arial Based，然后进入Region，Language选简体中文就好了，不改字体会乱码。 用键盘操作不是长久之计，KODI是可以通过手机控制的，进入设置-服务-控制，允许HTTP远程控制，允许通过异地程序控制，在手机应用商店搜索kodi，IOS上是Kodi Remote，应该可以检测到KODI，连接后就可以愉快操作了。除了按键功能还能用手机输入法输入字符，控制当前播放。 用的720P分辨率在我的1366*768上有些超出边缘，在界面-皮肤里面有个“满屏”，设置成-4%就刚刚好了，不过播放视频的时候还是有这个问题。 视频播放 设置完这些东西就可以尝试播放了，进入文件区-添加视频，这边就可以添加很多视频源，包括本地、SMB、NFS等，添加了之后会提示属于电影还是什么，就会通过“电影刮削器”进行匹配（默认是用的TMDB，我们可以在插件里面安装mtime、douban这样的刮削器来显示电影的中文信息。) 回到主页就可以看到电影海报了，这时候就可以播放了，看了一下常规的720P视频是没问题的，小一点的1080P也是可以的，大的文件应该就不行了(50分钟2.97G的播放卡顿)，毕竟I/O太差，根本来不及加载。 插件 Kodi的插件还是很丰富的（基于python比较好写吧），不过也很容易失效，试了一些，很多是bs4爬虫的，已经失效了，想看国内视频网站还是有点困难的。 Kodi插件可以通过本地zip包安装，也可以通过库安装，自带一个官方的库，mtime刮削器在官方的库里面就有，也可以添加网上的库。 好像还有一些需要安装系统的软件包，比如我用的SFTP，从Kodi中移除了，树莓派安装kodi-vfs-sftp这个包，重启Kodi启用插件就能添加SFTP的视频源了。 直播 这个大概就是添加M3U8的视频链接来播放，这种东西很容易失效，有机会再研究一下。 DLNA投屏 Kodi只支持Airplay的声音传输（毕竟苹果不开放，不过有些国产投屏好像可以），所以还是用Dlna就好了，打开服务里面的DLNA，Windows上右击视频播放到设备里面应该就可以显示了。 嫌麻烦的话手机app也是可以的，IOS上可以用nplayer，可以播放器控制，也可以用遥控app控制，还是很实用的。DLNA好像还是把视频传到服务端去解码，所以对于大容量视频卡顿并没有改善。 Android电视上的Kodi 一看我的树莓派都能跑，这个电视本身也跑动的Kodi吧，于是就尝试了一下。 Android4.0.4就只能用Kodi14了，安装了以后界面感觉比新版还舒服一点，一通操作后，发现放视频卡顿，怀疑是SMB的问题，用U盘放了一下还是卡顿，应该就是不支持硬解了，看来适配还是个问题。 网上搜了一下，发现有调用外置播放器的操作，见Wiki。 虽然外置播放器可以解决硬解问题，MX Player这样的播放器很多是不支持SMB等协议的，有人说可以用Mount Manager挂载到本地，试了一下也没有成功，可能是电视问题。 顺便吐槽一下Android电视，操作太麻烦，定制性强，很多东西用不了，硬件跟不上。之前开机变砖相当显示器用都不行，传统电视机+盒子才是趋势啊。 参考 https://blog.ibeats.top/2018/05/20/kodi-pvr.html https://magicmagnet.me/blog/DLNA%E6%8A%95%E5%B1%8F%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97/ https://forum.kodi.tv/showthread.php?tid=338204 ","link":"https://taosky.github.io/post/kodi/"},{"title":"更换Disqus评论为Valine","content":"偶然看到Valine这个评论系统，很简洁还支持Markdown，而disqus一堆东西还要番茄，遂换之。 Valine的使用方法 现在只支持LeanCloud，所以要先注册LeanCloud（以前创建的应用几年了还在，挺稳定的），然后创建应用，在设置页面复制App ID和App KEY备用。 去这个页面找找用的主题有没有支持，Next主题是直接支持的，在配置文件里面开启并添加ID和KEY就可以了。 从Disqus转移 Disqus提供XML格式的数据导出，想办法再导入就可以了。 开始用的这个工具，大概是由于很老了不支持楼中楼，时间也是错误的。于是自己根据LeanCloud的API用Python转移了一下，后面写了这个:https://taosky.github.io/disqus-to-valine/ 不过还是有些问题，导出的数据没有邮箱、网站（大概是因为GDRP），没有邮箱也不能显示Avatar头像了。 后台管理及通知 用的老的转移工具的作者的另一个工具Valine Admin。主要是在LeanCloud存放Valine的应用内部署，可以查看评论，邮件通知用的SMTP，比Valine自带的LeanCloud的邮件好很多。 安装步骤参考原文就可以了 ","link":"https://taosky.github.io/post/disqus-to-valine/"},{"title":"配合Travis-CI将博客转移至Firebase Hosting","content":"近期Coding Pages老是抽风，所以想换一个地方托管博客，Firebase是谷歌搞的一个云服务（没错 没被墙），据说和Github Pages一个CDN服务商，感觉还是比Gayhub更快一点。 Firebase Hosting Firebase Hosting自带SSl，算是很方便了，1G存储和10G月流量对于博客来说足以；不过也有一些缺点，手动部署需要用到他的命令行工具会比较麻烦而且需要番茄（后面会讲自动化的部署），试了一下把图片放上去加载特别慢，所以图片存储还是用coding的吧。 添加项目、绑定域名这些就不再赘述，可以参考其他文章。 Travis-CI自动化部署 这个其实比较麻烦，但是一劳永逸。Travis-CI说白了是一个追踪你的Github项目触发自动化操作的东西，整个Hexo博客目录作为一个Github项目，每次更改Push之后Travis-CI会自动运行hexo g还有部署到Firebase的一些命令，结束之后，你的博客就已经更新了。 其实也有很多其他文章讲到，讲一下我遇到的一些问题。 Firebase Token获取 运行firebase login:ci --no-localhost来授权获取TOKEN的时候无论是git-bash还是powershell都不能成功。 最后只能在VPS上操作，将出现的地址在本地浏览器打开，登录谷歌帐号后就会显示TOKEN了。 主题变成子项目 由于主题中包含的.git目录，提交的时候会被自动理解为子项目，可以手动略过这个目录一个个添加，也可以直接把目录删掉。 多个Firebase Hosting 一开始是设想把图片自动部署到另一个Firebase Hosting，Firebase部署的时候会读取firebase.json，不能手动指定，而且这个文件也只能指定一个Hosting。 要想多个需要切换目录，在包含图片文件夹的子目录中加入firebase.json指定另一个Hosting，而且不能用Travis自带的Firebase功能，要安装然后使用命令firebase deploy --non-interactive --project ${FIREBASE_PROJECT} --token ${FIREBASE_TOKEN} 不过由于图片加载速度太慢后面也没有再用了。 Coding Pages存图片 大致和Github差不多，需要获取一个Token，然后就可以Push了。新建令牌，git push -f &quot;https://{CO_ID}:${CO_TOKEN}@${CO_REF}&quot; master:master ，比Github多了个ID。 完整的.travis.yml内容 可以按需求添加其他的命令。 sudo: required language: node_js node_js: &quot;10&quot; branches: only: - master before_install: - npm install hexo-cli -g - npm install -g firebase-tools install: - npm install script: - cd public_assets - git config user.name &quot;Taosky&quot; - git config user.email &quot;t@firefoxcn.net&quot; - git init - git add . - git commit -m &quot;add assets&quot; - git push -f &quot;https://{CO_ID}:${CO_TOKEN}@${CO_REF}&quot; master:master - cd ../.. - hexo g &amp;&amp; hexo douban - firebase deploy --non-interactive --project ${FIREBASE_PROJECT} --token ${FIREBASE_TOKEN} 参考 https://blog.chrnie.com/2018/03/08/%E4%BD%BF%E7%94%A8-Travis-CI-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2-Hexo-%E7%94%9F%E6%88%90%E7%9A%84%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E5%88%B0-Firebase-Hosting/ https://medium.com/@bartwijnants/continuous-deployment-to-firebase-hosting-using-travis-ci-e7d9c798ead4 https://rainylog.com/post/firebase-tutorial/ https://blog.erguotou.me/hexo-on-firebase.html ","link":"https://taosky.github.io/post/tansfer-blog-to-firebase-hosting-with-travis-ci/"},{"title":"LIRC红外控制空调接入HomeBridge","content":"https://github.com/Taosky/homebridge-lirc-aircon 可以直接看README，下面讲的比较啰嗦。 过程 因为转移到HomeBridge，找了一圈没找到MQTT协议（之前HomeAssistant用的）的插件，后来发现一个有些类似的但是很奇怪的插件，好在代码终于能看懂，就修改了一下。 首先之前的插件是用的每个按键单独指令的控制方法，而平常用的空调都是一个指令发送所有数据。原先是 “加减2度”这种调整温度的方法，关机开机的操作也都是单独的，删除了其中转换温度差的过程，修改为直接发送对应温度相应指令。 其次原来是用的‘htu21d’或是‘dht22’这两个传感器，再通过i2c-tool获得的房间温度，而我其实用的是‘DS18B20’。于是修改为command形式的获取温度信息，也不用专门配置别的工具了。 最后删除了一堆配置参数和湿度控制华氏度之类的东西。 配置 首先要确保你的指令名字和我是一样的，比如制热24摄氏度是heat_24，制冷19摄氏度是cool_19，关闭是off，就是确保以下命令工作： OFF MODE: irsend SEND_ONCE YOUR_DEVICE_NAME off HEAT MODE: irsend SEND_ONCE YOUR_DEVICE_NAME heat_CELSIUS_TEMP (ex: heat_24) COOL MODE: irsend SEND_ONCE YOUR_DEVICE_NAME cool_CELSIUS_TEMP (ex: cool_19) 这样之后其实只要设置红外设备名字ir:{&quot;name&quot;: &quot;&quot;}就行了。 temp节点用于设置获得房间温度的命令，multiple是除数，比如命令结果的是16500，就需要设置为1000来得到温度数值16.5摄氏度，没办法获得温度需要删除整个temp，房间温度将会默认为20摄氏度。 最高温度、最低温度取决于你录制的空调温度区键，比如我把16-30摄氏度的制冷制热全部录制了一遍，defaultSetpoint是启动HomeBridge时默认设定温度。 { &quot;accessories&quot;: [ { &quot;accessory&quot;: &quot;aircon-ir-remote&quot;, &quot;name&quot;: &quot;Air Conditioner&quot;, &quot;minSetpoint&quot;: 16, &quot;defaultSetpoint&quot;: 20, &quot;maxSetpoint&quot;: 30, &quot;ir&quot;: { &quot;name&quot;: &quot;lirc_device_name&quot; }, &quot;temp&quot;: { &quot;command&quot;: &quot;cat /sys/bus/w1/devices/28-01131650xxx/w1_slave |grep t= | cut -d '=' -f 2&quot;, &quot;multiple&quot;: 1000 } } ] } ","link":"https://taosky.github.io/post/homebridge-lirc-aircon/"},{"title":"使用HomeBridge","content":"直接原因是HomeAssistant升级之后有些功能失效了，这个东西本身配置又复杂、功能也用不到，索性就换成HomeBridge。 由于没有“家庭中枢”，部分远程操作就用米家App代替，功能还多一点（定时之类的），其他设备后面可能考虑搞个TG机器人啥的。 安装 其实之前写过，安装node包启动就行了。 npm install homebridge -g 全局安装的问题，需要修改默认路径：https://stackoverflow.com/a/19170697 编辑配置文件 vim .homebridge/config.json { &quot;bridge&quot;: { &quot;name&quot;: &quot;Homebridge&quot;, &quot;username&quot;: &quot;A7:22:EB:1B:9D:31&quot;, &quot;port&quot;: 55234, &quot;pin&quot;: &quot;012-34-567&quot; }, &quot;accessories&quot;: [], &quot;platforms&quot;: [] } 简单启动就执行 homebridge，做成服务自动启动比较好。 手机添加就不说了，输入PIN或者扫码就行。 米家 安装米家插座和yeelight灯的包 npm install homebridge-mi-outlet homebridge-yeelight 修改配置文件 &quot;platforms&quot;: [{ &quot;platform&quot;: &quot;MiOutletPlatform&quot;, &quot;deviceCfgs&quot;: [ { &quot;type&quot;: &quot;MiPlugBase&quot;, &quot;ip&quot;: &quot;192.168.x.xxx&quot;, &quot;token&quot;: &quot;xxxxxxxx&quot;, &quot;outletName&quot;: &quot;Plug Two&quot;, &quot;outletDisable&quot;: false, &quot;temperatureName&quot;: &quot;plug two temperature&quot;, &quot;temperatureDisable&quot;: false, &quot;switchLEDName&quot;: &quot;living room led light switch&quot;, &quot;switchLEDDisable&quot;: false } ] }, { &quot;platform&quot;: &quot;yeelight&quot;, &quot;name&quot;: &quot;yeelight&quot; }] 重新启动HomeBridge生效。 插座可以开关指示灯还不错，台灯好像只能调亮度。 LIRC空调 之前在HomeAssistant上是用的LIRC、mqtt控制空调，HomeBridge并没有现成的插件用。后面找到一个类似的LIRC的空调插件，修改了一下终于可以用了。 https://github.com/Taosky/homebridge-lirc-aircon 原来是直接通过传感器模块获得房间温度，改成了可选的命令形式；修改了奇怪的增减模式为一般空调的一个指令模式，简化了设置。 这样总算是把空调功能加上了，再次吐槽一下，让siri关空调居然是设置成自动模式。。。 重新联网未响应问题 路由器重启后，可能手机会未响应，但HomeBridge还在正常运行。 搜了下，很多人都有这问题，应该是自身的问题，打算写个脚本检测联网然后重启HomeBridge服务。 ","link":"https://taosky.github.io/post/use-homebridge/"},{"title":"Python动态加载模块","content":"通过动态加载模块给方便给telegram机器人添加功能。 首先遍历mods目录下指定文件（这里用的glob来匹配文件名），再通过__import__函数导入，需要注意的是fromlist这个参数。 The fromlist should be a list of names to emulate ``from name import ...'', or an empty list to emulate ``import name''. 意思是此处不加这个参数就会导入mods，否则导入mods.*。 # coding: utf-8 import glob import os.path MOD_PATH = 'mods' mod_handlers = [] files = glob.glob(MOD_PATH + '/[a-z]*.py') for filename in files: module_name, ext = os.path.splitext(os.path.basename(filename)) module = __import__('{}.{}'.format(MOD_PATH, module_name), fromlist=['*']) mod_handlers.append(module.handler) 参考 https://pythoncaff.com/docs/pymotw/glob-file-name-rule-matching/110 https://stackoverflow.com/questions/31720874/import-arbitrary-subdirectory-modules ","link":"https://taosky.github.io/post/python-dynamically-import-module/"},{"title":"Telegram机器人的一些记录","content":" 起因是Telegram的中文搜索完全不能用，想通过bot对消息进行记录然后再查询，顺便加上了一个发帖提醒功能。 使用的是python-telegram-bot，还是挺简单挺方便的。 简单说明 主要用到了接受消息的Dispatcher类。 以下是官方文档的介绍： The Updater class continuously fetches new updates from telegram and passes them on to the Dispatcher class. If you create an Updater object, it will create a Dispatcher for you and link them together with a Queue. You can then register handlers of different types in the Dispatcher, which will sort the updates fetched by the Updater according to the handlers you registered, and deliver them to a callback function that you defined. from telegram.ext import Updater updater = Updater(token='TOKEN') dispatcher = updater.dispatcher 记录消息 想要读取消息只要给dispatcher添加处理消息的handler，这里使用的是处理正常消息的MessageHandler，此外还有处理命令的CommandHandler等。 Filter.text过滤文本信息，store_message是处理的函数，传入bot和update这两个参数。 update包含了这次更新的所有内容，主要用到update.message，包括chat_id、message_id、用户信息、消息内容等，见Telegram api文档；bot用于机器人的操作如发送/回复消息，群组操作、修改profile等，和正常用户的权限差不多，这里只读取消息所以没用到。 dispatcher.add_handler(MessageHandler(Filters.text, store_message)) def store_message(bot, update): update.message... '保存到数据库' 查询消息 最早想的是通过命令加搜索内容来查询，但是这样就需要解决列表和分页问题；后来发现了InlineMode这种方便的东西。 Command和InlineKeyboardMarkup 通过带参数的命令查询数据库并发送一条带有按钮操作的消息，这坨代码有点瞎眼。 首先要将结果构建一个InlineKeyboardButton组成的二维数组（列表），代表行列的按钮，还需要在下面加上翻页按钮。每个按钮除了显示的内容，还带有一个callback_data，被点击时会传给回调函数用来处理按钮点击。 用InlineKeyboardMarkup包装，最后通过bot.search_message来发送带有按钮的消息。 dispatcher.add_handler(CommandHandler('search', search_message, pass_args=True)) def search_message(bot, update, args): keyword = args[0] page = int(args[1]) if len(args) &gt; 1 else 1 messages = 获取查询结果 # result button list button_list = [ InlineKeyboardButton( '{} | {} | {}'.format(message['text'][:12] + '...' if len(message['text']) &gt; 12 else message['text'], message['user'], message['time'].strftime(&quot;%Y-%m-%d&quot;)), callback_data='/locate {}'.format(message['id'])) for message in messages ] prev_button = InlineKeyboardButton(...) next_button = InlineKeyboardButton(...) pager = ... reply_markup = InlineKeyboardMarkup(build_menu(button_list, n_cols=1, footer_buttons=pager)) bot.send_message(chat_id=...,text='...', reply_markup=reply_markup) 下面是按钮的回调函数，这里的update.callback_query就是按钮上带的callback_data，解析它得到消息的ID，再从数据库读取这条消息发出来。 如果是翻页的话需要再调用search_message函数查询，这里有个坑，传过去的query是不带chat_id的，所以还是要写死，而不能动态获取。 dispatcher.add_handler(CallbackQueryHandler(locate_message)) def locate_message(bot, update): query = update.callback_query args = query.data.split(' ')[1:] # change page if query.data.startswith('/search'): search_message(bot, query, args=args) # locate message elif query.data.startswith('/locate'): msg_id = int(args[0]) target_message = 根据msg_id从数据库获取这条消息 if target_message: text = 'At: {}/nContent: &quot;{}&quot;'.format(target_message['time'], target_message['text']) else: text = 'Database Error' bot.send_message(chat_id=config.GROUP_ID, reply_to_message_id=msg_id, text=text, disable_notification=True) InlineMode 上面的方法虽然达到了目标，但是有很多问题。首先搜索的过程太过麻烦不易操作，如果要翻页产生大量信息会影响正常聊天，尽管可以采用定时撤回的方式，但还是有一段时间的滞留；其次，这种搜索方式是不隐蔽的，这个过程中每个人都能够操作，就会很混乱，没有限制的话对后台也是有影响的。 后面找到了InlineMode这个东西，可以在@机器人的时候弹出一个可点击的列表，通过点击某一条，可以以自己的身份发送一条消息出去。 起初发现这条消息也会被机器人获取而记录，而且不能回复也就不能定位到历史消息，结合之前的方法又想到了可以发送命令来定位（命令不会被存储），这次就不需要很多东西，只要一个定位命令加上ID就行了。 每条消息是一个InlineQueryResultArticle，包含标题、描述以及点击会发出去的消息文本input_message_content，把命令放在input_message_content里面，这样点击之后会发出定位消息的命令，触发机器人回复消息。 handler = InlineQueryHandler(inline_caps) def inline_caps(bot, update): query = update.inline_query.query 处理query获得关键词和页码 # 结果列表 results = [InlineQueryResultArticle( id='info', title='Total:{}. Page {} of {}'.format(count, page, math.ceil(count / SEARCH_PAGE_SIZE)), input_message_content=InputTextMessageContent('/help') )] for message in messages: results.append( InlineQueryResultArticle( id=message['id'], title='{}'.format(message['text'][:100]), description=message['time'].strftime(&quot;%Y-%m-%d&quot;).ljust(40) + message['user'], input_message_content=InputTextMessageContent('/locate {}'.format(message['id'])) ) ) bot.answer_inline_query(update.inline_query.id, results) 发帖提醒 这个是通过updater.job_queue设置定时任务，如果有贴子更新就发送一条消息，这个比较简单就不说了。 job.run_repeating(one_monitor, interval=60, first=0) def one_monitor(bot, job): for post in get_update_post(): bot.send_message(...) 总结 总的来说，Telegram的API限制很少，只要脑洞大开就可以做出很多有意思的东西。当然也要防止滥用影响正常聊天，限制使用频率，也可以加上一些自动撤回之类的功能（管理员的话最好把用户命令也撤回）。 参考 https://www.zchen.info/archives/deploying-telegram-bot-with-webhook.html https://github.com/python-telegram-bot/python-telegram-bot/wiki/Code-snippets#build-a-menu-with-buttons https://github.com/python-telegram-bot/python-telegram-bot/wiki/Types-Of-Handlers https://stackoverflow.com/questions/45532078/remove-group-messages-with-python-telegram-bot https://core.telegram.org/bots/api/#replykeyboardmarkup https://python-telegram-bot.readthedocs.io/en/latest/telegram.inlinekeyboardbutton.html https://stackoverflow.com/questions/41195822/multiple-callback-query-handlers https://python-telegram-bot.readthedocs.io/en/stable/telegram.ext.callbackqueryhandler.html https://github.com/python-telegram-bot/python-telegram-bot/wiki/Exception-Handling https://github.com/python-telegram-bot/python-telegram-bot/wiki/Webhooks ","link":"https://taosky.github.io/post/telegram-robot/"},{"title":"Python二叉树翻转","content":"之前写的时候感觉有点问题，又试了一下。 大概就是这样, 交换左右子树，再对子树递归，之前写的时候好像判断了一下左右是否存在，其实不必要。 class Node(object): def __init__(self, val, l_node, r_node): self.l_node = l_node self.r_node = r_node self.val = val def binary_tree_reverse(node): if node: node.l_node, node.r_node = node.r_node, node.l_node binary_tree_reverse(node.l_node) binary_tree_reverse(node.r_node) if __name__ == '__main__': n7 = Node(7, None, None) n6 = Node(6, None, None) n5 = Node(5, None, None) n4 = Node(4, None, None) n3 = Node(3, n6, n7) n2 = Node(2, n4, n5) n1 = Node(1, n2, n3) binary_tree_reverse(n1) ","link":"https://taosky.github.io/post/python-binary-tree-reverse/"},{"title":"日剧《人生删除事务所》中的计算机“技术”","content":"V2EX看到了推荐《人生删除事务所》，看了发现果然不错，一下子就看完了。 大概就是属于“不务正业”的那种类型，讲的是一个处理电子遗产的事务所，但是也经常干着侦探的活。。。 其中也出现了一些看起来很厉害的的计算机相关技术，在这简单记录一下。 Android模拟器 这里将日程App安装到模拟器，读取委托人日程。其实不太可能，App本身不应该带有数据的，难道写个日程还要写代码更新App吗。。。 密码字典破解 这里是用姓名生日生成自定义字典，一般也有用现有密码字典的，不过原理都是一样的，通过不停地尝试登陆，试出正确的密码。 其实现在很少有人设置这么简单的密码了，而且网络服务也会阻止密码尝试以及二次验证之类的，大概只能用来跑跑路由器密码吧。 服务器后门 就是入侵服务器之后在服务器中留下不易察觉的入口，以便日后直接通过这个入口进入服务器。 记得以前常见的是PHP、ASP的WebShell，可以执行shell命令，进行提权等操作；一般都是通过文件上传的漏洞上传，进而能够控制服务器。 常威，还说你不会武功？ 远程控制？ 当然这肯定不是简单的远程控制，而是某种类似木马的程序，一般伪装成系统进程，隐藏在后台不被发现。 记得初中那会儿“灰鸽子”很流行，经常有加壳、改特征码产生的各类变种绕过检测，功能上可以说实现了对“肉鸡”完整控制。 Bad Usb？ 剧里插入USB设备进行密码破解，猜测是Bad Usb。所谓Bad Usb是将Usb设备模拟鼠标键盘等交互设备输入，从而运行自己的恶意程序。不过这里的USB设备其实已经不是简单的U盘这种存储设备了，而是小型的系统，之前就看到过可以把树莓派做成Bad Usb。 VNC 剧情是，上面的Bad Usb还没能破解密码，主角就说了，没有加密磁盘就可以直接用，于是连上敲了一行命令就远程连接上去了。。。 而那条命令其实是开启了VNC服务（远程连接服务）。。。 云服务同步 这个思路感觉比较厉害，通过破解云服务密码及同步手机数据到云端，获取手机中的照片等信息。 不过一般是需要在经过认证的设备上才可以登陆。 ","link":"https://taosky.github.io/post/dele-life/"},{"title":"Sqlalchemy和多线程和异步爬虫","content":"多线程的问题 开始想用多线程来加速爬虫，发现SQLAlchemy的session不是线程安全的，但是有个ScopedSession可以为每个线程创建一个session。 session_factory = sessionmaker(bind=engine) Session = scoped_session(session_factory) some_session = Session() some_session.add(...) some_session.commit() Session.remove() 又遇到了连接数的问题：QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30 连接池默认最大连接数为5，需要再创建engine的时候设定。 不过这个东西不是很好用，后面想到用协程异步执行就简单多了。 协程 改动获取数据的代码，使用aiohttp库，调用的地方都加上await。 async def get_json_data(url): async with aiohttp.ClientSession() as session: async with session.get(url) as response: result = await response.text() return json.loads(result) 主函数改成协程，通过loop执行。 async def start_article(story): ... article_data = await get_json_data(api_url) ... def main(): ... tasks = [start_article(story) for story in stories] loop.run_until_complete(asyncio.wait(tasks)) 测试了一下，原来抓取文章需要17秒左右的，现在7秒，提升还是挺大的，毕竟还有数据库请求的时间。 参考 https://stackoverflow.com/questions/6297404/multi-threaded-use-of-sqlalchemy https://stackoverflow.com/questions/3360951/sql-alchemy-connection-time-out/28040482 https://juejin.im/post/5b430456e51d45198a2ea433 ","link":"https://taosky.github.io/post/sqlalchemy-multithreading/"},{"title":"MySQL安装及使用的一些问题","content":"安装 这个看官方文档就行了，主要是要去log里面找密码。 然后mysql -u root -p登陆会让修改密码use mysql,ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '密码'; 这个密码默认是要符号、数字、大小写，不符合就会报错。 设置外网访问，update user set host='%' where user='root' and host='localhost';。 修改端口需要修改/etc/my.cnf。 无法drop数据库 MySQL控制台中show full processlist，然后kill [ID]。 SQLAlchemy缺少MySQLdb Python3需安装mysqlclient，这个在Windows上安装可能提示要装VS，手动下载包，然后pip安装。 Linux下也有问题，安装会出现缺少mysql_config，需要先系统里安装mysql-devel，community版本要安装mysql-community-devel，再报错把python[版本]-devel也装上 Incorrect string value 插入数据时报类似 Incorrect string value: '/xF0/x9F/x92/x9C的错误，原因是Mysql数据库的UTF-8是三字节存储的，Emoji表情等占用四字节就会报错。 创建数据库的时候使用utf8mb4编码，连接时加上?charset=utf8mb4。 字段名和保留字冲突 表内有个字段叫update记录时间，提示语法错误，用反引号`/``包裹就可以了。 迁移到MariaDB 在这个页面选择系统，添加相应的软件源， 安装MariaDB-server，MariaDB-client，MariaDB-devel，MariaDB-shared这几个包，有个坑是大小写区分，不安装MariaDB-shared很多开发用到的库会提示找不到lib。 参考 https://blog.csdn.net/lxlong89940101/article/details/80246675 https://blog.csdn.net/cccheer/article/details/60480199 https://stackoverflow.com/questions/38335330/not-able-to-install-mysql-devel-on-centos-7 https://stackoverflow.com/questions/454854/no-module-named-mysqldb https://my.oschina.net/lixin91/blog/639270 http://www.cnblogs.com/coffee/archive/2010/02/26/1674061.html ","link":"https://taosky.github.io/post/mysql-problems/"},{"title":"Gunicorn+Supervisor+Nginx部署Python Web应用","content":"VPS搬家了，重装一堆服务还有点麻烦，顺便记录一下部署Python Web的过程。 Gunicorn Gunicorn是Python下支持WSGI的Web服务器，平常用到的Django、Flask这些Web框架也是自带服务器的，由于性能有限一般只在测试环境用，而uWSGI/Gunicorn 都是专门的服务器。 之前用uWSGI配置好麻烦，这次就用Gunicorn。 在Web应用的虚拟环境中安装pip install gunicorn，测试一下是否能启动gunicorn app:app -w 3 -b localhost:5000，能够正常启动便可以了，详细参数见文档，这里只设置了3个工作进程。 Supervisor Supervisor是Python下的Linux进程管理工具，这样Web应用就可以作为服务自动启动，也方便管理。 安装yum install supervisor,启动服务service supervisord start。 添加配置文件vim /etc/supervisor.d/daily.ini。 [program:daily] directory=/root/python/daily command=/root/python/daily/env/bin/gunicorn app:app -w 3 -b localhost:5000 autostart=true autorestart=true stderr_logfile=/var/log/daily/daily.err.log stdout_logfile=/var/log/daily/daily.out.log 加载配置supervisorctl reread 重启服务service supervisord restart 这样就可以了，如果之后修改代码，通过supervisorctl start/restart/stop daily可以轻松控制了。 Nginx 整合到Nginx里面就很简单了，反代127.0.0.1:5000，就可以了，Gunicorn最好绑定在本机地址上或者设置防火墙。 server { ... ... location /daily { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_redirect off; proxy_set_header SCRIPT_NAME /daily; proxy_pass http://127.0.0.1:5000; } } ","link":"https://taosky.github.io/post/python-gunicorn-supervisor-nginx/"},{"title":"体验一下Github的Webhook","content":"这东西就是版本库变动之后会给设定的URL发送一个POST请求，然后服务器通过这个请求去Pull以及构建重启web服务什么的，不用手动去服务器更新，好像也有其他不得了的玩法。 用于Webhook的web服务 更新：python-github-webhook，这个库可以很简单地监听事件做出动作。 只要加上对应地装饰器，就可以监听对应事件了。 正常做法有很多信息可以获得，但是我只是更新代码构建，最简单的是接收到post请求采取动作就行了。 图省事直接扔在现有flask项目里面了，本来想验证secret，试了半天没成功，真正使用的时候有风险，一定要加上。 看网上的文章都是用的node，有个webhook的包很方便。 @app.route('/webhook', methods=['POST']) def webhook(): if 'X-Hub-Signature' in request.headers and request.headers['X-Hub-Signature'].startswith('sha1='): p=Popen('/var/www/xxx/webhook.sh') return 'Ok' else: return 'Forbidden.', 403 触发的脚本 上面的代码里面就有执行/var/www/xxx/webhook.sh这个脚本，在这个脚本里做pull和别的事就行了。 #!/bin/bash cd /var/www/xxx git pull git checkout master yarn run build 在Github添加 可以选择只监听Push还是全部或是自己选。 添加之后会自动发送一个测试的请求验证是否正确。 ","link":"https://taosky.github.io/post/github-webhook/"},{"title":"日语学习笔记33、34课","content":"自动词 ています。（表示状态）（...了，...着） 私は南京に住んでいます。 隣のおじいさんは死んでいる。 桜の花が咲いています。 そうです。 样态、推测 词 肯定 否定 动词 去ます＋そうです 去ます＋そうにありません 形1 去い＋そうです 去い＋そうではありません 形2 词干＋そうです 词干＋そうではありません 名词 名词＋そうです 名词＋そうではありません いい -&gt; よさそう ない -&gt; なさそう 雨が降りそうです。 看起来要下雨。 传闻，听说 | 词 | 肯定 | | -------- | :----- | :---- | | 动词 | 原型＋そうです | | 形1 | 原型＋そうです | | 形2/名词 | 原型＋だそうです| 雨が降るそうです。 听说要下雨。 て みます。（试着做...） 昨日カラオケで日本語の歌を歌ってみました。 日本料理を作ってみました。 してみてください。 小説を書いてみたいです。 かいてみるつもりです。 日本語で話してみましょう。 ために（因为） （ために写作“為”，还有个意思就是“为了”，后面会讲到） 息子のために、２回引っ越しました。 明日の試験のために、... て おきます （おく：置く） 提前做.../先做... 映画のチケットを買っておきます。 日本へ行く前に、ホテルを予約しておきます。 会議の前に、資料をコピーしておいてください。 放在一边，置之不理，不管 ... が 他动词 て おきます。 强调有人做了某个动作。 其他 森さんたちはもう来ているかしら 「かしら：女性的自言自语」 大勢 形容人多 相変わらず 没变，还是那样 ネクタイをします 「脖子上的一般用します」 着る 上半身的穿 は着る 下半身的穿 今まで、こんなにおいしいの食べたことありません 「こんなに：这般的」 ","link":"https://taosky.github.io/post/japanese-learn-note-33-34/"},{"title":"HomeAssistant IOS推送","content":"IOS平台一大好处是通知推送，HomeAssistant中已经很完善了，简单地配置之后就可以用。 添加组件 配置文件里添加ios:重启加载IOS组件，在App中设置-通知设置-更新推送设置，可以看到IOS组件和通知平台都打勾了。 在开发者工具-服务里面也会有相应项，就可以使用了。 简单通知 通知一般在自动化里面调用通知服务，比如一个最简单的HomeAssistant启动通知。 可以添加标题副标题，这里的unicode字串是显示的表情。 - alias: hass_start_notify trigger: - event: start platform: homeassistant condition: [] action: - service: notify.ios_taosky8p data: message: &quot;{{ '/uD83D/uDE09' }}Home Assistant刚刚启动了。&quot; 效果如下： 带操作按钮的通知 3D Touch通知之后会有选项的那种，比如收到树莓派温度过高的通知可以直接关闭它。 这个其实是两个自动化完成的，一个是通知的自动化，一个是收到通知按钮之后作出反应的自动化。 首先需要在ios.push里面添加一个按钮模板，也就是通知上的按钮的样子。具体参数的含义见官方文档，这个对大小写很敏感，如出错可能是大小写问题。 其次是正常的一个自动化，相比较上面的简单通知，里面多了个data指定按钮的模板。 最后是触发按钮的自动化，用到ios.notification_action_fired这个事件，然后在action里面真正完成我们的关机的操作。 shell_command: shutdown_pi: sudo shutdown -h now script: shutdown_pi: alias: 关闭树莓派 sequence: - service: shell_command.shutdown_pi ios: push: categories: - name: Piwarning identifier: 'piwarning' actions: - identifier: 'SHUTDOWN_PI' title: '立即关闭PI？' activationMode: 'background' authenticationRequired: yes destructive: yes behavior: 'default' automation: - alias: pi_temp_warning trigger: platform: numeric_state entity_id: sensor.pi_temp above: 50 condition: [] action: - service: notify.ios_taosky8p data: message: &quot;{{ '/uD83D/uDE31' }} 树莓派温度过高（超过50度）！&quot; data: push: category: &quot;piwarning&quot; - alias: ios_action_shutdown_pi trigger: platform: event event_type: ios.notification_action_fired event_data: actionName: SHUTDOWN_PI action: - service: script.turn_on entity_id: script.shutdown_pi 参考 https://www.home-assistant.io/docs/ecosystem/ios/notifications/basic/ https://www.home-assistant.io/docs/ecosystem/ios/notifications/actions/ https://bbs.hassbian.com/thread-1430-1-1.html https://bbs.hassbian.com/thread-3366-1-1.html ","link":"https://taosky.github.io/post/homeassistant-7/"},{"title":"HomeAssistant加入空调控制（LIRC）并接入HomeKit","content":"上一篇中已经能够成功红外控制空调，剩下的就是把它放到HomeAssistant中。 MQTT HVAC 最简单的方法是作为开关加入，然后运行命令，但是这样子只能控制制冷或制热，或者要加入很多开关。这样就很麻烦了，我还希望能够加入HomeKit中控制。 好在HomeAssistant有个东西叫MQTT HVAC，也是属于climate，可以直接接入HomeKit。 MQTT协议就相当于有两方在通信，一个是消息的接收者，一个是消息的发送者。当我们改变空调模式、温度时，消息发送到接收者，接收者去执行shell命令发送红外。大概原理就是这样，所以我们需要的是跑一个接收者的MQTT客户端。 这里面url需要填写HomeAssistant密码，mode和temp两个主题可以改成自己想要的名字， client.on传入的回调函数就是对发过来的消息做出反应。因为HomeAssistant或HomeKit中打开空调需要先选择制冷、制热、自动，if (payload === 'heat')这几个if就是对于模式选择的反应，比如选择了制热就发送'制热21度'的红外码，spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_21'])，'aircon'是lirc配置的名字，'heat_21'是红外码的名字，以此类推。 #!/usr/bin/env node var mqtt = require('mqtt'); var mode = 'mitsubishi/ac/mode/set'; var temp = 'mitsubishi/ac/temperature/set'; var url = 'mqtt://homeassistant:你的密码@127.0.0.1'; var spawn = require('child_process').spawn; var mode0; console.log(url); var client = mqtt.connect(url); client.subscribe(mode); client.subscribe(temp); client.on('message', (topic, message) =&gt; { const payload = message.toString() if (payload === 'heat') { console.log(`Now Mode '${payload}'`) mode0 = &quot;heat&quot;; spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_21']) } else if (payload === 'cool') { console.log(`Now Mode '${payload}'`) mode0 = &quot;cool&quot; spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_28']) } else if (payload === 'auto') { console.log(`Now Mode '${payload}'`) mode0 = &quot;auto&quot; spawn('irsend', ['SEND_ONCE', 'aircon', 'off']) } else if (payload === 'off') { console.log(`Now Mode '${payload}'`) mode0 = &quot;off&quot; spawn('irsend', ['SEND_ONCE', 'aircon', 'off']) } else if (payload === '17.0') { if (mode0 === 'heat') { console.log(`17.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_17']) } else if (mode0 === 'cool') { console.log(`17.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_17']) } else if (mode0 === 'auto') { console.log(`17.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_17']) } } else if (payload === '18.0') { if (mode0 === 'heat') { console.log(`18.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_18']) } else if (mode0 === 'cool') { console.log(`18.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_18']) } else if (mode0 === 'auto') { console.log(`18.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_18']) } } else if (payload === '19.0') { if (mode0 === 'heat') { console.log(`19.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_19']) } else if (mode0 === 'cool') { console.log(`19.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_19']) } else if (mode0 === 'auto') { console.log(`19.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_19']) } } else if (payload === '20.0') { if (mode0 === 'heat') { console.log(`20.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_20']) } else if (mode0 === 'cool') { console.log(`20.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_20']) } else if (mode0 === 'auto') { console.log(`20.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_20']) } } else if (payload === '21.0') { if (mode0 === 'heat') { console.log(`21.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_21']) } else if (mode0 === 'cool') { console.log(`21.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_21']) } else if (mode0 === 'auto') { console.log(`21.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_21']) } } else if (payload === '22.0') { if (mode0 === 'heat') { console.log(`22.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_22']) } else if (mode0 === 'cool') { console.log(`22.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_22']) } else if (mode0 === 'auto') { console.log(`22.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_22']) } } else if (payload === '23.0') { if (mode0 === 'heat') { console.log(`23.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_23']) } else if (mode0 === 'cool') { console.log(`23.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_23']) } else if (mode0 === 'auto') { console.log(`23.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_23']) } } else if (payload === '24.0') { if (mode0 === 'heat') { console.log(`24.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_24']) } else if (mode0 === 'cool') { console.log(`24.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_24']) } else if (mode0 === 'auto') { console.log(`24.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_24']) } } else if (payload === '25.0') { if (mode0 === 'heat') { console.log(`25.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_25']) } else if (mode0 === 'cool') { console.log(`25.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_25']) } else if (mode0 === 'auto') { console.log(`25.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_25']) } } else if (payload === '26.0') { if (mode0 === 'heat') { console.log(`26.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_26']) } else if (mode0 === 'cool') { console.log(`26.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_26']) } else if (mode0 === 'auto') { console.log(`26.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_26']) } } else if (payload === '27.0') { if (mode0 === 'heat') { console.log(`27.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_27']) } else if (mode0 === 'cool') { console.log(`27.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_27']) } else if (mode0 === 'auto') { console.log(`27.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_27']) } } else if (payload === '28.0') { if (mode0 === 'heat') { console.log(`28.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_28']) } else if (mode0 === 'cool') { console.log(`28.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_28']) } else if (mode0 === 'auto') { console.log(`28.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_28']) } } else if (payload === '29.0') { if (mode0 === 'heat') { console.log(`29.0heat`) spawn('irsend', ['SEND_ONCE', 'aircon', 'heat_29']) } else if (mode0 === 'cool') { console.log(`29.0cool`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_29']) } else if (mode0 === 'auto') { console.log(`29.0auto`) spawn('irsend', ['SEND_ONCE', 'aircon', 'cool_29']) } } }); 安装mqtt库: npm install mqtt --save 运行客户端: node aircon.js 修改HomeAssistant配置，这里需要对应自己设置的主题。 climate: - platform: mqtt name: Aircon modes: - off - cool - heat - auto mode_command_topic: &quot;mitsubishi/ac/mode/set&quot; temperature_command_topic: &quot;mitsubishi/ac/temperature/set&quot; 重启测试能否使用。 mqtt客户端作为服务运行，sudo vim /etc/systemd/system/node-mqtt@pi.service，需要修改路径。 [Unit] Description=Mqtt client with Node [Service] ExecStart=/home/pi/smarthome/aircon.js Restart=always User=%i Environment=PATH=/usr/bin:/usr/local/bin Environment=NODE_ENV=production WorkingDirectory=/home/pi/smarthome [Install] WantedBy=multi-user.target sudo systemctl daemon-reload 刷新服务，sudo systemctl enable node-mqtt@pi.service开机启动。 说明 HomeAssistant中控制的时候有个问题，显示的false并不能关闭空调，而HomeKit中却可以关闭（siri关闭是调成自动模式），所以把选择Auto模式设置成发送关闭的红外码。 其他的Auto温度也都是直接用了制冷的，实在是懒得录了，这模式一般也没用吧。 这里是和遥控器一样通过红外发送来控制的，所以没有办法读到到底空调处于什么状态，也就是optimistic mode。这就会导致一个问题，设置了26度，然后打开制冷，其实执行的是'制冷28度'（这是我前面设置的），也就是说这个显示是不正确的，而模式打开后，再设置的温度就是准确的了。 HomeKit上面显示的室温好像没办法改变。 参考 https://bbs.hassbian.com/thread-1817-1-1.html https://www.home-assistant.io/components/climate.mqtt/ ","link":"https://taosky.github.io/post/homeassistant-6/"},{"title":"树莓派Lirc红外控制空调","content":"经过满长的爬坑，终于成功用lirc控制空调，最终是为HomeAssistant服务的。 准备 用到的硬件就下面这些。 树莓派Zero W （RASPBIAN STRETCH） 红外接收模块（HX1838） 红外发射模块 若干杜邦线 顺便把马老板家红外模块链接放上，买电子元件什么的也是要看运气。 http://dwz.cn/hEALZbR1 http://dwz.cn/kZu5T03F 安装Lirc sudo apt install lirc，这里用的是STRETCH版的系统，lirc版本应该是0.94c+，旧版不太一样，本文仅针对新版。 修改启动配置sudo vim /boot/config.txt，修改#dtoverlay=lirc-rpi这行为 dtoverlay=lirc-rpi,gpio_in_pin=18,gpio_out_pin=17 重启系统，lirc模块就被加载了 接线 安装gpiozero库，使用pinout查看树莓派管脚。 sudo apt install python3-gpiozero pinout 将接收模块的数据口接到GPIO18（注意不是管脚号），将VCC接到5V，GND接地。 这个模块上没有标记，最好问一下客服，我买的两家的相同的模块，客服告诉我的都不一样。。。 发送模块数据口接GPIO17，VCC接5V，GND接地。 录制和发射 本来写了很多，发现这篇文章讲的很详细，简单说一下。 接收器是为了读取红外码，之后就不需要了，将红外码和键对应，生成Lirc配置文件，Lirc使用这个配置文件来发送相同的红外码，进而控制空调。 这里需要注意的是空调的红外码和其他设备不太一样，电视机这种'0'这个数字就对应一个代表'0'的码；而空调'27度'，对应的其实是当前的所有设置，包括风向、风速、制冷、温度这些，相当于给一个关闭的空调发送'27度'，就同时打开了空调，设置好了所有这些对应参数。因为它的特殊性，不能用lirc自带的工具录制，需要手动将复制到配置文件里面。 第一次发射的时候，空调没有反应，拖着排插按到空调上才成功，后面发现对准的话一两米也没有问题，最后固定在书架上对着空调的接收口。 发射的操作很简单，就是一条命令，通过其他程序调用，就产生了很多应用方案了，下一篇会说明如何整合到HomeAssistant。 参考 https://segmentfault.com/a/1190000014135418 http://jeffssss.github.io/%E6%A0%91%E8%8E%93%E6%B4%BE/2017/07/23/re-use-siri-turn-on-air-condition.html ","link":"https://taosky.github.io/post/pi-lirc-aircon-control/"},{"title":"HomeAssistant脚本&自动化&Package","content":"到这里，Homeassistant的主要功能就了解的差不多了，其实所谓“智能”主要就是自动化加上想象力。 脚本 就是手动触发，然后执行一个或多个动作，详见文档。比如下面这个就是延迟三十分钟关闭电扇，这里其实是延迟和关闭开关两个动作了。 script: delay_turn_off_switch alias: 延迟关闭电扇 sequence: - delay: '00:30' - service: homeassistant.turn_off entity_id: switch.xiaomi_switch_one 自动化 自动化其实也是去执行动作，不过不需要手动触发，而是由某个状态发生改变触发，如时间、开关打开、温度变化等；此外可能还需要一个环境条件，比如人在家、某个时间段内。 举个例子，如果人在家的话，每天早上9点播报天气情况。这里每天9点就是触发条件，人在家就是环境条件，播报天气就是动作。每个自动化实例可以有多个触发条件和环境条件。 这里我写了个自动重启HomeAssistant的脚本，shell_command可以执行linux命令，添加了一个脚本去执行这个命令；自动化中trigger是触发条件，这里设定的时间11：30（似乎有简单的写法）；condition是环境条件，这里是设备组的状态，没有设备在家（这个组排除了智能设备）才会执行；action是动作，执行重启的脚本。 shell_command: restart_hass: sudo service home-assistant@pi restart script: restart_hass: alias: 重启HomeAssistant sequence: - service: shell_command.restart_hass automation: - alias: restart_hass_daily initial_state: true trigger: - platform: time hours: 11 minutes: 30 seconds: 00 condition: - condition: state entity_id: group.human_device state: not_home action: - service: script.turn_on entity_id: script.restart_hass Package 这个东西还挺有用的，就是把一些配置打包成一个文件（上面那个自动重启的代码其实就是了），因为很多功能是需要多个部分的配置，打包后配置更清晰，也方便分享。 需要在configuration.yaml中添加packages: !include_dir_named packages，然后下载的或自己写的配置直接扔到配置目录下的packages文件夹即可。 这里需要说明一点，如果antomations.yaml中没有内容，而在包里面有自动化的内容，重启之后会出错，而脚本好像没这个问题，感觉是很奇怪的Bug，所以要先往antomations.yaml里面放至少一个自动化。 分享一个我参考网上代码修改的延时开关配置，需要修改xiaomi_switch_one为你自己的开关，保存为.yaml后缀放入packages。（需安装Custom UI，参考上一篇） homeassistant: customize: input_boolean.alarm_clock: friendly_name: 延时开关 sensor.relative_alarm_time: friendly_name: 设定时间 custom_ui_state_card: state-card-custom-ui extra_data_template: if (entities['switch.xiaomi_switch_one'].state === 'on') return '延时关闭时间'; else return '延时开启时间'; sensor: - platform: template sensors: relative_alarm_time: value_template: &gt; {% set relative_time = (states.input_number.alarmhour.state|float|multiply(60) + states.input_number.alarmminutes.state|float) + (now().hour|float|multiply(60) + now().minute|float) %} {%- if relative_time &gt; 1440 -%} {{((relative_time-1920) |int |multiply(60)) | timestamp_custom(&quot;%H:%M&quot;)}} {%- else -%} {{((relative_time-480) |int |multiply(60)) | timestamp_custom(&quot;%H:%M&quot;)}} {%- endif %} unit_of_measurement: &quot;min&quot; input_boolean: alarm_clock: initial: off icon: mdi:timer input_number: alarmhour: name: 小时 icon: mdi:timer initial: 0 min: 0 max: 5 step: 1 alarmminutes: name: 分钟 icon: mdi:timer initial: 30 min: 0 max: 55 step: 1 group: switch1: name: 电扇 control: hidden view: no entities: - switch.xiaomi_switch_one - input_boolean.alarm_clock - sensor.relative_alarm_time - input_number.alarmhour - input_number.alarmminutes automation: - alias: countdown time initial_state: true trigger: platform: time minutes: '/1' seconds: 00 condition: condition: and conditions: - condition: state entity_id: input_boolean.alarm_clock state: 'on' - condition: template value_template: '{{ (now().hour|float|multiply(60) + now().minute|float - 480 ) |multiply(60) | timestamp_custom(&quot;%H:%M&quot;) == states.sensor.relative_alarm_time.state }}' action: - service_template: &gt; {% if is_state('switch.xiaomi_switch_one', 'off') %} switch.turn_on {% else %} switch.turn_off {% endif %} data: entity_id: switch.xiaomi_switch_one - service: homeassistant.turn_off entity_id: input_boolean.alarm_clock 参考 https://bbs.hassbian.com/forum.php?mod=viewthread&amp;tid=1806&amp;highlight=%E5%BB%B6%E6%97%B6 https://community.home-assistant.io/t/solved-automation-in-package-not-working/24768 https://www.home-assistant.io/components/script/ https://www.hachina.io/docs/1848.html ","link":"https://taosky.github.io/post/homeassistant-5/"},{"title":"HomeAssistant分组&自定义&Custom UI","content":"所谓分组就是把不同设备聚到一起，比如卧室、客厅这样的分组，可以直接开关整个分组；自定义就是设置设备（实体）、组的参数，之前提到的hide in homebridge也算是；Custom UI起到修改UI的作用，可以丰富信息展示，一般先安装这个。 分组 官方文档在这里。 最简单的就是在配置目录下的groups.yaml中添加。 raspberrypi: name: 树莓派 view: no entities: - sensor.pi_temp - sensor.memory_use - sensor.memory_use_percent - sensor.disk_use_ - sensor.disk_use_percent_ - sensor.ssl_certificate_expiry - sensor.since_last_boot_templated 例如这里我添加了一个名为树莓派的组，view是指产生一个分页，否则是以一个卡片展示的。 分组中可以再添加分组，可以点击弹出。在entities中添加- groups.xxx即可。 分组修改后，可以直接从浏览器端配置-通用-重载分组来刷新页面。 自定义 自定义位于customize.yaml，可以修改文件，也可以浏览器端配置-自定义来修改，最基本的有设置图标、名字，不同的组件参数是不一样的。下面会提到配合Custom UI的一些操作。 Custom-UI 目前我用到的也就是显示额外的Badge和额外的文字，这里有写到Custom UI的功能。 安装 参考这里。 进入配置目录 curl -o update.sh &quot;https://raw.githubusercontent.com/andrey-git/home-assistant-custom-ui/master/update.sh?raw=true&quot; chmod u+x update.sh ./update.sh 激活 修改configuration.yaml（旧版不太一样，需要参考文档） customizer: custom_ui: local frontend: extra_html_url: - /local/custom_ui/state-card-custom-ui.html - /local/custom_ui/state-card-weather.html extra_html_url_es5: - /local/custom_ui/state-card-custom-ui-es5.html - /local/custom_ui/state-card-weather.html 添加文字和Badge 修改自定义文件customize.yaml，关于Custom UI的操作都需要添加custom_ui_state_card这一行，extra_data_template就是文字的内容了，这里的template和之前用过的还不太一样，参考这个。 这里entities['sensor.memory_use']获取已使用内存的实体，state就是它的状态（值），这个可以在浏览器端开发者工具下面的状态里面看到。${}这种应该是JS的字符串模板写法，前后可以随便加文字。 sensor.memory_use_percent: friendly_name: RAM使用率 custom_ui_state_card: state-card-custom-ui extra_data_template: 已使用 ${entities['sensor.memory_use'].state}M 下面这个是给开关加上上次变化时间和开关温度，显示上次变化时间只需要加入show_last_changed: true就可以了，extra_badge可以用开关自身的属性（attribute），也可以是entity_id: sensor.xxxx，显示别的传感器数值。 switch.xiaomi_switch_two: friendly_name: 台灯 custom_ui_state_card: state-card-custom-ui show_last_changed: true extra_badge: attribute: temperature unit: °C 参考 https://github.com/andrey-git/home-assistant-custom-ui/blob/master/docs/installing.md#local-install https://github.com/andrey-git/home-assistant-custom-ui/blob/master/docs/activating.md https://github.com/andrey-git/home-assistant-custom-ui/blob/master/docs/features.md ","link":"https://taosky.github.io/post/homeassistant-4/"},{"title":"HomeAssistant设备接入","content":"HomeAssistant设备接入功能其实很强大，能想到的几乎都能办到，不局限于智能硬件，当然也需要很强的动手能力。 简单介绍下我用到的一些“设备”的接入，只是接入的话，显示出来很杂乱，下一篇会讲到怎么整理。 小米智能开关基础版 因为拿到手是没有配置wifi接入的，需要下载米家App按步骤配置好。 获取token，尝试了miio --discover并不行，需要有root权限的模拟器或者root权限的android手机，参考https://home-assistant.cc/component/xiaomi/wifi/ 然后就可以在配置文件里加上switch。 switch: - platform: xiaomi_miio name: Xiaomi Switch One host: 192.168.2.196 token: e0c4ff4f************** 如果不再使用米家App可以在路由器屏蔽这两个设备访问外网，也许可以保护隐私吧。 Padavan固件路由器 发现更新不及时，而且对路由器登录请求太多，更换了**nmap_tracker**（需安装nmap）方式，还可以设置排除的ip，就不会把树莓派、智能设备加进去了，还有个好处就是如果接入了多个网络，可以扫描多个网络的设备。 会有断断续续的情况，还是弃用了。 某不要钱倒闭路由器刷的Padavan，Padavan基于华硕固件，但使用自带的asuswrt读不到/var/lib/misc/dnsmasq.leases这个文件，其实在Padavan中的位置是/tmp/dnsmasq.leases。 路由器设置里面开启telnet，然后telnet到路由器，建立软链接ln -s /tmp/dnsmasq.leases /var/lib/misc/dnsmasq.leases，这样就可以读到了。 配置 device_tracker: - platform: asuswrt host: 192.168.*.1 username: admin password: ****** protocol: telnet port: 23 在路由器后台的日志里，可以看到多次登陆，我这边密码错误，原因不明，但是可以正常使用。 树莓派温度 这就体现出HomeAssistant的强大之处了，可以把各种数据都变成传感器设备。 这里的cat /sys/class/thermal/thermal_zone0/temp就是打印树莓派温度值，通过模板除以1000保留一位小数获得结果。 sensor中添加 - platform: command_line name: Pi command: &quot;cat /sys/class/thermal/thermal_zone0/temp&quot; unit_of_measurement: &quot;°C&quot; value_template: '{{ value | multiply(0.001) | round(1) }}' 温度传感器 和上面类似，打印命令里面过滤了结果，传感器安装参考的这篇文章。 'sensor'中添加 - platform: command_line name: Temp command: &quot;cat /sys/bus/w1/devices/28-01131650ab0a/w1_slave |grep t= | cut -d '=' -f 2&quot; unit_of_measurement: &quot;°C&quot; value_template: '{{ value | multiply(0.001) | round(1) }} ' 彩云天气 用到了这个文件：caiyun.py 将文件放入配置文件夹/custom_components/sensor/。 'sensor'中添加 - platform: caiyun name: Caiyun 这是自定义了一个传感器组件，只要会写代码，就可以创造自己的组件，获取任何信息。 月相 （好像没啥用） 这里用到了value_template，通过if语句判断，显示不同的结果，其实是对自带的sensor.moon进行了汉化。 sensor中添加 - platform: template sensors: moon_phase: value_template: '{% if is_state(&quot;sensor.moon&quot;, &quot;New moon&quot;) %}新月{% elif is_state(&quot;sensor.moon&quot;, &quot;Waxing crescent&quot;) %}娥眉月{% elif is_state(&quot;sensor.moon&quot;, &quot;First quarter&quot;) %}上弦月{% elif is_state(&quot;sensor.moon&quot;, &quot;Waxing gibbous&quot;) %}盈凸月{% elif is_state(&quot;sensor.moon&quot;, &quot;Full moon&quot;) %}满月{% elif is_state(&quot;sensor.moon&quot;, &quot;Waning gibbous&quot;) %}亏凸月{% elif is_state(&quot;sensor.moon&quot;, &quot;Last quarter&quot;) %}下弦月{% else %}残月{% endif %}' friendly_name: '月相' 树莓派的信息 参考的官方文档。 sensor中添加 - platform: systemmonitor resources: - type: disk_use arg: / - type: disk_use_percent arg: / - type: memory_use - type: memory_use_percent - type: since_last_boot - type: last_boot 但是这个since_last_boot启动时间的格式很长1 day, 14:37:44.809441，用value_template给它格式化一下。 放在月相一起，- platform: template里面的sensors下面。 relative_alarm_time: friendly_name: '设定时间' value_template: &gt; {% set relative_time = (states.input_number.alarmhour.state|float|multiply(60) + states.input_number.alarmminutes.state|float) + (now().hour|float|multiply(60) + now().minute|float) %} {%- if relative_time &gt; 1440 -%} {{((relative_time-1920) |int |multiply(60)) | timestamp_custom(&quot;%H:%M&quot;)}} {%- else -%} {{((relative_time-480) |int |multiply(60)) | timestamp_custom(&quot;%H:%M&quot;)}} {%- endif %} unit_of_measurement: &quot;min&quot; since_last_boot_templated: value_template: &gt;- {%- set slb = states.sensor.since_last_boot.state.split(' ') -%} {%- set count = slb | length -%} {%- set hms = slb[count - 1] -%} {%- set hms_trimmed = hms.split('.')[0] -%} {%- set hms_split = hms_trimmed.split(':') -%} {%- set hours = hms_split[0] | int -%} {%- if count == 3 -%} {{ slb[0] ~ ' ' ~ slb[1] ~ ' ' }} {%- endif -%} {%- if hours &gt; 0 -%} {%- if hours == 1 -%} 1 hour {%- else -%} {{ hours }} hours {%- endif -%} {%- endif -%} ","link":"https://taosky.github.io/post/homeassistant-3/"},{"title":"树莓派lirc读取红外接收器的问题","content":"重新买了个模块终于成功了，链接，真的要给这店大大的好评。 之前买的模块可能有问题，或者客服告诉我的接线不对，╮(╯▽╰)╭，看来硬件这种东西网络上也是很难找到问题所在。 为了给HomeAssistant添加控制空调的功能，买了红外接收模块(KY-022)和发射模块，然而接收红外信号搞了两天也没有成功，简单记录一下。 LIRC版本问题 网上很多文章都是基于旧版本lirc来写的，一些配置文件，如/etc/lirc/hardware.conf在新版本上是不存在的，包管理器默认安装的0.94c版本。 执行文件和服务名也不一样，旧版是lirc，新版是lircd。 树莓派GPIO问题 网上给的图居然是错的，安装gpiozero库可以查看本机的GPIO。 sudo apt install python3-gpiozero pinout 电压问题 模块说的是接5V，教程说的3.3V，这篇文章提到，测到io口电压不够，加了电压后有输出，试了下仍然没输出。 lirc配置文件的键值重复问题 正常安装lirc后，查看服务状态，提示/etc/lirc/lircd.conf.d/devinput.lircd.conf这个文件里面相同的16进制对应多个键，然而修改后仍然没有成功，可能这个也并没影响吧。 gpio_in_pull 开启debugdebug=on，mode2之后dmesg |grep lirc可以看到 [ 66.455224] lirc_rpi: in init_timing_params, freq=38000 pulse=13157, space=13158 [ 74.757991] lirc_rpi: 6lirc_rpi: freed IRQ 178 [ 84.855023] lirc_rpi: Interrupt 178 obtained [ 84.855046] lirc_rpi: in init_timing_params, freq=38000 pulse=13157, space=13158 [ 92.758824] lirc_rpi: 6lirc_rpi: freed IRQ 178 这个贴说/boot/config.txt中添加gpio_in_pull=up就可以，确实之前看的很多文章里面也是有这个参数，有的是down，是和模块有关。 原因在这里有 然而，并不能行。。。 之后在百度（谷歌也不是全能啊）搜到贴吧里也有相同情况，https://tieba.baidu.com/p/4079519080。 有人怀疑是lirc_rpi这个内核模块的问题，楼主自己写了代码读取数据，因为我需要录制红外信号，而不是直接接收使用，所以没有什么帮助。 重装raspbian jessie（旧版） 一通操作过后仍然没有反应，彻底放弃。 直接发射红外 想跳过接收器，找现有的匹配好的代码控制空调。 https://github.com/r45635/HVAC-IR-Control 家里空调试了个遍，都失败了。 有用参考 https://www.raspberrypi.org/forums/viewtopic.php?t=192891#p1209208 https://www.raspberrypi.org/forums/viewtopic.php?t=99085 https://raspberrypi.stackexchange.com/questions/81876/raspberry-pi-3-not-lirc-not-running-working https://gist.github.com/prasanthj/c15a5298eb682bde34961c322c95378b https://github.com/josemotta/IoT.Starter.Api/tree/master/gpio-base http://iaiai.iteye.com/blog/2411532 https://www.cnblogs.com/huanglufei/articles/5562330.html https://www.raspberrypi.org/forums/viewtopic.php?t=103320 https://tieba.baidu.com/p/4079519080 ","link":"https://taosky.github.io/post/raspberry-pi-lirc/"},{"title":"HomeAssistant联动HomeKit","content":" 不小心把树莓派短路了，接电源已经没有电流了，实在是悲伤，还是要带壳才安全。 大佬赞助的树莓派还在路上已经到了，这块旧的好像也修不好了，只能当钥匙扣用了。 对水果机来说，HomeKit还是比较方便的，可以用siri来控制。只是没有ipad作中枢，没办法HomeKit自动化和远程操作，可以用HomeAssistant来自动化和远程，Home Assistant功能更强大。 更新 启用HomeAssistant自带的Homekit组件似乎也不错，大大简化步骤，节约树莓派资源。 在配置文件里添加 homekit: 在Homekit里面屏蔽天气、设备之类的不能用的传感器 https://bbs.hassbian.com/thread-3589-1-1.html 注意：如果需要再次显示homekit的pincode，需要删除配置目录下的.homekit.state，不然怎么也没办法获得。 下面的不用再看了。 HomeBridge可以用于接入HomeKit，所以连接HomeAssistant和Homebridge就可以接入了，连接需要Homeassistant-Homebridge这个包。 安装 Node.js zero系列是armv6的cpu，直接从软件源安装会出错。 从官网查看版本列表：https://nodejs.org/dist/。 我这里用了最新的10.7.0版本，下载armv6版本的包： wget https://nodejs.org/dist/v10.7.0/node-v10.7.0-linux-armv6l.tar.gz 解压 tar -xzf node-v10.7.0-linux-armv6l.tar.gz 拷贝 sudo cp -r node-v10.7.0-linux-armv6l/* /usr/local/ 查看是否安装成功 node -v npm -v 如果直接用sudo全局安装npm包会出现gyp WARN EACCES user &quot;root&quot; does not have permission to access the dev dir...的权限问题，所以修改一下默认的安装位置。 mkdir ~/npm-global npm config set prefix '~/npm-global' 在~/.bashrc或是~/.zshrc中添加export PATH=~/npm-global/bin:$PATH 重开一个窗口，准备安装需要的包。 Homebridge npm install -g homebridge --registry=https://registry.npm.taobao.org Homeassistant-Homebridge npm install -g homebridge-homeassistant --registry=https://registry.npm.taobao.org 使用 修改Homebridge配置文件vim ~/.homebridge/config.json { &quot;bridge&quot;: { &quot;name&quot;: &quot;KittensHome&quot;, &quot;username&quot;: &quot;树莓派的mac地址&quot;, &quot;port&quot;: 45536, &quot;pin&quot;: &quot;775-82-588&quot; }, &quot;platforms&quot;: [ { &quot;platform&quot;: &quot;HomeAssistant&quot;, &quot;name&quot;: &quot;HomeAssistant&quot;, &quot;host&quot;: &quot;http://127.0.0.1:8123&quot;, &quot;password&quot;: &quot;homeassistant的密码&quot;, &quot;supported_types&quot;: [&quot;automation&quot;, &quot;binary_sensor&quot;, &quot;climate&quot;, &quot;cover&quot;, &quot;device_tracker&quot;, &quot;fan&quot;, &quot;group&quot;, &quot;input_boolean&quot;, &quot;light&quot;, &quot;lock&quot;, &quot;media_player&quot;, &quot;remote&quot;, &quot;scene&quot;, &quot;script&quot;, &quot;sensor&quot;, &quot;switch&quot;, &quot;vacuum&quot;], &quot;default_visibility&quot;: &quot;visible&quot;, &quot;logging&quot;: true } ] } 启动Homebridge：homebridge（需要先完成启动HomeAssistant） 启动成功后会出现可以扫描的数字图样，在水果的家庭App里面添加配件，扫描后输入配置文件中设置的pin码。 如果没有问题，HomeAssistant里面的“设备”应该都被添加进去了，可以控制的设备可以直接用siri来控制，也可以问siri温度之类的问题。 不需要显示的，如路由器的某个接入设备，可以在HomeAssistant网页端“自定义设备”，有一个选项是“hide in homebridge”。 每次更新HomeAssistant还需要重启HomeBridge才会更新，不知道有没有什么方便的操作。 参考 http://kittenyang.com/homebridge-practice/ http://cxlwill.cn/Home-Assistant/HomeAssistant-Device-Access/ https://home-assistant.cc/homebridge/node/ ","link":"https://taosky.github.io/post/homeassistant-2/"},{"title":"HomeAssistant基础安装和简单配置","content":" 被安利了许久，之前感觉没啥用，直到最近睡觉爬起来开关电扇难以忍受，买两个小米的开关先试试。 东西还没到，先将HomeAssistant安装在吃灰的树莓派上，了解一下操作。 以下基于Raspberry Zero W，系统为RASPBIAN STRETCH LITE。 安装 Python库 环境要求为Python 3.5.3 及以上。 创建虚拟环境：virtualenv -p python3 venv（需要先安装virtualenv） 进入虚拟环境：. venv/bin/activate 安装HomeAssistant：python3 -m pip install --upgrade homeassistant 启动：hass 首次启动需要等待安装各种库，安装完成后，打开http://你的ip:8123/应该就能看到界面了。 添加服务 sudo vim /etc/systemd/system/home-assistant@pi.service [Unit] Description=HomeAssistant After=network-online.target [Service] Type=simple User=%i ExecStart=虚拟环境路径/bin/hass -c &quot;/home/pi/.homeassistant&quot; [Install] WantedBy=multi-user.target 重新加载：sudo systemctl --system daemon-reload 启用服务：sudo systemctl enable home-assistant@pi 启动服务：sudo service home-assistant@pi start 配置 大部分设置和设备接入都是在~/.homeassistant/configuration.yaml中操作。 配置密码 取消~/.homeassistant/configuration.yaml中api_password: 行的注释，在~/.homeassistant/secrets.yaml中设置密码。 时区 ~/.homeassistant/configuration.yaml中time_zone设置为Asia/Shanghai。 设备接入 天气这种也算是设备，其实默认好像带一个日出日落，看到很多高级用法，后面的文章会讲一讲。 雅虎天气 在configuration.yaml中添加，其中woeid为城市代码，可以在雅虎天气网站获得，如：https://www.yahoo.com/news/weather/china/nanjing/nanjing-2137081中2137081。 weather: - platform: yweather woeid: 2137081 小米路由器 可以用来判断是否在家之类的。 配置如下： device_tracker: - platform: xiaomi host: 192.168.xx.1 password: 密码 其他路由器可能需要开启SSH之类的，参照：https://home-assistant.cc/component/router/ 定制地图 自带的地图是没有细节的，而这个地图更丰富加载也更快。 https://github.com/cxlwill/ha-inkwavemap 大概就是这样了，目前还啥也干不了。 其它 App使用 下载了App试用，大概和浏览器端差不多，多了通知和定位，通知好像还有点用。 出门也想操作的话就需要下面提到的外网访问了。 配置还是很简单的。 Samba 和windows的文件共享一样，可以使树莓派上的文件在网络上访问修改。 参考这篇 外网访问 这样出门也能够在App端或浏览器端进行控制，也可以用api干很多事（还没用到）。 DDNS：就是根据你的IP变化来更新DNS推荐“dns.he.net”，加入树莓派Cron定时请求一个API就可以更新，不需要路由器，可以参考这篇文章。 端口映射：纯路由器的功能，一般第三方固件都有这功能，靠谱点的路由器也有，把公网IP端口映射到局域网某个设备的某个端口，比如访问http://你的ip:2333/ 就是访问 http://192.168.1.x:2333/（注意运营商已经屏蔽了80和443端口）。 Nginx反代（非必须）：统一管理，可以配置ssl。解决无法登陆的问题见上一篇文章。 成功登陆后提示Login attempt or request with invalid authentication from 127.0.0.1，修改配置vim ~/.homeassistant/configuration.yaml, 在http下添加 trusted_networks - ::1 参考 http://kittenyang.com/homebridge-practice/ https://home-assistant.cc/ http://cxlwill.cn/Home-Assistant/HomeAssistant-Device-Access/ ","link":"https://taosky.github.io/post/homeassistant-1/"},{"title":"Nginx反代websocket的问题","content":"用nginx反代Home Assistant的时候发现登陆不上，查看请求原来是websocket出错了。 Nginx 自从 1.3 版本就开始支持 WebSocket 了，并且可以为 WebSocket 应用程序做反向代理和负载均衡。 WebSocket 和 HTTP 协议不同，但是 WebSocket 中的握手和 HTTP 中的握手兼容，它使用 HTTP 中的 Upgrade 协议头将连接从 HTTP 升级到 WebSocket，当客户端发过来一个 Connection: Upgrade请求头时，Nginx 是不知道的，所以，当 Nginx 代理服务器拦截到一个客户端发来的 Upgrade 请求时，需要显式来设置Connection 、Upgrade 头信息，并使用 101（交换协议）返回响应，在客户端和代理服务器、后端服务器之间建立隧道来支持 WebSocket。 所以在配置中添加下面三行就可以了。 proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;upgrade&quot; ","link":"https://taosky.github.io/post/nginx-proxy-websocket/"},{"title":"nginx'\"ssl_stapling\" ignored'错误","content":"解决办法 配置里面添加 ssl_trusted_certificate /path/to/fullchain， 或ssl_certificate改成fullchain路径。 简单说明 OCSP（Online Certificate Status Protocol，在线证书状态协议）是在线查询证书合法性的服务，浏览器在访问https站点时可能会去查询（以前火狐就因为OCSP服务问题导致页面访问不了）。 OCSP同时也会增加访问页面的时间，而 OCSP Stapling（OCSP 封套）直接把查询结果发给客户端，从而减少访问时间。 ","link":"https://taosky.github.io/post/ssl-stapling/"},{"title":"Centos7编译安装nginx记录","content":"因为要添加http_substitutions_filter模块，照之前的方法复制原来的nginx的参数并不行。 编译安装 下载解压zlib和pcre和http_substitutions_filter模块。 下载解压nginx源码。 参数: ./configure --with-pcre=../pcre-8.42 --with-zlib=../zlib-1.2.11 --add-module=../ngx_http_substitutions_filter_module/ --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-ipv6 --with-http_ssl_module --with-http_auth_request_module --with-http_gzip_static_module --with-http_mp4_module --with-http_gunzip_module --pid-path=/run/nginx.pid 设置服务 新建/etc/init.d/nginx #!/bin/sh # # nginx - this script starts and stops the nginx daemin # # chkconfig: - 85 15 # description: Nginx is an HTTP(S) server, HTTP(S) reverse / # proxy and IMAP/POP3 proxy server # processname: nginx # config: /etc/nginx/nginx.conf # pidfile: /run/nginx.pid # Source function library. . /etc/rc.d/init.d/functions # Source networking configuration. . /etc/sysconfig/network # Check that networking is up. [ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0 nginx=&quot;/usr/sbin/nginx&quot; prog=$(basename $nginx) NGINX_CONF_FILE=&quot;/etc/nginx/nginx.conf&quot; lockfile=/var/lock/subsys/nginx start() { [ -x $nginx ] || exit 5 [ -f $NGINX_CONF_FILE ] || exit 6 echo -n $&quot;Starting $prog: &quot; daemon $nginx -c $NGINX_CONF_FILE retval=$? echo [ $retval -eq 0 ] &amp;&amp; touch $lockfile return $retval } stop() { echo -n $&quot;Stopping $prog: &quot; killproc $prog -QUIT retval=$? echo [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile return $retval } restart() { configtest || return $? stop start } reload() { configtest || return $? echo -n $&quot;Reloading $prog: &quot; killproc $nginx -HUP RETVAL=$? echo } force_reload() { restart } configtest() { $nginx -t -c $NGINX_CONF_FILE } rh_status() { status $prog } rh_status_q() { rh_status &gt;/dev/null 2&gt;&amp;1 } case &quot;$1&quot; in start) rh_status_q &amp;&amp; exit 0 $1 ;; stop) rh_status_q || exit 0 $1 ;; restart|configtest) $1 ;; reload) rh_status_q || exit 7 $1 ;; force-reload) force_reload ;; status) rh_status ;; condrestart|try-restart) rh_status_q || exit 0 ;; *) echo $&quot;Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}&quot; exit 2 esac 修改权限chmod 755 /etc/init.d/nginx 开机启动：chkconfig nginx on 参考 http://www.liuzhixiang.com/2014/12/19/Nginx-ngx_http_substitutions_filter_module/ https://blog.csdn.net/u011781521/article/details/75675019 ","link":"https://taosky.github.io/post/centos-install-nginx/"},{"title":"Ubuntu14.04安装ElasticSearch的问题","content":"在ubuntu14.04上使用deb包安装出现systemctl.service balabala 的错误，服务启动失败，实际上已经安装成功了，手动启动一下就好（没有root权限补全都不行，也是奇怪）。 sudo /etc/init.d/elasticsearch start 同样的，移除也会报相应的错误，其实是移除的脚本里systemctl相关执行失败。 sudo vim /var/lib/dpkg/info/elasticsearch.prerm 注释掉systemctl相关行就能卸载了。 ","link":"https://taosky.github.io/post/elasticsearch-install-problem/"},{"title":"树莓派添加backports源的问题","content":"虽然backports源在zero w(ARMV6)上也不能使用，还是记录一下。 添加这两个源到/etc/apt/sources.list或/etc/apt/sources.list.d/**.list deb http://ftp.debian.org/debian jessie-backports main deb http://ftp.debian.org/debian stretch-backports main apt-get update发现有gpg key错误，添加这两个key。 sudo apt-key adv --recv-key --keyserver keyserver.ubuntu.com 8B48AD6246925553 sudo apt-key adv --recv-key --keyserver keyserver.ubuntu.com 7638D0442B90D010 报没有安装dirmngr的错误，sudo apt-get install dirmngr（之前换了国内源会产生依赖冲突，让卸载apt，搞了半天。(╯‵□′)╯炸弹！•••*～●） 再次添加，然后又报server错误，猜测dns问题，挂代理、指定ip，各种尝试后还是不行。 直接从网页查询获得key http://keyserver.ubuntu.com/pks/lookup?op=get&amp;fingerprint=on&amp;search=0x8B48AD6246925553，后面的8B48AD6246925553就是上面要添加的key值，复制-----BEGIN PGP PUBLIC KEY BLOCK-----开始的部分到文件，sudo apt-key add ***.gpg。 ","link":"https://taosky.github.io/post/raspberry-backports-sources/"},{"title":"Django分页的问题","content":"最近用django-el-pagination做列表展示，发现数据很多的时候加载很慢，在栈溢出上问了，也没人回... 说明 后来突然发现了原因，举直接返回的代码来说明，get_queryset函数返回列表数据，返回用了[::-1]倒序，而这样实际上导致了返回所有的数据再排序，在分页获取数据时，请求了所有的数据再切片，相当于mongodb中db.COLLECTION_NAME.find().sort({**:1}) 然后[::-1]再[(page-1)*NUMBER, page*NUMBER]。 class IndexView(AjaxListView): template_name = '****' context_object_name = '****' page_template = '****' def get_queryset(self): return your_model.objects.filter(title='***').order_by('**')[::-1] 下面是改之后的代码，使用了order_by(-**)直接反向排序，其实在Django内部进行了处理，在分页数据库请求时就已经进行了倒序和切片，相当于mongodb中db.COLLECTION_NAME.find().sort({**:-1}).skip(NUMBER*page).limit(NUMBER)。 ... def get_queryset(self): return your_model.objects.filter(title='***').order_by('-**') 其他数据的操作 在项目中还用到了elasticsearch检索，对于其数据的分页，需要自己实现一个代理来进行分页操作。下面是搜索到的栈溢出上的代码。其中__len__函数返回数据的数量，__getitem__函数返回的是需要的数据，在请求的部分插入item.start和item.stop来指定数据，在elasticsearch-dsl中是在s.execute()执行请求前使用s[item.start:item.stop]指定数据。 class ResultsProxy(object): &quot;&quot;&quot; A proxy object for returning Elasticsearch results that is able to be passed to a Paginator. &quot;&quot;&quot; def __init__(self, es, index=None, body=None): self.es = es self.index = index self.body = body def __len__(self): result = self.es.count(index=self.index, body=self.body) return result['count'] def __getitem__(self, item): assert isinstance(item, slice) results = self.es.search( index=self.index, body=self.body, from_=item.start, size=item.stop - item.start, ) return results['hits']['hits'] ","link":"https://taosky.github.io/post/django-pagination/"},{"title":"用IFTTT转发Google Voice消息到Telegram。","content":"2018/02/28：延迟还挺高的。。。 经常用Google Voice接收验证码，想着转发到telegram在手机上也更方便。 尝试 因为IFTTT也支持SMS功能，想着将短信转发到IFTTT号码，再触发telegram消息。但是Google Voice只能转发到验证的号码，也就是需要验证码，所以并不行。 Email功能和SMS功能类似，也需要转发到指定邮箱。Gmail转发到其它邮箱需要先对其验证，可以多用一个邮箱来二次转发，但这样有些麻烦了。 方法 其实IFTTT直接支持GMAIL≧▽≦。 在Google Voice设置中开启“将消息转发到电子邮件”。 使用这个Applet：https://ifttt.com/applets/AHLSjgG3-send-google-voice-sms-to-telegram 绑定Gmail，不需要修改。 Telegram消息内容如下， 邮件内的其它内容也包含了进去，不太清晰。 收到来自 (415) 653-7323 的新短信 February 24, 2018 at 02:33AM [哔哩哔哩]5xxxxxx 为你的手机换绑验证码,请在5分钟内完成换绑.为保证账号安全,请勿泄漏此验证码. 要回复此短信，请回复此电子邮件或访问 Google Voice。 您的帐号 帮助中心 帮助论坛 如要修改关于text messages的电子邮件偏好设置，请在您的帐号中转到电子邮件通知设置。 Google Inc.1600 Amphitheatre PkwyMountain View CA 94043 USA ","link":"https://taosky.github.io/post/google-voice-to-telegram-with-ifttt/"},{"title":"用IFTTT推送Inoreader新文章通知","content":"IOS上的Inoreader体验不太好，用IFTTT发送新文章的通知凑活着用。 由于IFTTT连接Inoreader需要PRO付费版，曲线救国，和之前的**同步Inoreader星标文章到Evernote**一样，使用Inoreader自带的输出Rss的功能。 生成文件夹RSS源 右击需要的文件夹，获取RSS订阅源，复制RSS源地址。 使用IFTTT Applet 使用这个Applet：https://ifttt.com/applets/190677p-rss-feed-notification 编辑Feed URL，填入刚才复制的RSS源地址，保存。 通知效果 安装了IFTTT应用并登录就可以收到通知了，效果如下。 查看详情用来看微博很不错，点击通知进入应用，3D Touch查看图片也不错，不再演示。 ","link":"https://taosky.github.io/post/inoreader-notification-with-ifttt/"},{"title":"一次EMUI救砖经历","content":"好多天前了。。。 起初是想用官方助手回退然后重新上锁，忘记把TWRP换成官方Recovery，导致开机系统出错，无限重启。 Recovery也无法进入，通过搜索得知EMUI3.x能用的TWRP和4.x是不同的，猜测是系统实际恢复到了3.x，下载了3.x能用的TWRP，通过BootLoader（须接电源才能进入）刷入，恢复之前的备份等一通操作后还是不行。 通过自带自带的恢复系统（忘了怎么进的，应该也是要插电源），联网自动下载恢复，然而安装完还是不行。 刷入twrp线刷工具自带的官方Recovery（EMUI 4.x版），多次尝试后无果。 此处省略5000字。。。 下载官方3.x的包（官网居然不提供了，找了半天），刷入Recovery，Reocvery2（也就是那个恢复系统），再次使用恢复系统恢复，居然就成功了。虽然还是上不了锁，但是总算是救活了。 ","link":"https://taosky.github.io/post/emui-recovery/"},{"title":"搬瓦工64M小鸡记录：(四)PHP","content":"安装php相关包。 apt-get install php5-cgi php5-cli php5-fpm php5-cgi 修改fpm监听用户为nginx默认用户。 vi /etc/php5/fpm/pool.d/www.conf listen.owner = nginx listen.group = nginx 配置nginx (默认最后为include fastcgi_params;，打开页面并不执行php，更换后可用，原因不明)。 server { listen 80; server_name php.zxc.science; root /var/www/php.zxc.science; location / { try_files $uri $uri/ =404; } location ~ /.php$ { fastcgi_split_path_info ^(.+/.php)(/.+)$; fastcgi_pass unix:/var/run/php5-fpm.sock; #可能需要设置php-fpm通过sock和nginx通信 fastcgi_index index.php; include fastcgi.conf; } } 添加开机启动。 默认不带服务，和前面几篇一样添加即可。 ","link":"https://taosky.github.io/post/bandwagon-64m-php/"},{"title":"MongoDB技巧","content":"记录一下使用过程中的收集的一些技巧。 字符串是否包含指定子串 （substring为子串） db.usercollection.find({name:{$regex: .*substring.*}}) 字符串字段值长度 db.usercollection.find({name: {$type: 2}, $where: &quot;this.name.length &gt; 40&quot;}).limit(2); 或 db.usercollection.find({name: {$exists: true}, $where: &quot;this.name.length &gt; 40&quot;}).limit(2); regex db.usercollection.find({&quot;name&quot;: {&quot;$type&quot;: 2, &quot;$regex&quot;: /^.{41,}$/}}).limit(2); 数组是否包含指定的数据 （tags为数组字段,usercollection为指定collection） db.usercollection.find({tags: {$in: ['a']}}) labix.org/v2/mgo（未测试） C.Find(bson.M{&quot;tags&quot;： &quot;a&quot;}).All(&amp;usercollection) c.Find(bson.M{&quot;tags&quot;: bson.M{&quot;$in&quot;: []string{&quot;a&quot;}}}).All(&amp;usercollection) 删除重复数据的简单方法 1.导出数据： mongoexport.exe -d database_name -c collection_name -o filename.json 2.清空当前collection： db.usercollection.remove({}) 3.新建唯一索引： db.usercollection.createIndex({public_no:1}, {unique:true}) 4.导入数据： mongoimport -d database_name -c collection_name --upsert filename.json ","link":"https://taosky.github.io/post/mongodb-little-skills/"},{"title":"PostgreSQL使用","content":"啊，这篇太水了,以后可能会更新吧，主要是和Django使用，好像没有过多的用到命令操作。 关于配合Django使用，参照这篇 大部分操作和mysql等类似。 postgres以用户账户形式登录。 sudo -i postgres psql以默认账户登录到数据库shell。 /c your_db选取数据库。 /q退出。 正则？ WHERE yourfiled ~ 'your string' 备份指定db pg_dump dbname &gt; outfile 恢复 psql dbname &lt; infile 完全备份（包括表空间和用户） pg_dumpall &gt; outfile 恢复全部 psql -f infile postgres 外网访问 sudo vim etc/postgresql/9.x/main/postgresql.conf 添加行listen_addresses = '*' sudo vim etc/postgresql/9.x/main/pg_hba.conf 添加行host all all 0.0.0.0/0 md5 ","link":"https://taosky.github.io/post/PostgreSQL/"},{"title":"N4语法小结（1）","content":"～ず 不～ 没～ 食べずにねってしまった。 ～たがる （第三人称）想要～ 妹はいきたがります。 ～がる （第三人称）感到～ 觉得～ 子供はこあがっている。 ～てある ～着 本にかいてある。 ～ている 正在 ～了 ～着 ＊知ています。 知りません。 持ています。 ～ておく/～とく 事先～ いっときます。 ～ていく ～而去 とりがとんでいく。 ～下去 頑張っていく。 ～てくる 去去就来 切符を買ってきます。 朝这里来 電車が走ってきました。 一直～ 到现在 勉強を続けてきました。 ～てしまう/ちゃう ～完了 財布を忘れちゃった。 ～てみる 试着（试试看）～ やってみる。 ～を～ ～过～（经过的场所地点） 橋を渡る。 ～から 因为～ 日曜日だから、人が多いです。 ～ので 因为～ 雨なので、キャンサルしました。 ～のに 却、明明（转折） わかったのに、教えてくれない。 ～ても/でも 就算～也～ 不管～都～ 家に帰っても、日本語を勉強する。 疑问词 でも 无论～ 随便～ どこでも寝られます。 ～す（過）ぎる 过于～ 飲みすぎる。 ～だす 开始～ 雨が降り出した。 ","link":"https://taosky.github.io/post/N4-summary-1/"},{"title":"日语学习笔记31、32课","content":"と 表示习惯、反复（一...样，就...样） お酒を飲むと、顔が赤くなります。 真理、恒定的（一...样，就...样） 春になると、花が咲く。 夜になると、暗くなります。 表示新的情况（意外）（...之后） 部屋に入ると、知らない女がいた。 窓を開けると、外はましろだった。 表示条件假设 ないといけません（必须） 明日雨が降ると、行きません。 形容词修饰副词 形1：い く 动词 早い 早く 楽しい 楽しく *特殊： いい よく 动词 形2：词干 に动词 静か 静かに 今日家に早く帰らないといけません。 动词基本型/ない型 ことがあります。（有时会） 週末の時、たまに庭でご飯を食べることがあります。 父はたまに外国へ出張に行くことがあります。 -朝ご飯を食べないことがありますか。 -はい、あります。 动词基本型/ない型 つもりです。 （说话之前已经形成的意志、打算） 来年結婚するつもりです。 上海へ飛行機で行くつもりです。 -何をするつもりですか。 -もう一度頑張るつもりです。 お酒を飲まないつもるです。 动词基本型/ない型 ことにします。 （说话人自己决定实施某种行为） アメリカに留学することにしました。 名词 にします。 决定/选定（点菜） 动词基本型/ない型 ことになりました。 （外在原因导致某种决定） 雨で、運動会を中止することになりました。 中止になりました。 （名词化形式做宾语时，の和こと可以互换，语言行为动词只能こと。） 消息来源 によると/によれば/では、简体小句 そうです （传闻） 天気予報によると、明日雨が降るそうです。 ニュスによると、野菜の値段が上がるそうです。 王さんの話によると、四川料理がとても辛いそうです。 其它 きちんと 准确地、正确地 まっすぐ 笔直地 いつでも 随时 ただし 只不过，部分相反 （しかし 但是，完全相反） ここから３００メートルほどいくと 「ほど：左右」 ほど只能用于“段”，ぐらい可以用于点和段。 連休中はずっと晴れだそうですよ 「ずっと：一直」 ところで、太田さんって、どんな人ですか 「ところで：另起话题」 できるだけ連絡を取ろうと思っています。 「できるだけ：尽量的」 ","link":"https://taosky.github.io/post/japanese-learn-note-31-32/"},{"title":"搬瓦工64M小鸡记录：(三)Socks5","content":"主要用于telegram，爬墙危险，不要滥用。 编译安装 编译须先安装这两个包。 apt-get install libldap2-dev libpam0g-dev wget https://nchc.dl.sourceforge.net/project/ss5/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz tar xvf ss5-3.8.9-8.tar.gz cd ss5-3.8.9 ./configure &amp;&amp; make &amp;&amp; make install 配置 修改配置文件/etc/opt/ss5/ss5.conf，取消注释,并加上'u'。 auth 0.0.0.0/0 - u permit u 0.0.0.0/0 - 0.0.0.0/0 - - - - - 修改/etc/opt/ss5/ss5.passwd，配置用户、密码（空格分隔，可多行）。 开机自启 新建/etc/init.d/ss5.sh。 #!/bin/sh ### BEGIN INIT INFO # Provides: taosky # Required-Start: $local_fs $remote_fs # Required-Stop: $local_fs $remote_fs # Should-Start: $network # Should-Stop: $network # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: socks # Description: ss5 ### END INIT INFO mkdir /var/run/ss5/ &amp;&amp; export SS5_SOCKS_USER=root &amp;&amp; export SS5_SOCKS_PORT=23 &amp;&amp; ss5 chmod +x /etc/init.d/ss5.sh添加执行权限。 update-rc.d ss5.sh defaults添加启动脚本 ","link":"https://taosky.github.io/post/bandwagon-64m-shadowsocks-ss5/"},{"title":"搬瓦工64M小鸡记录：(二)Shadowsocks-libev相关","content":"安装Shadowsocks-libev 添加更新源。 echo &quot;deb http://http.us.debian.org/debian jessie main&quot; &gt;&gt; /etc/apt/sources.list apt-get update 安装依赖。 apt-get -y --no-install-recommends install gettext build-essential autoconf automake libtool openssl libssl-dev zlib1g-dev xmlto asciidoc libpcre3-dev libudns-dev libev-dev git ca-certificates unzip libc-ares2 安装libsodium。 cd wget --no-check-certificate https://github.com/jedisct1/libsodium/releases/download/1.0.12/libsodium-1.0.12.tar.gz tar xf libsodium-1.0.12.tar.gz &amp;&amp; cd libsodium-1.0.12 ./configure &amp;&amp; make &amp;&amp; make install ldconfig 安装c-ares。 cd git clone https://github.com/c-ares/c-ares.git cd c-ares ./buildconf ./configure &amp;&amp; make &amp;&amp; make install 安装shadowsocks-libev。 cd wget https://github.com/shadowsocks/shadowsocks-libev/releases/download/v3.1.3/shadowsocks-libev-3.1.3.tar.gz tar zxf shadowsocks-libev-3.1.3.tar.gz &amp;&amp;cd shadowsocks-libev-3.1.3 ./configure make &amp;&amp; make install 安装Simple-obfs 可以伪装网站流量，和网站共用443端口也需要它。 git clone https://github.com/shadowsocks/simple-obfs cd simple-obfs &amp;&amp; git submodule init &amp;&amp; git submodule update ./autogen.sh ./configure --prefix=/usr --disable-documentation make &amp;&amp; make install 配置 新建配置文件/etc/shadowsocks-libev/config.json。 { &quot;server&quot;:[&quot;[::0]&quot;, &quot;0.0.0.0&quot;], &quot;server_port&quot;:443, &quot;local_port&quot;:1080, &quot;password&quot;:&quot;yourpassword&quot;, &quot;timeout&quot;:60, &quot;method&quot;:&quot;rc4-md5&quot;, &quot;dns_ipv6&quot;:true, &quot;plugin&quot;:&quot;obfs-server&quot;, &quot;plugin_opts&quot;:&quot;obfs=http;failover=127.0.0.1:8443&quot; } 其中server指定了ipv6地址和v4地址，dns_ipv6优先使用ipv6解析地址，最后两行设置使用obfs伪装http流量并将网站请求转到8443端口。 需要修改nginx配置，将443端口改为8443。 开机自启 （尝试了源码中的'shadowsocks-libev.init'和'shadowsocks-libev.default'创建服务，启动没有反应。） 新建/etc/init.d/ss-libev.sh。 #!/bin/sh ### BEGIN INIT INFO # Provides: shadowsocks-libev # Required-Start: $local_fs $remote_fs # Required-Stop: $local_fs $remote_fs # Should-Start: $network # Should-Stop: $network # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: ss-server # Description: shadowsocks-libev ### END INIT INFO /usr/local/bin/ss-server -c /etc/shadowsocks-libev/config.json -f /tmp/ss-server.pid chmod +x /etc/init.d/ss-libev.sh添加执行权限。 update-rc.d ss-libev.sh defaults添加启动脚本 加速 之前用过这两个方法，不过在请求多的时候内存占用会很高，有时候反而变慢(定时重启会缓解)，所以关掉了。 （需要系统支持，可能不适用与debian 7 x86） Kcptun：https://ihkk.net/bandwagon-host-improve/ （损人不利己，慎用） BBR：我的印象笔记链接（原文404） 参考： http://awy.me/2017/05/64m-nei-cun-vps-li-yong-shou-zha-yi-an-zhuang-shadowsocks-libev/ https://www.denpe.com/debian-autorun/ https://bbs.letitfly.me/d/301 ","link":"https://taosky.github.io/post/bandwagon-64m-shadowsocks-libev/"},{"title":"搬瓦工64M小鸡记录：(一)Nginx反代","content":"之前弄的东西太多太乱，索性重新弄一遍。 0 在vps面板安装debian7.0 x86 minimal（毕竟只有64M）。 apt-get update 解决public key 错误。 apt-get install debian-keyring debian-archive-keyring apt-key update Nginx安装 直接安装版本比较老，添加nginx的官方安装源到/etc/apt/sources.list。 deb http://nginx.org/packages/debian/ wheezy nginx deb-src http://nginx.org/packages/debian/ squeeze nginx 导入key。 wget http://nginx.org/keys/nginx_signing.key &amp;&amp; apt-key add nginx_signing.key apt-get update apt-get remove --purge nginx nginx-full nginx-common apt-get install apt-utils dialog apt-get install nginx 添加模块 要用到nginx_substitutions_filter这个模块进行正则替换，需要把模块编译进nginx然后替换现有的文件。 （之前尝试了其它的方法都没有成功，可能需要安装一些编译用的依赖） nginx -V查看版本号和编译参数。 下载并解压nginx源码，这里是1.12.1版本。 wget http://nginx.org/download/nginx-1.12.1.tar.gz tar -xzvf nginx-1.12.1.tar.gz 下载模块源码。 git clone git://github.com/yaoweibin/ngx_http_substitutions_filter_module.git 添加模块并编译。 cd nginx-1.12.1 ./configure --add-module=/tmp/ngx_http_substitutions_filter_module [这里是之前查看到的编译参数] make &amp;&amp; make install 配置nginx server 在/etc/nginx/conf.d/下新建'.conf'文件，nginx会自动加载。 server { listen 80; server_name xxx.mou.science; location /.well-known { alias /var/www/xxx.mou.science/.well-known; } } 这里的/.well-known 是将xxx.mou.science/.well-known 指向了网站目录下的这个文件夹，申请证书时用来验证。 每次修改后需要重启nginx。 /etc/init.d/nginx restart 使用certbot脚本来申请Let's Encrypt证书。 wget https://dl.eff.org/certbot-auto chmod a+x certbot-auto certbot-auto certonly 第一次运行需要安装，要输入邮箱用于提醒。 选择'3: Place files in webroot directory'，之后按照提示输入域名，选择网站目录，等待验证通过，证书会保存到本地。 验证通过后再次修改配置(以google为例)。 server { listen 80; server_name xxx.mou.science; rewrite ^ https://$host$request_uri? permanent; # 重定向 } server { listen 8443 ssl; server_name xxx.mou.science; ssl_certificate /etc/letsencrypt/live/xxx.mou.science/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/xxx.mou.science/privkey.pem; ssl_stapling on; ssl_stapling_verify on; location /.well-known { alias /var/www/xxx.mou.science/.well-known; } location / { proxy_pass https://www.google.ca; proxy_cookie_domain google.ca xxx.mou.science; proxy_set_header Accept-Encoding &quot;&quot;; proxy_set_header User-Agent $http_user_agent; proxy_set_header Accept-Language &quot;zh-CN&quot;; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto https; proxy_set_header Cookie &quot;PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2W1IQ-Maw&quot;; subs_filter www.google.ca xxx.mou.science; subs_filter ssl.gstatic.com yyy.mou.science; # 这个也需要反代，此处不演示。 } } /etc/init.d/nginx restart 这时候应该就可以访问了。 参考： http://blog.csdn.net/DBABruce/article/details/50905797 ","link":"https://taosky.github.io/post/bandwagon-64m-nginx/"},{"title":"日语学习笔记29、30课","content":"命令形（めいれいけい） 使用场景 *男用，上司对下属，很好的朋友（互相），危急情况下，热烈的气氛下（比赛加油） 变形 一类动词：“う”段 -&gt; “え”段 言う 言え 作る 作れ 待つ まて 死ぬ 死ね 二类动词：“る” -&gt; “ろ” 食べる 食べろ 起きる 起きろ 三类动词：くる -&gt; こい 、 する -&gt; しろ/せよ 勉強する 勉強しろ/せよ 例子 お金を出せ！ 真面目に仕事をしろ！ 野菜をたべろ！ なさい（父母对孩子、老师对学生的命令） 自分の部屋は自分で掃除しなさい。 もっと練習しなさい。 自分できめなさい。 授業中には静かにしなさい。 动词基本型 な（禁止、不允许） 泣くな。 たべるな。 部屋を入るな。 ここに荷物を置くな。 と言う 1.说、讲 王さんは今日来ないと言いました。 2.叫做 桜と言う花は綺麗だ。 新宿と言う所へ行きます。 魯迅と言う作家は有名です。 吉田という人に会いました。 意志形（表示意志、想法、决心等，ましょう的口语形式） 变形 一类动词：“う”段 -&gt; “お”段 う 会う 会おう 作る 作ろう 待つ 待とう 遊ぶ 遊ぼう 二类动词：るよう 食べる 食べよう 三类动词：くる -&gt; こよう 、 する -&gt; しよう 勉強する 勉強しよう 僕と結婚しましょう。＝僕と結婚しよう 意志形 と思います。（想要做某事，不能表示别人的想法） 英語を勉強しようと思います。 将来先生になろうと思います。 新しい靴を買おうと思います。 留学について、両親と相談しようと思います。 意志形 と思っています。 1.表示某种意志持续了一段时间，一直想做某事 2.第二人称时用，你想...吗 （表示当场形成的意志时只能用意志形，不能用と思...） 小句1ので 小句2（表原因，小句2只能为结果，の是名词化） 天気がいいので、散歩しました。 王さんは親切なので、人気がある。 昼ご飯を食べたので、今は何も食べたくない。 今日は息子の誕生日ので、早く帰りました。 「ので」和「から」 1.接续不同（简体或敬语） 2.「から」主观、「ので」客观 3.「から」生硬、「ので」委婉（道歉用ので） 其它 片づける 收拾 エベレスト 珠穆朗玛 カササギ 喜鹊 仕事が終わってから。「て＋から：之后」 出かけようとした時に...「动词意志形＋とする：正要」 ちょうど 「刚好、正好」 どの行楽地も人でいっぱいですよ。「いっぱい：填满、达到饱和状态」 ","link":"https://taosky.github.io/post/japanese-learn-note-29-30/"},{"title":"日语学习笔记27、28课","content":"次要动作ます ながら 主要动作（一边...一边...） 私はテレビを見ながらご飯をたべます／ています。 森さんは泣きながら映画を見ています。 私は音楽を聞きながら部屋を掃除しています。 ー森さんは何をしています。 ーたぶん休みながらタバコを吸っているでしょう。 小句简体 時（n）「＋に表示特别情况」 暑い時 冷たいものをみたい。 静かな時 寝たくなります。 夏の時 友達と海へいきました。 電車に乗る時 財布を電車に忘れた。 風邪が引いた時 学校へ行きません。 名词 で（表示客观原因，因为...） 病気で 会社を休みました。 雪で 電車が止まっている。 仕事で 王さんと会いました。「と：偏互动，に：偏单方面」 动词て形 います 动作正在发生 昼ご飯を食べています。 映画を見ています。 结果存续的状态（...了/...着） あの人は死んでいます。 王さんは結婚しています。 パソコンは壊れています。 动作行为的反复发生 姉は銀行で仕事をしています。 駅前のスーパはいつも安い商品をています。 反复的习惯 私は毎日運動しています。 小句简体 でしょう（这里表确认） 对方掌握的信息更多，音调↗。 责问、意见不一，音调↘。 授受关系 授予者 は 接收者 に 名词 を くれます（只能是我/我一方的人受益） 田中さんは私に花をくれました。 姉は私に新しい漫画をくれました。 王さんが私にて手作りのケーキをくれました。 授予者 は 接收者 に 名词 を 动词て形 くれます（同上、给我/我一方的人做某事） 母は私に本を読んでくれます。 王さは私に写真を撮ってくれます。 先生は私たちに日本語を教えてくれています。 彼女は私に料理を作てくれました。 授予者 は 接收者 に 名词 を 动词て形 あげます（受益者不能是我） 私は友達に本を貸してあげます。 张さんは李さんに荷物を持ってあげます。 接收者 は 授予者 に 名词 を 动词て形 もらいます。（请别人做某事、授予者不能是我、表歉意） 私は日本人に日本語を教えてもらいます。 其它 私は学生です。「は强调后面的内容」 私が学生です。「が强调前面的内容」 私は友達に本を貸してもらいます。「最后一个动词（もらいます）对应は前面的人（わたし）」 について「关于」 なかなか「相当、很」 北京行きの飛行機「动词去ます形是名词」 どの公園も有料ですか。「ど も か、询问所有的公园都要收费吗」 そう言えば「这么说来」 この文章の意味がわからないですが...「が：委婉的铺垫」 送る「邮寄的送」 林さん もう少し待ってもらいたいのですが。「もう：这里表示再稍微，单独出现时表示已经」 いろいろと「と：副词后缀，可去」 今度「这次或离这次很近的下次」 引っ越し先「先：表目的地，搬家去的地方」 ","link":"https://taosky.github.io/post/japanese-learn-note-27-28/"},{"title":"Windows子系统相关","content":"Win10 1709版本已经可以在应用商店直接安装了，所以重新安装使用试试，一大波软件可以卸载了。 安装 商店就可以了，目前有三个发行版可以安装，自己也可以替换成其它发行版，网上教程很多。 相关优化 貌似有很多人使用其它终端代替，其实在win上显示效果都不会很好，感觉还不如用自带更简单方便。 也可以用ssh连到子系统上，emmm，好像没啥用。。。 右键菜单 导入注册表： Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT/Directory/Background/shell/WSL] @=&quot;WSL &amp;Bash Here&quot; &quot;Icon&quot;=&quot;%programfiles%//WindowsApps//CanonicalGroupLimited.UbuntuonWindows_1604.2017.922.0_x64__79rhkp1fndgsc//images//icon.ico&quot; [HKEY_CLASSES_ROOT/Directory/Background/shell/WSL/command] @=&quot;/&quot;C://Windows//System32//bash.exe/&quot;&quot; 字体 Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Windows NT/CurrentVersion/FontLink/SystemLink] &quot;Consolas&quot;=hex(7):4d,00,53,00,59,00,48,00,2e,00,54,00,54,00,43,00,2c,00,ae,5f,/ 6f,8f,c5,96,d1,9e,2c,00,31,00,32,00,38,00,2c,00,39,00,36,00,00,00,00,00 [HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Windows NT/CurrentVersion/Console] &quot;微软雅黑&quot;=&quot;msyh.ttc&quot; **来自 https://www.v2ex.com/t/398557** 导入上面的注册表并重启，打开 bash，设置字体为 consolas，看看中文显示是否使用雅黑了，cmd 设置要麻烦一点： 先运行 chcp 437，然后点击标题栏，设置属性，将字体设置为 consolas 退出，此时字体已经变成 consolas 了，然后运行 chcp 936，关闭再打开 cmd，现在默认英文字体成为 consolas，中文字体使用雅黑显示。缺点是 chcp 936 后，不能再设置 cmd 属性了，会恢复成宋体显示，又得再用之前的办法设置一次 我后面换成了Yahei Mono 20号，效果也不错。 zsh 正常安装zsh,并使用oh-my-zsh。 有一点需要注意：修改.bashrc的时候，在最后加上bash -c zsh（试了几种方法，其它的都会导致一些命令不能执行。） 关闭控制台音量 用cmd的时候就深有体会了吧。。。 其它问题 刚用的时候遇到了服务开启端口后没有办法访问到（如web服务不能在浏览器中访问），官方的issue上也有很多人讨论。有人指出是一些网络加速软件或安全软件的问题，需要卸载才行。我卸载了wegame就能访问到了。 不能后台，关闭了bash窗口之后就彻底退出了，这个只能等官方后续更新了，不过我只是用来替代一些软件，也不需要运行什么服务。 ","link":"https://taosky.github.io/post/windows-subsystem-for-linux/"},{"title":"日语学习笔记25、26课","content":"现在按照课文顺序，一篇两课似乎比较合理，准备最后再整理一遍。 10月2号就创建了这个post，一直都没写，行动力低下啊。。。 标点符号居然很纠结，win10默认的日文输入法好像不太好用。 定语从句 定语作谓语 これは（有名な重なり作家が書いた）小説です。 あれは（動物園で撮った）写真です。 （母からもらった）花です。 これは（来年私と結婚する）人です。 今日は何もしたくない一日です。 定语作主语 （昨日見た）映画は面白かったです （王さんが作った）クッキーは。。。 （私が住んでいる）所は駅から遠い。 （木の下にいる）男は誰ですか。 定语作宾语 （パーティーで撮った）写真をメールで送りました。 （彼氏にもらった）プレゼントが好きです。 定语是形/名 后面直接跟 过去式表确认/感叹 今日泊まるホテルは天安飯店でしたね。 小句（简体）でしょう「或’たるう’,口语、上对下」（表推测 ...吧） 日本語は難しいでしょう。 桜は綺麗でしょう。 パーティはたぶんもうまったでしょう。 森さんはたぶんまだ結婚していないたるう。 小句（简体）かもしれません（表推测，确信度不如でしょう） （用法同上） 小句（动词简体）のは/を/が（动词小句の为名词化） （日本語を勉強するの）は大変です。 （友達を話すの）は楽しいです。 （公園で散歩するの）は面白いです 名词化形式作宾语时，の和こと可以呼唤，语言行为动词，只能用こと。 （私は料理を作るの）が好きです。 （私は日本語を勉強するの）が好きです。 （私は映画を見るの）がすきではありません。 （私は部屋を掃除するの）が嫌いです。 （私は甘い物を食べるの）が苦手です。 （私はミルクを置くの）を忘れました。 （私は留学するの）をやめました。 其它 何をしているんですか。「ん是の的口语化、表强调」 ゆっくり「慢慢地、好好地」 でしたね「过去式表确认」 ずいぶんまっすぐな道路ですね。「ずいぶん：相当、表程度高」 。。。ですからね。「放句末一般表原因」 。。。ですね。「ね有确认的意思] あまりじょうずではありません。「あまり后接否定，表示不太怎么样」 2時には終わるでしょう。「は表强调」 図書館から借りた本はまだよんでいません。「进行时否定表示“还没”] ー吉田さんが転勤したのを知っていますか。 ーえっ。。。知りませんでした。 「在提问时只能用进行时。肯定回答时用进行时，否定回答用现在时。」 それで，つい握手するのをわすれます。「それで：于是，つい：一不留神就...」 日本にはお辞儀のほかのあいさつはないんですか。「ほか：他、这里表示除了鞠躬，あいさつ：挨拶、寒暄」 ","link":"https://taosky.github.io/post/japanese-learn-note-25-26/"},{"title":"在openshift(旧版)上运行GcmForMojo服务端","content":"2017-02-03更新: openshift 不能开其他端口导致发消息的插件不能加载，App上登录扫码停止等事件通知好像也有问题，还是用Arukas的免费docker比较好(镜像：'rastasheep/ubuntu-sshd',需要安装'make'以及'libssl-dev'再安装模块) GcmForMojo 是一个微信或QQ消息推送(谷歌的FCM推送方案)APP。 简单的说是通过服务器登录发送接收到的聊天消息到谷歌服务器，接着推送到App，实现类似苹果的云推送，不用打开app也能收到消息。 由于需要服务器搭建服务端，特地买个VPS来搭服务端的话太浪费了，自己电脑啥的终究有点麻烦且不是长久之计，于是尝试了openshift发现很适合。 本教程使用Ubuntu虚拟机(之前写Windows教程发现很多麻烦问题) 写的有点罗嗦，排版也不太好，还请见谅。 注册 新注册的帐号是新的控制台，现在还不知道怎么搞 (╯-_-)╯~┴—┴ 旧版往下看 添加应用及公钥 添加应用 登录Web控制台后添加应用(Add Application)，找到&quot;Perl 5.1.0&quot; 然后这些东西都不用改直接 点创建应用(Create Application)。 添加公钥 Ubuntu终端下ssh-keygen 生成密钥对，一路回车。 打印并复制公钥 回到openshift，进入Settings，添加公钥(Add a new key),Key name随便填，下面的框填写刚才复制的公钥。 接下来就可以连接服务器了。 服务端程序 git提交程序 回到应用复制这个地址 终端下git clone &lt;刚才的地址&gt; 先安装两个perl模块，openshift只需要将依赖的模块名写进一个文档push的时候会自动安装。 进入.openshift目录，修改cpan.txt，添加两行。 Mojo::Weixin Mojo::Webqq 接着写一个用以运行的perl程序(以微信为例，记得修改其中的令牌ID) use Mojo::Weixin; $tmpdir_dir = './'; $qrcode_path = $tmpdir_dir.'weixin.png'; my $client = Mojo::Weixin-&gt;new( tmpdir=&gt;$tmpdir_dir, cookie_dir=&gt;$tmpdir_dir, qrcode_path=&gt;$qrcode_path, ); print &quot;Logining.../nIf No Succeed Info in 5s Please Scan QRCode/n&quot;; $client-&gt;on(login=&gt;sub{ print &quot;/nLogin Succeed/n&quot;; }); $client-&gt;on(ready=&gt;sub{ print &quot;WebWeiXin OK/n&quot;; unlink($qrcode_path); }); $client-&gt;load(&quot;ShowMsg&quot;);$client-&gt;load(&quot;GCM&quot;,data=&gt;{ api_url =&gt; 'https://gcm-http.googleapis.com/gcm/send', api_key=&gt;'AIzaSyB18io0hduB_3uHxKD3XaebPCecug27ht8', registration_ids=&gt;[&quot;这里填写你的令牌ID(手机App显示令牌)&quot;], }); $client-&gt;run(); 然后提交到服务器 git add . git commit -m &quot;first commit&quot; git push 第一次需要等一会儿， 运行程序 ssh 连接服务器(本来想action hook直接就能运行，有点问题还得老老实实自己运行) 进入目录 nohup执行刚才放进去的程序Weixin.pl(nohup执行后再按一次回车即可后台运行) 如果是第一次登录或是cookie失效，可以用浏览器访问你的应用查看二维码并扫码登录。 nohup.out 可以查看运行日志(unicode编码) 注意：cookie也可以获取到，所以不要将自己的地址暴露出去。也可以修改代码改变保存目录，太懒没去看文档。。。 至此应该是可以用了，可以和可爱的小冰聊天测试 ≧▽≦ 。 ","link":"https://taosky.github.io/post/run-GcmForMojo-server-on-openshift/"},{"title":"给博客添加instagram相册","content":"2017/11/17 复活了，简单地用vue和fancybox3写的。 失效，打算之后用vue写一个 https://zxc.science/instagram/ 之前就看上了Yilia主题作者博客的instagram相册，这次参考了Raysmond的教程和代码。由于不会js就用python来处理数据，生成页面代码，图片上传到了又拍云，用fancybox效果好像还行。 目前还只能手动更新。 ","link":"https://taosky.github.io/post/instagram-album/"},{"title":"火狐配置分享","content":" 坟 也算是个备份吧。 以前也用过各种定制版，还是喜欢简洁一点的自用配置，也因此没有使用UC脚本(据说Firefox 57 就全都不能用了)。 2017/3/31： e10s也卡的不行，偷了点奶酪的配置改改用，UC脚本比扩展顺畅多了啊，Firefox在追寻chrome 的道路上可能真的药丸了。。。 扩展 Stylish 火狐三大神器之一，装了扩展后安装样式站上的样式，可以修改网页风格，也被用来屏蔽某些烦人的网页元素。（可修改浏览器本身的风格）。在后面分享使用的样式。 Greasemonkey 火狐三大神器之一，自动在页面上执行JS脚本，也就是俗称的油猴脚本，可以解除网站的一些限制或是实现一些便捷操作。同样在后面分享。 lastpass（换用keepass） 网站密码管理器，可以自动填写、自动提交什么的。我在很多网站基本就是随机生成密码然后保存在里面。 由于是连接网络的，有些人觉得不安全。我也尝试过一些本地的，还是这个简单啊。 Pan以及Pan 元素隐藏辅助工具(看了下占内存有点多，已换ublock 和 AutoProxy-ng) 可以同时管理代理和广告规则，可以说是省了个扩展吧，功能的话和antoproxy和abp这些差不多。 User-Agent Switcher 快速切换UA(用户标识)，在某些需要伪装移动端的时候游泳吧。 FireGestures 手势扩展，用于后退，前进之类的以及浏览器操作，也可以执行用户脚本。暂时用了&quot;用chrome/IE打开本页面&quot;和&quot;划词翻译&quot; Evernote Web Clipper(评价很差，现在先试用的chrome应用商店转换的) 用于印象笔记收藏 Open With 配合 you-get 使用，详见Firefox告别Flash（配合you-get观看下载在线视频） 智能HTTPS 配置一些页面自动跳转https，如谷歌网页缓存。 Grab and Drag 像手机一样用鼠标拖动页面。在某些页面可能会导致不能输入（如leetcode）。顺便贴下选项设置。 Puzzle Bars &quot;把您的附加组件按钮和其他的东西拼凑在一起，放在你想放在的地方！&quot; right_click_close 右键标签页关闭，需要调出标签页菜单可以按住shift右击。 Add to Search Bar 添加网页上的搜索到搜索引擎，如豆瓣搜索，也可以添加搜索搜索关键字，地址栏如&quot;db [关键字] &quot; 可以快速用豆瓣搜索。 Beyond Australis 最近发现的，扩展网页面积，自动隐藏导航栏，有很多设置。 用户样式 Firefox Windows 10 火狐界面样式。 Chrome/Firefox/Opera scrollbar 隐藏标签关闭按钮 .tab-close-button {display:none !important;} 屏蔽淘宝登录扫码 @-moz-document domain(&quot;login.taobao.com&quot;) { /* 屏蔽二维码登陆及切换按钮 */ .quick-form,#J_Quick2Static,#J_Static2Quick { display: none!important; } /* 显示密码登陆 */ #J_StaticForm { display: block!important; } } 我的知乎不可能这么英俊 V0.2 Beta 百度多栏 Baidu Lite 百度轻 脚本 (贴地址有点麻烦，greasyfork上应该都有) 百度贴吧图片放大 &quot;点击图片放大，再次点击还原&quot; 哔哩哔哩（bilibili.com）播放器调整 &quot;B站播放器自动宽屏，自动播放视频，定位到播放器位置，选择视频画质，显示隐藏弹幕等。&quot; 腾讯视频h5 &quot;腾讯视频html5播放器&quot;，这个其实是我之前模仿B站html5脚本写的，就是修改UA，高级点的功能应该也是不会有了。 贴吧回复提醒 &quot;提供贴吧新消息提醒&quot; 网盘自动填写密码【增强版】 &quot;网盘自动填写提取密码【增强版】+网盘超链接与提取码融合。&quot; 知乎免登录 &quot;知乎免登录查看回答全文并显示更多回答&quot; anti-redirect (typescript) &quot;反重定向&quot; YouTube Downloader &quot;Download 60fps MP4 videos and 128kbps MP3 audio from YouTube&quot; 其他(新标签页) 大致参考新标签页样式之样式版RunningcheeseSuperstart(原文404) 样式在高版本火狐上有问题(见贴子16L楼中楼)，需要添加59行的 .newtab-thumbnail { height: auto; } 可以参考我的： @namespace url(http://www.w3.org/1999/xhtml); @-moz-document url(&quot;about:newtab&quot;) { /*//////////////////////拨号设置//////////////////////*/ #newtab-customize-button {display: none !important;} #newtab-intro-what {display: none !important;} #newtab-title {display: none !important;} .newtab-title:before,.newtab-control{display: none !important;}/*隐藏控制按钮和固定标识*/ /*背景图片*/ body{ background-image:url(&quot;http://taoskyme.qiniudn.com/ss_background.png&quot;) !important; } .newtab-site { border-radius: inherit; text-decoration: none; transition-property: top, left, opacity, box-shadow, background-color; box-shadow: none; border-radius: 20px; } /*圆角 .newtab-link { border-radius: 20px; } */ /*阴影及动画*/ .newtab-cell:not([ignorehover]) &gt; .newtab-site:hover, .newtab-site[dragged] { border: 0px solid #AAAAAA; box-shadow: 0 2px 2px 0px #FFC125; margin: -1px; } /*方块的大小及左右间距*/ #newtab-grid &gt; .newtab-cell{ height: 75px; width: 75px; margin: 20px 17px; } /*网站标题隐藏*/ .newtab-title {display: none !important;} /*拨号框的大小*/ #newtab-grid{ max-width: 800px !important; max-height: 350px !important; } /*隐藏搜索框 #newtab-search-form {display: none !important;} */ #newtab-search-icon {display: none !important;} #newtab-search-text {display: none !important;} #newtab-search-submit {display: none !important;} /*//////////////////////缩略图//////////////////////*/ .newtab-thumbnail { height: auto; } [href*=&quot;www.runningcheese.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/runningcheese.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.douban.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/douban.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.zhihu.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/zhihu.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;weibo.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/weibo.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;wikipedia.org&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/wikipedia.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;tieba.baidu.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/tieba.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;twitter.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/twitter.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.guokr.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/guokr.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.youku.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/youku.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.quora.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/quora.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.pinterest.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/pinterest.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;500px.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/500px.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;yinxiang.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/evernote.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;dribbble.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/dribbble.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;dropbox.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/dropbox.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.bilibili.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/bilibili.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.xiami.com/&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/music.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;deviantart.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/deviantart.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;lofter.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/lofter.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;www.youtube.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/youtube.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } [href*=&quot;inoreader.com&quot;] .newtab-thumbnail { background: rgba(0, 0, 0, .05) url(&quot;http://taoskyme.qiniudn.com/inoreader.png&quot;) center center no-repeat !important; background-size: 100% 100%!important; } } ","link":"https://taosky.github.io/post/my-firefox-profile/"},{"title":"使用IFTTT同步Inoreader星标文章到Evernote","content":"Inoreader 手机端默认是国际版的Evernote，网页端可以设置绑定印象笔记。 然而保存文章只能保存标题、头图以及文章链接。显然不太好用。 本来想通过pocket进行中转，发现还是不完整的文章。 生成星标文件RSS源 无意中发现Inoreader可以生成特定的RSS源 我们可以生成星标的RSS源，比如我的是“http://www.inoreader.com/stream/user/1005757586/tag/user-favorites” 使用IFTTT IFTTT绑定Evernote 使用这个applets: https://ifttt.com/applets/86908p-rss-evernote 填好RSS源 及evernote的笔记本(可选) 记得在设置中关闭短链接(由于短链地址被墙，笔记中的图片会显示不出。) 这样在Inoreader中加星就会被保存到Evernote中了，另外这个不是实时同步的，所以并不能马上看到。 ","link":"https://taosky.github.io/post/inoreader-ifttt-evernote/"},{"title":"我的Android应用推荐","content":"仅部分，全部app见我的应用集。 EverMemo 属于常年不更新但是一直都很好用的那种，体积超小、功能简单的便签，可以同步Evernote(国际版或国内版)。建议下载修改版，原版在高版本设备上删除有bug。 类似的APP有PureNote、Simplenote(听说支持全平台)，有空试试。 XyKey 干净的本地账号密码管理工具，可以加密备份还原。不过lastpass手机端最近免费用了，可能就不用它了。 DNS man 设置DNS，可以针对不同的网络使用不同的DNS，没root不能改hosts用这个，没root的只能使用vpn模式，改个dns上上ins没问题。 CyanogenMod Calculator计算器 主要是有个小部件可以悬浮小计算器，设定成nova双击桌面启动很方便。 您的浏览器不支持 video 标签。 英语 ✓ 网友开发的，支持多个翻译接口，生词本功能很有用。 另外Android 6.0以上可以选定文字直接翻译。 使用时静音:In Use 顾名思义，可以设定亮屏时和关屏市不同的声音模式，把亮屏时设成静音，微信聊天就不会震个不停了，而关屏市还可以正常响铃震动。 另外有个发现：静音在原生系统上是免打扰模式，在其他机器上是静音。 极邮 体积小，省电。可以免翻同步Gmail(最近好像坏掉了)。 Via浏览器 via 是一个浏览器，有这么几个特点： -多设备同步书签及设置 -为手机及平板分别优化 -标记广告及hosts拦截广告 -插件扩展 -网页翻译及网页截图 -自定制主页背景及logo -权限只为必要而不偷取隐私 -不推送消息不在后台偷跑 -更多特性正在来袭 我们有些话想说： 我们不想强硬地告诉你天气好坏， 也不愿强迫你关注哪位明星又和谁起了绯闻。 我们不想假装懂你， 只把你想要的放到你面前。 我们希望你能享受应有的轻快简洁的浏览体验。 结识志同道合及反馈: 企鹅群233258677 “浏览器界的一股清流” -- AppSo(微信应用推荐媒体) “它从不假装懂你” -- 安卓酱(微信应用推荐媒体) (来自酷安应用简介http://www.coolapk.com/apk/mark.via) Pure天气 个人认为是android平台目前最美观好用的天气app了。 图懒的上了 ╮(￣▽￣)╭ ","link":"https://taosky.github.io/post/my-android-app/"},{"title":"MPV视频播放","content":" you-get用到MPV播放，感觉不错，又在狐吧看到potplayer默认渲染的色彩问题，就索性换了播放器。 下载安装 https://mpv.io/installation/ 设置Windows文件关联 https://github.com/rossy/mpv-install/blob/master/README.md 按说明下载压缩包，解压至安装目录，(管理员权限)运行 mpv-install.bat。 在windows的默认程序页面设置MPV为默认。 脚本 脚本可以实现很多功能。我这里用到了autoload.lua这个脚本，用以自动播放同一文件夹下相似文件(就是下一集。。。) 脚本放在安装目录scripts文件夹下即可。 配置参数 安装目录新建 mpv.conf 参照官方文档进行配置。 有大神写了个windows下的图形化配置软件，可以定制一部分参数。 分享下我的配置，大概是设置了解码器、字幕样式、截图(路径请自行修改)、进度条样式，窗口大小。 # Video settings vo=opengl-hq # Audio settings # Subtitle settings sub-text-font-size=56 sub-text-shadow-offset=0.5 sub-text-color=&quot;#fff8f8f8&quot; sub-text-border-color=&quot;#ff000000&quot; sub-text-font=&quot;微软雅黑&quot; # OSC settings script-opts=osc-layout=slimbox,osc-seekbarstyle=diamond # OSD settings # Screenshot settings screenshot-format=png screenshot-template=D:/Taosky/Pictures/videoshot/%f-%n # Window settings keep-open=yes autofit-larger=90%x80% cursor-autohide=number # Miscellaneous settings # Unknown and custom settings # Extensions - Do not add custom settings that are not extension related below this line. 常用快捷键 精简修改自http://mazhuang.org/wiki/mpv/#section hexo用〈table〉标签会渲染出一坨 〈/br〉(详见似乎hexo对表格支持不好), 所以表格在很下面，往下翻。(由于太懒就不用markdown格式表格了) 按键 功能 RIGHT或滚轮(下同) 前进 5 秒 LEFT 后退 5 秒 UP 前进 60 秒 DOWN 后退 60 秒 /[ 0.9091 倍速播放 /] 1.1 倍速播放 /{ 0.5 倍速播放 /} 2.0 倍速播放 Backspace 还原到 1.0 倍速 Space 或 p 或 右键 播放/暂停 . 下一帧 , 上一帧 9 或 /或 侧键1 音量 -2 0 或 *或 侧键2 音量 +2 Enter 下一文件 f 或 双击 全屏切换 v 显示/隐藏字幕 j 或 J 选择字幕 z 字幕提前 x 字幕延迟 T 置顶切换 s 截屏，有字幕 S 截屏，无字幕 o 显示进度条与时间 (2 秒) O 显示进度条与时间 (不消失) I (大写 i) 显示当前文件名 /# 声道切换 q 退出 Q 保存进度退出 ","link":"https://taosky.github.io/post/mpv/"},{"title":"微广场的微信公众号RSS源","content":"已失效 链接 注册用户可以免费订阅10个公众号 知乎上看到的，很稳定的样子。 *顺带一提：*用这个订阅知乎日报的微信公众号就不用找第三方的知乎日报源了。 ","link":"https://taosky.github.io/post/wechat-rss/"},{"title":"自制知乎日报RSS源","content":"2017/09/27: openshift V2关闭，因此失效，可使用 http://zhihurss.miantiao.me/dailyrss 2016/11/20更新： 缓存知乎图片（可能会解决某些阅读器的图片问题），目录更改，修改为10分钟更新一次。 2016/10/10更新： 增加文章头图，便于在阅读器里显示。 http://i.zxc.science/static/zhihudaily.xml 网上的源基本都不能用了，自己尝试写了一个，代码十分简陋就不贴了。 openshift 一分钟跑一次不知道会不会坏掉。。。(已参照参照stackoverflow上的答案修改) ","link":"https://taosky.github.io/post/zhihudaily-rss/"},{"title":"python爬虫抓取天气","content":"已失效 一个小小小爬虫 由于天气API需要付费，就自己爬虫爬天气数据下来 然后挂在openshift上。 http://i.zxc.science/weatherapi?citycode=101190102&amp;type=today 爬虫代码如下： 简单的正则匹配，效率应该很低，基于python3。 #coding:utf-8 import urllib.request import re __author__ = 'Taosky' def now(citycode): url = 'http://m.weathercn.com/todayweather.do?id='+citycode+'&amp;partner=m' r = urllib.request.urlopen(url) html = r.read().decode('UTF-8') today ={} today['today_date'] = re.search(r'&lt;span class=&quot;date&quot;&gt;(.*?)&lt;/span&gt;',html).group(1) today['today_weekday'] = re.search(r'&lt;span class=&quot;weekday&quot;&gt;(.*?)&lt;/span&gt;',html).group(1) today['today_solarTerm'] = re.search(r'&lt;span class=&quot;solarTerm&quot;&gt;(.*?)&lt;/span&gt;',html).group() today['today_curtime'] = re.search(r'&lt;div class=&quot;curtime&quot;&gt;/s*?&lt;span&gt;(.*?)&lt;/span&gt;',html).group(1) today['today_curtemp'] = re.search(r'&lt;span class=&quot;cur-temp&quot;&gt;(.*?)&lt;/sup&gt;',html).group(1).replace('&lt;sup&gt;','') today['today_description'] = re.search(r'&lt;span class=&quot;description&quot;&gt;(.*?)&lt;/span&gt;',html).group(1) today['today_sunrise'] = re.search(r'&lt;div class=&quot;sunrise&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;span&gt;.*?&lt;/span&gt;&lt;span&gt;(.*?)&lt;/span&gt;&lt;/div&gt;',html).group(1) today['today_sunset'] = re.search(r'&lt;div class=&quot;sunset&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;span&gt;.*?&lt;/span&gt;&lt;span&gt;(.*?)&lt;/span&gt;&lt;/div&gt;',html).group(1) textdescre = re.compile('&lt;p/s*class=&quot;textdesc&quot;&gt;(.*?)&lt;/p&gt;') textdesc = textdescre.findall(html) today['today_wind-direction'] = textdesc[0] today['today_wind_level'] = textdesc[1] numre = re.compile('&lt;p class=&quot;num&quot;&gt;(.*?)&lt;/p&gt;') num = numre.findall(html) today['today_air_pressure'] = num[0] today['today_humidity'] = num[1] today['today_wind_speed'] = num[2] today['today_visibility'] = num[3] return today def days(citycode): url = 'http://m.weathercn.com/index.do?id='+citycode+'&amp;partner=m' r = urllib.request.urlopen(url) html = r.read().decode('UTF-8') datesre = re.compile('&lt;td class=&quot;date&quot;&gt;(.*?)&lt;/td&gt;') tempssre = re.compile('&lt;td class=&quot;temp&quot;&gt;/s*?(.*?)/s*?&lt;/td&gt;') descsre = re.compile('&lt;td class=&quot;desc&quot;&gt;/s*?(.*?)/s*?&lt;/td&gt;') dates = datesre.findall(html) temps = tempssre.findall(html) descs = descsre.findall(html) days = {} for i in range(len(dates)): num =str(i+1) days['days_date'+num] = dates[i] days['days_tem'+num] = temps[i].replace('/t','').replace('/n','').replace('/r','').replace(' ','') days['days_desc'+num] = descs[i].replace('/t','').replace('/n','').replace('/r','').replace(' ','') return days def hours(citycode): url = 'http://m.weathercn.com/eachhours.do?id='+ citycode + '&amp;partner=' r = urllib.request.urlopen(url) html = r.read().decode('UTF-8') timesre = re.compile('&lt;div class=&quot;time&quot;&gt;(.*?)&lt;/div&gt;') tempsre = re.compile('&lt;div class=&quot;temp&quot;&gt;(.*?)&lt;/div&gt;') descsre = re.compile('&lt;div class=&quot;desc&quot;&gt;(.*?)&lt;/div&gt;') times = timesre.findall(html) temps = tempsre.findall(html) descs= descsre.findall(html) hours = {} for i in range(len(times)): num =str(i+1) hours['hours_time'+num] = times[i] hours['hours_tem'+num] = temps[i] hours['hours_desc'+num] = descs[i] return hours ","link":"https://taosky.github.io/post/python-get-weather/"},{"title":"Inoreader","content":"2016/12：除了离线需要购买外还是很好用的 尝试使用，和feedly差不多，评价好像要好些。 很多网站没提供订阅源，第三方源又不稳定，所以和豌豆荚一览配合使用 Inoreader网页界面和手机界面都很简洁实用 ","link":"https://taosky.github.io/post/inoreader/"},{"title":"Rime添加词库及表情符号输入","content":"***2017/3 已停用，win10预览版可以自带输入法可以自定义双拼了，加上Prime更新缓慢，小狼毫在win10也存在一点问题。 2016/12：已使用 Rime增强计划 prime终于支持皮肤了呢 ≧▽≦ 扩展词库 贴吧的那个增加词库的帖子没看懂，大概只知道如果不是用户习惯产生的词库不该导入用户词库。 按照 https://github.com/rime-aca/dictionaries 操作终于搞懂了。 大概流程是通过自定义方案指定扩展字典，然后在扩展字典中import 别的字典(自己的字典)。好像可以不断的一个import另一个？ 比如使用的是朗月拼音 就把luna_pinyin.custom.yaml 及luna_pinyin_extended.dict.yaml以及其他几个dict.yaml拷贝到用户配置文件夹下。 然后会发现 luna_pinyin.custom.yaml 里面指定了luna_pinyin_extended luna_pinyin_extended.dict.yaml里面是词库 + 导入其他词库 如果需要加入自己的词库，就要新建一个 .dict.yaml 在这里import 比如我的是luna_pinyin.taosky.dict.yaml luna_pinyin.taosky.dict.yaml里面的内容是 这里需要对你自己的词库深蓝转换和简繁转换，然后按格式写入。 增加颜文字及符号 参考 https://gist.github.com/zolunx10/3848421 使用 ` 跳过当前输入法，从而输入颜文字及符号 先增加输入方案 kaomoji.schema.yaml 字典（可以自行修改其它按键） kaomoji.dict.yaml 修改当前输入法方案文件两处(*.schema.yaml)（按道理是修改.custom.yaml,但是没生效）（事实上是可以的，因为格式问题没被更新到配置） schema/dependencies: - kaomoji reverse_lookup: dictionary: kaomoji enable_completion: false prefix: &quot;`&quot; # 按`键直接调用kaomoji而跳过拼音 tips: &quot;〔颜文字〕&quot; ","link":"https://taosky.github.io/post/rime-dict/"},{"title":"Acrylic DNS Proxy搭建本地DNS及过墙","content":"功能 支持通配符和正则的hosts windows 的host不能支持通配符而导致一些域名不能得到匹配，如youtube视频的*.googlevideo.com(前面的一串会更新)。 这个可以用来过墙和屏蔽广告。 用于局域网DNS解析 需要在配置文件中设定允许的IP，然后局域网其他机器设置DNS为本机器ip 不过一般局域网直接用路由器了吧。 节省时间 并行转发DNS请求(据说是哪个快用哪个?)，缓存(服务停用时写入)。 更多功能、问题 可以查看官方的FAQ。 使用 先下载安装，便携版需要运行目录下“InstallAcrylicService.bat”手动安装服务。 DNS设置 修改&quot;AcrylicConfiguration.ini&quot;中dns（默认是谷歌的，国内用不了） PrimaryServerAddress=223.5.5.5 ... ... ... SecondaryServerAddress=223.6.6.6 可以添加更多 AcrylicHosts修改 目录下&quot;AcrylicHosts.txt&quot; 自用 hosts下载 说明： sni服务器来自 https://github.com/fengixng/google-hosts hosts修改自 https://github.com/racaljk/hosts 重启服务并修改网络连接 运行&quot;RestartAcrylicService.bat&quot;重启服务，更改适配器设置中设定当前网络DNS服务器为127.0.0.1。 注意 被屏蔽网站需要https访问。 chrome可以参考这里 firefox 可以使用SmartHTTPS 扩展 在我电脑上有个小问题，firefox下播放youtube视频很容易错误，chrome下完全正常。。。 ","link":"https://taosky.github.io/post/Acrylic-DNS-Proxy/"},{"title":"获得小绿锁一把！(启用Https)","content":"2018/05/11：因Github Pages支持自定义域名的https，迁移 2016/11/4：Coding Pages貌似添加了根证书，又把国内的解析到coding pages 2016/10/30： 本来想判断UA只对电脑跳转，发现Ubuntu下也会提示错误。。。尝试了其它服务(点此查看)，暂用aerobatic 看了很多博客启用了https，自己也想尝试一下，于是绕了个大湾，且听我道来。 申请StartSSL 证书 先前听说过coding pages 绑定域名会自动启用https（https://www.tiexo.cn/https/） ，我本来是一直在用coding pages的，然而并没有启用https，重新绑定几次也没有出现。 于是就想另起炉灶，在爽呀那里看到他用的是古尓数据提供的网存且启用了https，于是想照着弄一个，先是申请古尓数据的免费网存（只能放博客），域名正常，态度端正就通过了。 然后要申请证书，在爽呀的博客看到说“Let’s Encrypt”三个月就要续命，而“StartSSL”一年续一次。于是果断也申请StartSSL的证书。教程网上一大把，就不再细说。大概流程基本是： 验证域名所有权--&gt;证书作用域名（最多五个）--&gt;生成及提交CSR--&gt;生成下载证书包--&gt;服务器配置SSL证书 在古尓数据的后台 粘贴证书及私钥 就可以https访问网站了。可以看到是StartCom验证的 Coding Pages 生成证书 这时候我又试了下coding pages 绑定域名，发现绑定后过几分钟就显示https 的链接，访问博客发现已经可以，验证者是 Let’s Encrypt 。应该是后台服务器自动申请的证书，这和中科大提供的博客一样，由于 Let’s Encrypt的申请和续命可以完全的脚本化，将来一定会得到越来越多的使用。 虽然开始做了无用功，不过也解答了我的一个疑惑：同一个域名可以由多个机构颁发多个证书，不过也容易想通，毕竟证书是部署在服务器上的，而浏览器又是本地验证是否可信。 后续配置 网站中有非https的资源浏览器就会报不信任，所以要给cdn空间启用ssl，按道理七牛是可以启用ssl的，然而 于是换了又拍云，申请又拍云联盟的话是可以免费用很久的（虽然还没通过）。将文件转移开启ssl，替换文章内的链接，就可以了。 参考唐门的两篇文章1，2增加了http到https的跳转以及替换了多说文件地址。 至此，整个站点都是小绿锁了。 小问题 手机上的很多浏览器提示证书不信任，搜索后得知是证书链不完整 由于Firefox和Chrome直接支持Let's Encrypt，所以没有问题。 但是还是有大量浏览器不直接支持Let's Encrypt，必须用到上级证书 DST Root CA X3。 如果是Apache服务器，在ssl.conf中打开 SSLCertificateChainFile 配置项并指向 ca_bundle.crt 即可。 作者：刘小平 链接：https://www.zhihu.com/question/40718588/answer/111948349 来源：知乎 著作权归作者所有，转载请联系作者获得授权。 其实我在配置古尓数据的时候也确实按爽呀说的加入了根证书，不过coding pages没有办法手动配置，只能等待官方改进了。 其它服务 话说证书在手机上不信任的问题一直迟迟没有进展，就想换个方法解决。 gitlab gitlab原生支持hexo(自动部署)，支持ssl，然而研究半天尝试后发现这速度比github还要慢，开个文章的页面需要好几秒，遂放弃。 参考了这些： 基地转移！从 GitHub Pages 转移到 GitLab Pages Hosting on GitLab.com with GitLab Pages openshift 感觉速度其实还可以，ssl需要免费升级铜牌会员，由于需要信用卡，就没折腾。 aerobatic 这个东西网上相关的介绍比较少，大概是以Bitbucket的版本库为基础自动构建静态网站的东西。幸好官网的教程很详细，很容易就实现了。Hexo的配置文件里填写Bitbucket的版本库，就可以和原来一样用，需要注意的是: The free plan is limited to 5 deployments in a 24 hour period. 免费版支持两个网站，一个域名，域名自带亚马逊的泛域名证书(需要邮箱验证所有者)，然而只能用在它构建的网站上。这个感觉不太稳定，不知道是不是我网络问题，用一段时间试试。 ","link":"https://taosky.github.io/post/https/"},{"title":"Firefox告别Flash（配合you-get观看下载在线视频）","content":"妈妈再也不用担心我的火狐崩溃了~ 安装you-get “You-Get 乃一小小哒命令行程序，提供便利的方式，下载网络上的富媒体信息。” 详细情况及安装戳这里或中文说明。 （推荐安装ffmpeg） mpv mpv是一个全能高效的视频播放器，我们用来调用观看在线视频。戳这里下载。 将包含mpv.exe的目录添加至环境变量PATH。 这时 &quot;you-get -p mpv http://www.acfun.tv/v/ac2776060&quot; 应该可以调用mpv播放视频。 open with 扩展 每次看视频都要敲击命令很麻烦，我们可以在firefox 上安装open with 这个扩展来简化操作。 添加you-get.exe 编辑参数 这是以默认画质（最高画质）播放。 youget - i &quot;视频地址&quot; 可以查看可用画质 （如果使用在open with 中，要使用cmd /k 来防止运行完命令窗口就关闭） 一般优酷土豆源的视频为hd2（超清）、mp4（高清）、flvhd（标清）， you-get --format=hd2 -p mpv &quot;视频地址&quot;可以以选择画质播放。 更多命令可以查看you-get 的中文说明 我的open with 后来发现很多情况下下载会 下到 用户目录下(C:/Users/xxx) 所以改成了先切换目录 其实可以写个小脚本选择清晰度，太懒了下次试试。 ","link":"https://taosky.github.io/post/firefox-no-flash/"},{"title":"windows10周年更新体验","content":" 安装 3号早上已经推送可以直接更新。 也可以下载镜像安装，保留数据即可。 用了mactype的安装前需卸载，否则出现开机蓝屏、闪屏的情况。 变化 第一眼看到的就是，锁屏界面更漂亮了。变成了背景不变的动画效果。 系统感觉更轻快，一些操作也比以前顺畅，比如开始屏幕的磁块拖动。 界面更加统一，一些设置并入所有设置中。 很多细节更人性化，比如平板模式和桌面模式任务栏隐藏可以分别设置，任务栏的颜色也不必和主题色一致。 这个link好像是个很方便的东西，屏幕草图可以截取当前屏幕然后涂画。 edge好像变得更好用了，商店可以下载很多扩展。 自带热点 这次更新还有一个亮点就是bash了，可以运行大部分linux命令。 安装在“启用或关闭windows功能” 开启并需要换到“开发人员模式”。 用不到就不截图了。 问题 软件兼容方面，大多数软件都没有问题，目前只有迅雷极速版会崩溃，需要安装新版或打补丁。 部分页面偶尔会出现卡住的现象，部分软件打开会有明显的停顿，比如我的迅雷，自带的windows defender。 用了一天发现比较容易卡死，过一会儿可以恢复。。。希望后续更新会有改善。(据说固态的问题) 8/7更新： 卡死问题据说通过安装intel快速存储可以解决。 大BUG：锁屏后出现 输入密码无法解锁转圈循环要求解锁的情况。(解决办法) 开机后第一次打开设备管理器会导致窗口卡死，需重启 explorer。 ","link":"https://taosky.github.io/post/win10-1607/"},{"title":"firegestures扩展使用chrome打开当前页面(网络搜集修改)","content":"有時候需要快速在chrome中打開當前頁面 火狐安装 firegestures扩展 选项-映射-添加脚本 const CHROME_PATH = &quot;D://Programs//Chrome//chrome.exe&quot;; //chrome.exe的路径 记得转义&quot;/&quot; var file = Cc[&quot;@mozilla.org/file/local;1&quot;].createInstance(Ci.nsILocalFile); file.initWithPath(CHROME_PATH); if (!file.exists()) { alert(&quot;File does not exist:&quot; + CHROME_PATH); return; } var process = Cc[&quot;@mozilla.org/process/util;1&quot;].createInstance(Ci.nsIProcess); try { var args = [window.content.location.href]; process.init(file); process.run(false, args, args.length); } catch (ex) { alert(&quot;Failed to execute:&quot; + CHROME_PATH); } 效果 ","link":"https://taosky.github.io/post/firegestures-open-in-chrome/"},{"title":"简单的Windows安装指南","content":"俗话说电脑修的好。。。 安装准备 windows安装镜像 除了已有windows安装光盘外，均需要下载windows安装镜像才能安装。 建议在 MSDN 我告诉你下载 现在电脑内存普遍在4G以上，推荐下载64位的windows镜像，32位系统只能识别4G不到的内存。 硬盘分区 这步主要是留出一个分区用作系统分区，也就是平常说的C盘。因为安装时会格式化这个分区，所以重装系统的话用原来的系统分区就好；安装双系统的话，需要重新划一个分区出来。 可以使用windows自带的磁盘管理进行分区的压缩、扩展、删除、新增。 有时候不是很好用，可以使用diskgenius等工具。 系统分区一般需要40G以上。 系统驱动程序 由于新安装完的系统没有网卡驱动，无法上网下载驱动，需要提前准备好。 如果驱动找不到或是嫌麻烦，可以下载一个带网卡驱动的驱动精灵以便重装后可以联网安装驱动。 安装方法 U盘安装 U盘安装是目前最为普遍的一种方法，也比较方便。 首先要有一个8G以上的U盘，对U盘内的资料进行备份(需要格式化)。 使用软件将U盘变成启动盘，这里使用UltraISO。 在UltraISO中打开下载的镜像 启动-写入硬盘镜像 写入，等待完成，完成后即获得一个装有windows安装程序的启动盘。 在需要重装的电脑上插U盘 开机选择启动项 一般为F12 如果没有这个功能，需要进bios设置里面将启动顺序 中U盘的位置提前 开机过程一般会提示按键进入bios设置 F2 或者 DEL 进入后在参照提示修改。 如此便可以进入安装界面。 硬盘安装 硬盘安装在没有U盘的情况下很好用，且安装要比U盘快。 需要借助NT6 hdd installer (提取密码: qaby) 这个软件。 值得注意的是在UEFI/GPT模式下 由于现有系统版本问题可能会出现无法安装的情况，若不能安装，请使用U盘安装的方法。 将下载的镜像用压缩软件打开解压全部内容到某个分区根目录 如解压到E盘根目录： 打开软件，选择安装 安装完成 选择重启 重启后应该会出现选择启动项 选择 nt6 hdd installer 的启动项 即可进入安装界面。 ps:待系统安装完成后可再使用软件，选择卸载以去除多余开机启动项 安装界面 根据提示进行，可能要求输入产品密钥，一般跳过，在进入系统后激活 这边选择自定义 选择要安装的系统分区并对其格式化，点击下一步 等待安装完成 完成后进行一些简单的设置 便可以进入新系统。 安装系统后的一些操作 安装驱动 由于没有安装驱动，进入系统后会发现分辨率不对、不能上网且不流畅。（win10自动更新会安装一部分驱动，建议自行安装） 安装已下载的驱动，或使用带网卡驱动的驱动精灵安装驱动。没有准备的话可以用U盘从别的电脑拷贝。 激活 正常的激活方式就不用说了，其他方法有 kms激活：kms是原理是本地自建kms服务器，缺点是180天需要再次激活。可以在这里下载。 电话激活：首先需要可电话激活的密钥(一般为家庭版或企业版)，进行官方的电话激活，此方法需要挂用Skype打英国电话，需要小学英语水平，但是可以永久激活。详细戳这里。 淘宝激活：其实就是利用了电话激活，一般比较便宜。自行淘宝搜索。 个人遇到的一些问题： ⑴windows7镜像可能会缺少bootmgr.efi这个文件，导致在uefi/gpt模式下没有办法安装，需要手动加入efi文件。 ⑵安装WIN7时提示“缺少所需的CD/DVD驱动器设备驱动程序”：1.插拔U盘2.不要插到USB3.0的接口上 关于GPT、MBR分区表，UEFI和BIOS 可以看这里 ","link":"https://taosky.github.io/post/windows-install-guide/"},{"title":"安装使用markdownpad2出现的问题","content":"Windows Installer不允许更新经过管理的播发产品。 安装Microsoft Visual C++ 2010 Service Pack 1 Redistributable Package MFC security update中出现。 用 Windows Installer Cleanup Utility 清理一下残留的注册信息，然后重新安装 预览页面不能正常显示 安装Awesomium 1.6.6 SDK 据说win8以上就会出现这个问题 ","link":"https://taosky.github.io/post/markdownpad2-problems/"},{"title":"记nexus4换电芯","content":"更新：用了没一个月就报废了。。。后来检测手机主板坏了。。。 四儿子用了两年，电池不给力了，看到论坛上说换电芯大发好，然后就开始作死。。。 所以买回来的电芯是这样的,看起来和正常电池确实不太一样。 拧下手机底部两个螺丝，敲开后盖，（找不到图了）拧下电池接触点的螺丝 然后慢慢把电池翘下来（底部有胶）。 电池特写。 剥掉外套。 这个就是保护板了，剪下来把它焊到新的电芯上就可以了（正负极要接对）。 据说这时候要用3-5v直流电源激活，但是我没做这步好像也行。 然后把它装回去，由于新的电芯比原来长2mm所以塞进去用些麻烦 然后开机成功。 然而故事到这里并没有结束，我之前没几滴焊丝而且焊不上，用胶带缠绕以为可以，谁知道放了一晚上开不了机o(╯□╰)o，第二天去修手机的店花了30大洋才搞定。 效果还是很明显的 ","link":"https://taosky.github.io/post/nexus4-dianchi/"},{"title":"xfce使用super+D 显示桌面","content":"xfce使用super+D 显示桌面 详细戳这里 附件 把这个程序放到 /usr/local/bin目录，通过 sudo chmod a+x /usr/local/bin/showdesktop 把这个程序变为可执行程序，然后就可以在 Setting--Keyboard界面上设置快捷键了 ","link":"https://taosky.github.io/post/xfce-showdesktop/"},{"title":"linux 转移至其他分区","content":"因为只有一个分区挂载根目录，所以对整个分区数据进行转移再修改grub就好 在win下 分出一个大的分区 启动进U盘的ubuntu 列出分区 lsblk mkfs.ext3 /dev/sday dd if=/dev/sdax of=/dev/sday bs=4096 conv=notrunc,noerror,sync 我用的archlinux默认的grub所以修改EFI分区中的 /boot/loader/entries/arch.conf 将sdax 改为sday（新的分区） 重启进入系统发现 分区大小等数据也变成了原来分区的 resize2fs /dev/sday（新的分区） ","link":"https://taosky.github.io/post/linux-move/"},{"title":"记：Android模拟器genymotion使用问题","content":"genymotion启动失败：Unable to load virtualbox I have spend all day to solve this error since none of the answers worked for me(I kind of enjoy that). I found out that oracle virtual box doesn't install the network adapter correctly in windows 8.1 Solution: Delete all previous virtual box adapters Go to device manager and click &quot;Add legacy hardware&quot; install the oracle virtual box adapters manually (my path was C:/Program Files/Oracle/VirtualBox/drivers/network/netadp/VBoxNetAdp.inf) Now that virtual box adapters is installed correctly, it needs to be setup correctly. (the following solution is like many other solution in here) 1.start Oracle VM VirtualBox and go to preferences &gt; Network &gt; host-only Nerwork 2. click edit 3.set IPv4 192.168.56.1 mask 255.255.255.0 4.click DHCP Server tab and set server adr: 192.168.56.100 server Mask: 255.255.255.0 low address bound: 192.168.56.101 upper adress bound 192.168.56.254 5. now click OK and start genymotion 来自这里 启动虚拟机失败virtualbox运行报cannot access the kernel driver 进入&quot;&quot;C:/Program Files/Oracle/VirtualBox/drivers/vboxdrv&quot;文件夹（具体看自己的vbox程序是安装或者放什么地方了），找到vboxdrv.inf这个文件，鼠标右键点，然后选择安装 然而我以管理员权限运行后才解决。 ","link":"https://taosky.github.io/post/genymotion-problem/"},{"title":"FeedlyReader——又一个feedly阅读app","content":"用着还不错。 下载：点此 ","link":"https://taosky.github.io/post/feedly-reader/"},{"title":"win10误删开始菜单及通知恢复","content":"其实是我用 Get-AppxPackage -AllUsers | Remove-AppxPackage 删自带modern应用后发现开始菜单和通知中心打不开了。 其实 开始菜单和通知中心 也是modern 应用，所以没了。 今天看一篇文章发现其实是可以恢复的 首先给右键菜单添加“管理员取得所有权”功能，用魔方可以 搜TakeOwnership就行 进入“C:/Program Files/”文件夹，找到“WindowsApps”文件夹，没有的话请勾选资源管理器上面的“显示隐藏文件”。然后右键单击这个文件夹，点击“管理员取得所有权”。 等程序结束 进入文件夹 搜索删掉的app，通知中心的话是actioncenter 然后发现它位于一个“Microsoft.Windows.ShellExperienceHost_1.0.0.2_x64__8wekyb3d8bbwe”目录的子目录里。 进入这个目录复制AppxManifest.xml的路径 &quot;C:/Program Files/WindowsApps/Microsoft.Windows.ShellExperienceHost_1.0.0.2_x64__8wekyb3d8bbwe/AppxManifest.xml&quot; 管理员权限打开powershell 输入命令 add-appxpackage -register &quot;C:/Program Files/WindowsApps/Microsoft.Windows.ShellExperienceHost_1.0.0.2_x64__8wekyb3d8bbwe/AppxManifest.xml&quot; -disabledevelopmentmode 重新注册这个app，这时发现开始菜单和通知中心 又能用了 ","link":"https://taosky.github.io/post/win10-modernapp-recovery/"},{"title":"谷歌日历app同步outlook及添加天气、农历。","content":" 由于没有Gapps或者不愿翻长城，同步outlook便是唯一的途径了 。（由于墙筑高了，实际可能还是需要翻） 首先，登陆outlook邮箱选择日历， 选择导入， 然后选择订阅，出现这个界面 添加农历、节假日 农历：http://www.google.com/calendar/ical/ug2j3l2nqq7uch3m9n0pm5t2lo@group.calendar.google.com/public/basic.ics 中国节假日：http://www.google.com/calendar/ical/china__zh_cn@holiday.calendar.google.com/public/basic.ics 添加天气 添加天气的方法也类似，不过要借助一个第三方的天气服务 http://weather.raychou.com/?/list/ 在这个网站找到所在城市的天气 拉至底部，选择 在给的url后面加上“ /1.ics ”， 否则不被识别， 然后和上面一样操作。 同步日历 需要同步日历的帐户，所以下载outlook客户端，安装并登陆。 进入设置-帐户-outlook， 点击日历同步（可能需要很久，不行请翻） 进入日历app就可以看到了，桌面添加部件之后会很方便。 ","link":"https://taosky.github.io/post/calendar-outlook/"},{"title":"win10 预览版9926体验","content":"这两天这个预览版好像很火，于是我也当了一回小白鼠。 关于安装 安装过程十分便捷。 有在线升级和镜像安装（需要联网）两种方式，由于在线升级速度不理想，所以选择了下载镜像安装。 首先去msdn下载镜像 x64 x86 用window资源管理器或者其他虚拟光驱装载镜像，直接打开setup.exe，经过一系列加载，出现 可以选择不保留 点击安装以后进入了安装的界面 这个时候可以选择去干些其他事，重启完 会进行一系列设置，整个过程在20min-40min。（我猜的。。） 开机后进行一些小设置，然后过一会儿就能使用了。 开始 明显的一个重大的变化就是开始”界面“了，这个从之前很多报道上也已经知道。据说这种设计是为了改善桌面用户的体验，既有以前的开始菜单功能，又具有win8的metro应用。这个变化肯定会吸引win7用户，而对于win8/8.1的用户：开始菜单已经不需要了(.)。 Metro应用也已经窗口化，就连设置什么的也全部都窗口化了 设置的界面是否似曾相识，点进去一看，发现还是有自身特点的 ##任务栏 任务栏也发生了很大的改变 增加了搜索栏 是有cortana的，不过需要改地区什么的才能用 这个通知就很有意思了，metro应用的通知以及一些其它的通知都会记录在里面，应该是那种气泡通知可以，QQ之类的”通知“不行。 可以看到下面有一些快捷开关，这个tablet mode 顾名思义，就是切换成平板模式。基本就是全部窗口以全屏模式打开且只能分割屏幕，不能调整大小，开始菜单最大化。总之对于桌面用户没啥用。 任务栏的这部分我总觉得和dock很相似。 这边有个任务视图按钮 这么一来就很清楚是什么了，多个”桌面“或者说是工作空间。win+ctrl+左/右可以快速切换 其它 替换了很多图标，整个界面都趋于扁平化，据说这个图标已经被无数人吐槽。。 超级按钮什么的已经全部消失了 更新很慢，而且居然可以更新显卡驱动。。。 性能 由于没有什么大型软件可以测试，所以不能客观的评价。（偷懒省掉这个233333） 只能说感觉上更加顺畅了，火狐也更快了（嗯，又快了）。 兼容性 我现在的软件都能使用，常用的软件应该都没啥问题。 小结 win10的变化很多，微软也从其它地方借鉴了很多，做了很多尝试。对于用户来说，这些应该都是好事。 对于想要尝鲜的同学来说，我觉得大可以尝试一下，不用担心很多。 ","link":"https://taosky.github.io/post/win10-9926/"},{"title":"android 5.0 感叹号去除办法","content":"tags: [android] 2015/1/22 更新 android5.0通过访问google服务器判断wifi是否需要验证及网络是否通畅，在我朝由于连不上google服务器所以一直显示感叹号，而且容易导致链接wifi而使用数据。 解决方法： 将google服务器的地址换掉或者关闭这个功能 adb命令 1.完全屏蔽网络检查功能，最简单快速，但是就没有办法提示wifi登陆： adb shell &quot;settings put global captive_portal_detection_enabled 0&quot; 2.用国内的服务器替换掉google的服务器（这里用的是google国内的g.cn）： adb shell &quot;settings put global captive_portal_server g.cn&quot; 用Portal Server修改器app http://coolapk.com/apk/org.foxteam.noisyfox.noexclamation 注： 1.adb不需要ROOT，app需root,修改之后需要重新联网生效（开飞行模式关飞行模式） 2.如果禁用“设置”等app的联网权限，感叹号一直存在。 3.以上修改方式具有持久性，重启依旧有效，除非刷机或者清除数据。 4.据说g.cn有些运营商网络不能正常访问，可以尝试设置为 www.265.com， 如何自己搭建 只要访问 你的域名/generate_204 返回值为204即可 最简单的方案是，直接建立一个generate_204的0字节文件。 rewrite 和 nginx 就不说了，有需要可以点最后的链接看 其实只要有一两个备用就行，也没有必要自建。 内容来自：http://小狐狸.中国/45.html (android代码分析及解释看这里) ","link":"https://taosky.github.io/post/android-5-exclamation/"},{"title":"转-KDE4的配置参考","content":"tags: [kde,linux] 原文链接 发行版: 我的发行版是Arch，没有Arch强大的AUR，很多桌面的配件很难装上。 ##主题： 我的plasma主题是Helium与dynamo主题混合而成。 标题栏主题是Qtcurve，图标主题是dynamo与flattr混合而成， 鼠标主题是Breeze。应用程序主题是Qtcurve，配色是Breeze。 这些都可以到这里下载 先安装qtcurve再将下载下来的 文件解压并覆盖～/.kde4/share/即可。注意，Qtcurve的配置 方案是Breeze，并且在窗口管理器中设置边框大小是无侧边框。 全局菜单： 全局菜单可以先加archlinuxcn源，然后依次用 yaourt安装appmenu-qt,appmenu-qt5,appmenu-gtk,kdeplasma-applets-menubar。 完成之后在面板上添加刚安装的部件再打开 “系统设置&gt;应用程序外观&gt;风格” 然后选择微调标签，修改“菜单栏风格”为“仅导出”就能有全局菜单了。 最大化隐藏菜单栏： 最大化隐藏菜单栏可以直接在qtCurve中配置， 依然在“窗口管理器”中，勾选“最大化窗口无边框”复选框即可。 最大化上面板显示窗口控制按钮： （最后一张图鼠标所指的地方） 在AUR中安装kdeplasma-applets-kwin-button-improved， 然后在面板上重复三次添加这个部件，分别设置为最小化（iconify）， 最大化/回复（maximize/restore）和关闭（close）就行了。 ","link":"https://taosky.github.io/post/kde4/"}]}